
<!DOCTYPE HTML>
<html lang="cn" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Learn Polygeist · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-synthwave84.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex-pp/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../LearnPolyhedralModel/Note.html" />
    
    
    <link rel="prev" href="../LearnMocCUDA/MocCUDA.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Learn.html">
            
                <a href="../Learn.html">
            
                    
                    Learn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../LearnAIMA/">
            
                <a href="../LearnAIMA/">
            
                    
                    Learn AIMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../LearnConda/Conda.html">
            
                <a href="../LearnConda/Conda.html">
            
                    
                    Learn Conda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../LearnCUDA/CUDA.html">
            
                <a href="../LearnCUDA/CUDA.html">
            
                    
                    Learn CUDA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../LearnCV/ComputerVisoin.html">
            
                <a href="../LearnCV/ComputerVisoin.html">
            
                    
                    Learn Computer Vision
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../LearnDocker/docker.html">
            
                <a href="../LearnDocker/docker.html">
            
                    
                    Learn Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../LearnDrones/Note.html">
            
                <a href="../LearnDrones/Note.html">
            
                    
                    Learn Drones
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../LearnGameDev/Note.html">
            
                <a href="../LearnGameDev/Note.html">
            
                    
                    Learn GameDev
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../LearnGameTheory/GameTheory.html">
            
                <a href="../LearnGameTheory/GameTheory.html">
            
                    
                    Learn Game Theory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../LearnLalrpop/Lalrpop.html">
            
                <a href="../LearnLalrpop/Lalrpop.html">
            
                    
                    Learn Lalrpop (Rust)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../LearnPest/pest.html">
            
                <a href="../LearnPest/pest.html">
            
                    
                    Learn Pest (Rust)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="../LearnMLIR/MLIR-LanRef.html">
            
                <a href="../LearnMLIR/MLIR-LanRef.html">
            
                    
                    Learn MLIR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="../LearnRust/Resources.html">
            
                <a href="../LearnRust/Resources.html">
            
                    
                    Learn Rust
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="../LearnROS/ROS.html">
            
                <a href="../LearnROS/ROS.html">
            
                    
                    Learn ROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../PersonalWebsite/Note.html">
            
                <a href="../PersonalWebsite/Note.html">
            
                    
                    Learn Personal Website
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="../LearnMocCUDA/MocCUDA.html">
            
                <a href="../LearnMocCUDA/MocCUDA.html">
            
                    
                    Learn MocCUDA
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.16" data-path="Note.html">
            
                <a href="Note.html">
            
                    
                    Learn Polygeist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="../LearnPolyhedralModel/Note.html">
            
                <a href="../LearnPolyhedralModel/Note.html">
            
                    
                    Learn Polyhedral Compilation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.18" data-path="../LearnROCm/ROCm.html">
            
                <a href="../LearnROCm/ROCm.html">
            
                    
                    Learn ROCm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.19" data-path="../LearnJinJia2/Jinjia2.html">
            
                <a href="../LearnJinJia2/Jinjia2.html">
            
                    
                    Learn JinJia2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../Misc/Misc.html">
            
                <a href="../../Misc/Misc.html">
            
                    
                    Misc
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../Misc/00_Links.html">
            
                <a href="../../Misc/00_Links.html">
            
                    
                    Useful Links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../Misc/01_GitHubReps.html">
            
                <a href="../../Misc/01_GitHubReps.html">
            
                    
                    Github Reps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../Misc/GitBook.html">
            
                <a href="../../Misc/GitBook.html">
            
                    
                    Gitbook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../../Misc/Typst.html">
            
                <a href="../../Misc/Typst.html">
            
                    
                    Typst
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../../Misc/Markdown.html">
            
                <a href="../../Misc/Markdown.html">
            
                    
                    Markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../../Misc/VScode.html">
            
                <a href="../../Misc/VScode.html">
            
                    
                    VScode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../../Misc/Bochs.html">
            
                <a href="../../Misc/Bochs.html">
            
                    
                    Bochs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../../Misc/RegularExp.html">
            
                <a href="../../Misc/RegularExp.html">
            
                    
                    Regular Exp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../../Misc/FuzzTesting/FuzzTesting.html">
            
                <a href="../../Misc/FuzzTesting/FuzzTesting.html">
            
                    
                    FuzzTesting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../../Misc/PowerShell.html">
            
                <a href="../../Misc/PowerShell.html">
            
                    
                    PowerShell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="../../Misc/NPM.html">
            
                <a href="../../Misc/NPM.html">
            
                    
                    NPM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="../../Misc/Fonts.html">
            
                <a href="../../Misc/Fonts.html">
            
                    
                    Fonts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="../../Misc/Drawing.html">
            
                <a href="../../Misc/Drawing.html">
            
                    
                    Drawing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="../../Misc/Flatpack">
            
                <span>
            
                    
                    Flatpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../Linux/Linux.html">
            
                <a href="../../Linux/Linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../Linux/Display/Display.html">
            
                <a href="../../Linux/Display/Display.html">
            
                    
                    Display
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../Linux/LinuxFamily/LinuxFamily.html">
            
                <a href="../../Linux/LinuxFamily/LinuxFamily.html">
            
                    
                    LinuxFamily
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../Linux/UserManagement.html">
            
                <a href="../../Linux/UserManagement.html">
            
                    
                    UserManagement
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../Linux/InputMethod.html">
            
                <a href="../../Linux/InputMethod.html">
            
                    
                    InputMethod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../Linux/PrintingDrivers.html">
            
                <a href="../../Linux/PrintingDrivers.html">
            
                    
                    PrintingDrivers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../PythonLibs/PythonLibs.html">
            
                <a href="../../PythonLibs/PythonLibs.html">
            
                    
                    PythonLibs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../PythonLibs/ArgParse.html">
            
                <a href="../../PythonLibs/ArgParse.html">
            
                    
                    ArgParse
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../Network/Network.html">
            
                <a href="../../Network/Network.html">
            
                    
                    Network
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../Network/Tailscale.html">
            
                <a href="../../Network/Tailscale.html">
            
                    
                    Tailscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../Network/Clash.html">
            
                <a href="../../Network/Clash.html">
            
                    
                    Cxxxh
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Git
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../Git/git.html">
            
                <a href="../../Git/git.html">
            
                    
                    git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../Git/githttps.html">
            
                <a href="../../Git/githttps.html">
            
                    
                    githttps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../Git/git-branch.html">
            
                <a href="../../Git/git-branch.html">
            
                    
                    git-branch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../Git/Github.html">
            
                <a href="../../Git/Github.html">
            
                    
                    GitHub
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../Papers/Papers.html">
            
                <a href="../../Papers/Papers.html">
            
                    
                    Papers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../Papers/AttentionIsTuringComplete.html">
            
                <a href="../../Papers/AttentionIsTuringComplete.html">
            
                    
                    Attention Is Turing Complete
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../Programming/Programming.html">
            
                <a href="../../Programming/Programming.html">
            
                    
                    Programming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../ConfigExamples/ConfigExamples.html">
            
                <a href="../../ConfigExamples/ConfigExamples.html">
            
                    
                    ConfigExamples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../ReadingNotes/ReadingNotes.html">
            
                <a href="../../ReadingNotes/ReadingNotes.html">
            
                    
                    ReadingNotes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../../ReadingNotes/青年在选择职业时的考虑-马克思-1835.html">
            
                <a href="../../ReadingNotes/青年在选择职业时的考虑-马克思-1835.html">
            
                    
                    青年在选择职业时的考虑-马克思
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../../ReadingNotes/研究与学风-张申府-1948.html">
            
                <a href="../../ReadingNotes/研究与学风-张申府-1948.html">
            
                    
                    研究与学风-张申府-1948
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../../ReadingNotes/论青年修养-张申府-1946.html">
            
                <a href="../../ReadingNotes/论青年修养-张申府-1946.html">
            
                    
                    论青年修养-张申府-1946
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../../ReadingNotes/论青年的修养-张闻天-1938.html">
            
                <a href="../../ReadingNotes/论青年的修养-张闻天-1938.html">
            
                    
                    论青年的修养-张闻天-1938
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../../ReadingNotes/计算之魂-吴军/">
            
                <a href="../../ReadingNotes/计算之魂-吴军/">
            
                    
                    计算之魂
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../../ReadingNotes/语录-毛泽东.html">
            
                <a href="../../ReadingNotes/语录-毛泽东.html">
            
                    
                    Mao
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Learn Polygeist</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="polygeist-raising-c-to-polyhedral-mlir"><a href="https://ieeexplore.ieee.org/document/9563011" target="_blank">Polygeist: Raising C to Polyhedral MLIR</a></h1>
<p>Published in: 2021 30th International Conference on Parallel Architectures and Compilation Techniques (PACT)</p>
<p>&#x53D1;&#x8868;&#x4E8E;&#xFF1A;2021 &#x5E74;&#x7B2C; 30 &#x5C4A;&#x56FD;&#x9645;&#x5E76;&#x884C;&#x67B6;&#x6784;&#x4E0E;&#x7F16;&#x8BD1;&#x6280;&#x672F;&#x4F1A;&#x8BAE;&#xFF08;PACT&#xFF09;</p>
<p>Abstract: &#x6458;&#x8981;&#xFF1A;</p>
<p>We present Polygeist, a new compilation flow that connects the MLIR compiler infrastructure to cutting edge polyhedral optimization tools. It consists of a C and C++ frontend capable of converting a broad range of existing codes into MLIR suitable for polyhedral transformation and a bi-directional conversion between MLIR and OpenScop exchange format. The Polygeist/MLIR intermediate representation featuring high-level (affine) loop constructs and n-D arrays embedded into a single static assignment (SSA) substrate enables an unprecedented combination of SSA-based and polyhedral optimizations. We illustrate this by proposing and implementing two extra transformations: statement splitting and reduction parallelization. Our evaluation demonstrates that Polygeist outperforms on average both an LLVM IR-level optimizer (Polly) and a source-to-source state-of-the-art polyhedral compiler (Pluto) when exercised on the Polybench/C benchmark suite in sequential (2.53x vs 1.41x, 2.34x) and parallel mode (9.47x vs 3.26x, 7.54x) thanks to the new representation and transformations.</p>
<p>&#x6211;&#x4EEC;&#x4ECB;&#x7ECD; Polygeist&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#xFF0C;&#x5B83;&#x5C06; MLIR &#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4E0E;&#x524D;&#x6CBF;&#x7684;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x5DE5;&#x5177;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x3002;&#x5B83;&#x5305;&#x62EC;&#x4E00;&#x4E2A; C &#x548C; C++&#x524D;&#x7AEF;&#xFF0C;&#x80FD;&#x591F;&#x5C06;&#x5E7F;&#x6CDB;&#x73B0;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x9762;&#x4F53;&#x53D8;&#x6362;&#x7684; MLIR&#xFF0C;&#x5E76;&#x5B9E;&#x73B0; MLIR &#x4E0E; OpenScop &#x4EA4;&#x6362;&#x683C;&#x5F0F;&#x7684;&#x53CC;&#x5411;&#x8F6C;&#x6362;&#x3002;&#x5177;&#x6709;&#x9AD8;&#x7EA7;&#xFF08;&#x4EFF;&#x5C04;&#xFF09;&#x5FAA;&#x73AF;&#x6784;&#x9020;&#x548C;&#x5D4C;&#x5165;&#x5230;&#x5355;&#x4E2A;&#x9759;&#x6001;&#x8D4B;&#x503C;&#xFF08;SSA&#xFF09;&#x57FA;&#x5E95;&#x7684; Polygeist/MLIR &#x4E2D;&#x95F4;&#x8868;&#x793A;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x57FA;&#x4E8E; SSA &#x548C;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x7684;&#x524D;&#x6240;&#x672A;&#x6709;&#x7684;&#x7EC4;&#x5408;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x63D0;&#x51FA;&#x5E76;&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x8F6C;&#x6362;&#x6765;&#x5C55;&#x793A;&#x8FD9;&#x4E00;&#x70B9;&#xFF1A;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x548C;&#x51CF;&#x5C11;&#x5E76;&#x884C;&#x5316;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x8BC4;&#x4F30;&#x8868;&#x660E;&#xFF0C;&#x5728; Polybench/C &#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x5957;&#x4EF6;&#x4E0A;&#xFF0C;Polygeist &#x5728;&#x987A;&#x5E8F;&#xFF08;2.53 &#x500D; vs 1.41 &#x500D;&#xFF0C;2.34 &#x500D;&#xFF09;&#x548C;&#x5E76;&#x884C;&#x6A21;&#x5F0F;&#xFF08;9.47 &#x500D; vs 3.26 &#x500D;&#xFF0C;7.54 &#x500D;&#xFF09;&#x4E0A;&#x5E73;&#x5747;&#x4F18;&#x4E8E; LLVM IR &#x7EA7;&#x522B;&#x7684;&#x4F18;&#x5316;&#x5668;&#xFF08;Polly&#xFF09;&#x548C;&#x6E90;&#x5230;&#x6E90;&#x7684;&#x524D;&#x6CBF;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x5668;&#xFF08;Pluto&#xFF09;&#xFF0C;&#x8FD9;&#x5F97;&#x76CA;&#x4E8E;&#x65B0;&#x7684;&#x8868;&#x793A;&#x548C;&#x8F6C;&#x6362;&#x3002;</p>
<p><a href="https://wsmoses.com/academic/" target="_blank">William S. Moses</a></p>
<p><a href="https://www.youtube.com/watch?v=GF45kitd3nY" target="_blank">Polygeist: Affine C in MLIR [MLIR Open Design Meeting 02/11/2021]</a></p>
<p><a href="https://www.youtube.com/@billymoses7764" target="_blank">https://www.youtube.com/@billymoses7764</a></p>
<p><a href="https://polygeist.llvm.org/getting_started/Use_Polygeist/" target="_blank">getting_started/Use_Polygeist</a></p>
<p><a href="https://ieeexplore.ieee.org/document/10444828" target="_blank">Retargeting and Respecializing GPU Workloads for Performance Portability</a></p>
<p>&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x548C;&#x9488;&#x5BF9;&#x6027;&#x80FD;&#x53EF;&#x79FB;&#x690D;&#x6027;&#x91CD;&#x65B0;&#x4E13;&#x4E1A;&#x5316;&#x7684; GPU &#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;</p>
<p>In order to come close to peak performance, accelerators like GPUs require significant architecture-specific tuning that understand the availability of shared memory, parallelism, tensor cores, etc. Unfortunately, the pursuit of higher performance and lower costs have led to a significant diversification of architecture designs, even from the same vendor. This creates the need for performance portability across different GPUs, especially important for programs in a particular programming model with a certain architecture in mind. Even when the program can be seamlessly executed on a different architecture, it may suffer a performance penalty due to it not being sized appropriately to the available hardware resources such as fast memory and registers, let alone not using newer advanced features of the architecture. We propose a new approach to improving performance of (legacy) CUDA programs for modern machines by automatically adjusting the amount of work each parallel thread does, and the amount of memory and register resources it requires. By operating within the MLIR compiler infrastructure, we are able to also target AMD GPUs by performing automatic translation from CUDA and simultaneously adjust the program granularity to fit the size of target GPUs. Combined with autotuning assisted by the platform-specific compiler, our approach demonstrates 27% geomean speedup on the Rodinia benchmark suite over baseline CUDA implementation as well as performance parity between similar NVIDIA and AMD GPUs executing the same CUDA program.</p>
<p>&#x4E3A;&#x4E86;&#x63A5;&#x8FD1;&#x5CF0;&#x503C;&#x6027;&#x80FD;&#xFF0C;&#x50CF; GPU &#x8FD9;&#x6837;&#x7684;&#x52A0;&#x901F;&#x5668;&#x9700;&#x8981;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x67B6;&#x6784;&#x8FDB;&#x884C;&#x663E;&#x8457;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x8FD9;&#x4E9B;&#x8C03;&#x6574;&#x7406;&#x89E3;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x3001;&#x5E76;&#x884C;&#x6027;&#x3001;&#x5F20;&#x91CF;&#x6838;&#x5FC3;&#x7B49;&#x7684;&#x53EF;&#x7528;&#x6027;&#x3002;&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FFD;&#x6C42;&#x66F4;&#x9AD8;&#x7684;&#x6027;&#x80FD;&#x548C;&#x66F4;&#x4F4E;&#x7684;&#x6210;&#x672C;&#x5BFC;&#x81F4;&#x4E86;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#x7684;&#x663E;&#x8457;&#x591A;&#x6837;&#x5316;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4F9B;&#x5E94;&#x5546;&#x7684;&#x4EA7;&#x54C1;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;&#x8FD9;&#x4EA7;&#x751F;&#x4E86;&#x5728;&#x4E0D;&#x540C; GPU &#x4E4B;&#x95F4;&#x5B9E;&#x73B0;&#x6027;&#x80FD;&#x53EF;&#x79FB;&#x690D;&#x6027;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x7279;&#x5B9A;&#x7F16;&#x7A0B;&#x6A21;&#x578B;&#x548C;&#x7279;&#x5B9A;&#x67B6;&#x6784;&#x7684;&#x7A0B;&#x5E8F;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#x3002;&#x5373;&#x4F7F;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x67B6;&#x6784;&#x4E0A;&#x65E0;&#x7F1D;&#x6267;&#x884C;&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x80FD;&#x56E0;&#x4E3A;&#x672A;&#x9002;&#x5F53;&#x8C03;&#x6574;&#x4EE5;&#x9002;&#x5E94;&#x53EF;&#x7528;&#x7684;&#x786C;&#x4EF6;&#x8D44;&#x6E90;&#xFF08;&#x5982;&#x5FEB;&#x901F;&#x5185;&#x5B58;&#x548C;&#x5BC4;&#x5B58;&#x5668;&#xFF09;&#x800C;&#x906D;&#x53D7;&#x6027;&#x80FD;&#x635F;&#x5931;&#xFF0C;&#x66F4;&#x4E0D;&#x7528;&#x8BF4;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x67B6;&#x6784;&#x7684;&#x65B0;&#x5148;&#x8FDB;&#x7279;&#x6027;&#x3002;&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x4E86;&#x4E00;&#x79CD;&#x65B0;&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x81EA;&#x52A8;&#x8C03;&#x6574;&#x6BCF;&#x4E2A;&#x5E76;&#x884C;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x4EE5;&#x53CA;&#x5B83;&#x6240;&#x9700;&#x7684;&#x5185;&#x5B58;&#x548C;&#x5BC4;&#x5B58;&#x5668;&#x8D44;&#x6E90;&#xFF0C;&#x6765;&#x63D0;&#x9AD8;&#xFF08;&#x9057;&#x7559;&#xFF09;CUDA &#x7A0B;&#x5E8F;&#x5728;&#x73B0;&#x4EE3;&#x673A;&#x5668;&#x4E0A;&#x7684;&#x6027;&#x80FD;&#x3002; &#x901A;&#x8FC7;&#x5728; MLIR &#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4E2D;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x81EA;&#x52A8;&#x4ECE; CUDA &#x8FDB;&#x884C;&#x7FFB;&#x8BD1;&#x6765;&#x9488;&#x5BF9; AMD GPU &#x8FDB;&#x884C;&#x76EE;&#x6807;&#x5B9A;&#x4F4D;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x6574;&#x7A0B;&#x5E8F;&#x7C92;&#x5EA6;&#x4EE5;&#x9002;&#x5E94;&#x76EE;&#x6807; GPU &#x7684;&#x5927;&#x5C0F;&#x3002;&#x7ED3;&#x5408;&#x5E73;&#x53F0;&#x7279;&#x5B9A;&#x7F16;&#x8BD1;&#x5668;&#x8F85;&#x52A9;&#x7684;&#x81EA;&#x52A8;&#x8C03;&#x6574;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x65B9;&#x6CD5;&#x5728; Rodinia &#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x5957;&#x4EF6;&#x4E0A;&#x76F8;&#x5BF9;&#x4E8E;&#x57FA;&#x7EBF; CUDA &#x5B9E;&#x73B0;&#x5B9E;&#x73B0;&#x4E86; 27%&#x7684;&#x51E0;&#x4F55;&#x5E73;&#x5747;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#xFF0C;&#x4EE5;&#x53CA;&#x6267;&#x884C;&#x76F8;&#x540C; CUDA &#x7A0B;&#x5E8F;&#x65F6;&#x7C7B;&#x4F3C; NVIDIA &#x548C; AMD GPU &#x4E4B;&#x95F4;&#x7684;&#x6027;&#x80FD;&#x5BF9;&#x7B49;&#x3002;</p>
<p>Frontend Performance Differences</p>
<ul>
<li><p>8% performance boost on Floyd-Warshall occurs if Polygeist generates a single MLIR module for both benchmarking and timing code by default</p>
</li>
<li><p>MLIR doesn&apos;t properly generate LLVM datalayout, preventing vectorization for MLIR-generated code (patched in our lowering)</p>
</li>
<li><p>Different choice of allocation function can make a 30% impact on some tests (adi)</p>
</li>
<li><p>LLVM strength-reduction is fragile and sometimes misses reversed loop induction variable (remaining gap in adi)</p>
</li>
<li><p>&#x5982;&#x679C; Polygeist &#x9ED8;&#x8BA4;&#x4E3A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x548C;&#x8BA1;&#x65F6;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x5355;&#x4E2A; MLIR &#x6A21;&#x5757;&#xFF0C;&#x5219; Floyd-Warshall &#x7684;&#x6027;&#x80FD;&#x5C06;&#x63D0;&#x5347; 8%</p>
</li>
<li><p>MLIR &#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x751F;&#x6210; LLVM &#x6570;&#x636E;&#x5E03;&#x5C40;&#xFF0C;&#x4ECE;&#x800C;&#x963B;&#x6B62;&#x4E86; MLIR &#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x77E2;&#x91CF;&#x5316;&#xFF08;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x964D;&#x4F4E;&#x7248;&#x672C;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x4FEE;&#x8865;&#xFF09;</p>
</li>
<li><p>&#x4E0D;&#x540C;&#x7684;&#x5206;&#x914D;&#x51FD;&#x6570;&#x9009;&#x62E9;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x67D0;&#x4E9B;&#x6D4B;&#x8BD5; &#xFF08;adi&#xFF09; &#x4EA7;&#x751F; 30% &#x7684;&#x5F71;&#x54CD;</p>
</li>
<li><p>LLVM &#x5F3A;&#x5EA6;&#x964D;&#x4F4E;&#x5F88;&#x8106;&#x5F31;&#xFF0C;&#x6709;&#x65F6;&#x4F1A;&#x9519;&#x8FC7;&#x53CD;&#x5411;&#x73AF;&#x611F;&#x5E94;&#x53D8;&#x91CF;&#xFF08;ADI &#x4E2D;&#x7684;&#x5269;&#x4F59;&#x95F4;&#x9699;&#xFF09;</p>
</li>
</ul>
<h3 id="poligeist-mlir-compiler-frontend">Poligeist MLIR Compiler Frontend</h3>
<p>Polygeist &#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;
Polygeist &#x7684;&#x4E3B;&#x8981;&#x76EE;&#x6807;&#x662F; bridging the gap between C/C++ and MLIR&#x3002;&#x5B83;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x6838;&#x5FC3;&#x529F;&#x80FD;:</p>
<p>C/C++&#x524D;&#x7AEF;:&#x80FD;&#x591F;&#x89E3;&#x6790;&#x548C;&#x5206;&#x6790;&#x5E7F;&#x6CDB;&#x7684; C &#x548C; C++&#x4EE3;&#x7801;&#x3002;
MLIR &#x751F;&#x6210;:&#x5C06; C/C++&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x9002;&#x5408;&#x591A;&#x9762;&#x4F53;&#x53D8;&#x6362;&#x7684; MLIR &#x8868;&#x793A;&#x3002;
&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;:&#x5229;&#x7528; MLIR &#x7684;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x80FD;&#x529B;&#x8FDB;&#x884C;&#x9AD8;&#x7EA7;&#x5FAA;&#x73AF;&#x4F18;&#x5316;&#x3002;
&#x5E76;&#x884C;&#x4F18;&#x5316;:&#x652F;&#x6301;&#x81EA;&#x52A8;&#x5E76;&#x884C;&#x5316;&#x548C;&#x5E76;&#x884C;&#x6784;&#x9020;&#x7684;&#x4F18;&#x5316;&#x3002;
GPU &#x540E;&#x7AEF;&#x652F;&#x6301;:&#x5305;&#x62EC; CUDA &#x548C; ROCm &#x540E;&#x7AEF;,&#x5B9E;&#x73B0; GPU &#x52A0;&#x901F;&#x3002;
&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4F7F; Polygeist &#x6210;&#x4E3A;&#x8FDE;&#x63A5;&#x4F20;&#x7EDF; C/C++&#x4EE3;&#x7801;&#x548C;&#x73B0;&#x4EE3; MLIR &#x7F16;&#x8BD1;&#x67B6;&#x6784;&#x7684;&#x5173;&#x952E;&#x5DE5;&#x5177;&#x3002;</p>
<p>Polygeist &#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;
Polygeist &#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x7B80;&#x8981;&#x6982;&#x62EC;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;:</p>
<p>&#x89E3;&#x6790; C/C++&#x4EE3;&#x7801;:&#x4F7F;&#x7528; Clang &#x7684;&#x524D;&#x7AEF;&#x80FD;&#x529B;&#x89E3;&#x6790;&#x8F93;&#x5165;&#x7684; C/C++&#x4EE3;&#x7801;&#x3002;
AST &#x5206;&#x6790;:&#x5BF9;&#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;(AST)&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x5206;&#x6790;,&#x63D0;&#x53D6;&#x7A0B;&#x5E8F;&#x7684;&#x7ED3;&#x6784;&#x548C;&#x8BED;&#x4E49;&#x4FE1;&#x606F;&#x3002;
MLIR &#x751F;&#x6210;:&#x57FA;&#x4E8E; AST &#x5206;&#x6790;&#x7ED3;&#x679C;,&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684; MLIR &#x8868;&#x793A;&#x3002;
&#x591A;&#x9762;&#x4F53;&#x5EFA;&#x6A21;:&#x5C06; MLIR &#x8868;&#x793A;&#x8F6C;&#x6362;&#x4E3A;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;,&#x4E3A;&#x540E;&#x7EED;&#x4F18;&#x5316;&#x94FA;&#x5E73;&#x9053;&#x8DEF;&#x3002;
&#x4F18;&#x5316;&#x5E94;&#x7528;:&#x5E94;&#x7528;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x3001;&#x5E76;&#x884C;&#x4F18;&#x5316;&#x7B49;&#x9AD8;&#x7EA7;&#x4F18;&#x5316;&#x6280;&#x672F;&#x3002;
&#x4EE3;&#x7801;&#x751F;&#x6210;:&#x5C06;&#x4F18;&#x5316;&#x540E;&#x7684; MLIR &#x8F6C;&#x6362;&#x56DE; LLVM IR &#x6216;&#x76F4;&#x63A5;&#x751F;&#x6210;&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x3002;
&#x901A;&#x8FC7;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x6B65;&#x9AA4;,Polygeist &#x80FD;&#x591F;&#x5145;&#x5206;&#x5229;&#x7528; MLIR &#x7684;&#x5F3A;&#x5927;&#x529F;&#x80FD;,&#x540C;&#x65F6;&#x4FDD;&#x6301;&#x5BF9;&#x539F;&#x59CB; C/C++&#x4EE3;&#x7801;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x3002;</p>
<p>Polygeist &#x7684;&#x4F18;&#x52BF;&#x4E0E;&#x5E94;&#x7528;
Polygeist &#x4E3A; C/C++&#x7A0B;&#x5E8F;&#x5E26;&#x6765;&#x4E86;&#x8BF8;&#x591A;&#x4F18;&#x52BF;:</p>
<p>&#x9AD8;&#x7EA7;&#x4F18;&#x5316;:&#x901A;&#x8FC7;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;,&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x66F4;&#x590D;&#x6742;&#x548C;&#x6709;&#x6548;&#x7684;&#x5FAA;&#x73AF;&#x4F18;&#x5316;&#x3002;
&#x5E76;&#x884C;&#x5316;:&#x81EA;&#x52A8;&#x68C0;&#x6D4B;&#x548C;&#x5229;&#x7528;&#x5E76;&#x884C;&#x673A;&#x4F1A;,&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x3002;
&#x53EF;&#x79FB;&#x690D;&#x6027;:&#x901A;&#x8FC7; MLIR &#x8868;&#x793A;,&#x53EF;&#x4EE5;&#x66F4;&#x5BB9;&#x6613;&#x5730;&#x5C06;&#x7A0B;&#x5E8F;&#x79FB;&#x690D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x786C;&#x4EF6;&#x5E73;&#x53F0;&#x3002;
GPU &#x52A0;&#x901F;:&#x5185;&#x7F6E;&#x7684; CUDA &#x548C; ROCm &#x540E;&#x7AEF;&#x652F;&#x6301;,&#x7B80;&#x5316; GPU &#x7F16;&#x7A0B;&#x3002;
&#x4E0E; LLVM &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x96C6;&#x6210;:&#x4F5C;&#x4E3A; LLVM &#x9879;&#x76EE;&#x7684;&#x4E00;&#x90E8;&#x5206;,&#x53EF;&#x4EE5;&#x65E0;&#x7F1D;&#x96C6;&#x6210;&#x5230;&#x73B0;&#x6709;&#x7684; LLVM &#x5DE5;&#x5177;&#x94FE;&#x4E2D;&#x3002;
&#x8FD9;&#x4E9B;&#x4F18;&#x52BF;&#x4F7F; Polygeist &#x5728;&#x9AD8;&#x6027;&#x80FD;&#x8BA1;&#x7B97;&#x3001;&#x79D1;&#x5B66;&#x8BA1;&#x7B97;&#x3001;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B49;&#x9886;&#x57DF;&#x5177;&#x6709;&#x5E7F;&#x6CDB;&#x7684;&#x5E94;&#x7528;&#x524D;&#x666F;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x6848;&#x4F8B;
&#x4EE5;&#x4E0B;&#x662F; Polygeist &#x5728;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x6848;&#x4F8B;:</p>
<p>&#x79D1;&#x5B66;&#x8BA1;&#x7B97;&#x4F18;&#x5316;:&#x5728;&#x4E00;&#x4E2A;&#x5927;&#x89C4;&#x6A21;&#x6570;&#x503C;&#x6A21;&#x62DF;&#x9879;&#x76EE;&#x4E2D;,&#x4F7F;&#x7528; Polygeist &#x5BF9;&#x6838;&#x5FC3;&#x8BA1;&#x7B97; kernel &#x8FDB;&#x884C;&#x4F18;&#x5316;,&#x901A;&#x8FC7;&#x591A;&#x9762;&#x4F53;&#x53D8;&#x6362;&#x548C;&#x81EA;&#x52A8;&#x5E76;&#x884C;&#x5316;,&#x6027;&#x80FD;&#x63D0;&#x5347;&#x4E86; 30%&#x3002;</p>
<p>&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6846;&#x67B6;:&#x67D0;&#x5F00;&#x6E90;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6846;&#x67B6;&#x4F7F;&#x7528; Polygeist &#x4F18;&#x5316;&#x5176; C++&#x540E;&#x7AEF;,&#x5B9E;&#x73B0;&#x4E86;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x5F20;&#x91CF;&#x8FD0;&#x7B97;,&#x5728;&#x67D0;&#x4E9B;&#x6A21;&#x578B;&#x4E0A;&#x63A8;&#x7406;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#x4E86; 20%&#x3002;</p>
<p>&#x56FE;&#x5F62;&#x6E32;&#x67D3;&#x5F15;&#x64CE;:&#x4E00;&#x4E2A;&#x6E38;&#x620F;&#x5F15;&#x64CE;&#x9879;&#x76EE;&#x5229;&#x7528; Polygeist &#x7684; GPU &#x540E;&#x7AEF;&#x652F;&#x6301;,&#x7B80;&#x5316;&#x4E86; CUDA &#x4EE3;&#x7801;&#x7684;&#x751F;&#x6210;&#x8FC7;&#x7A0B;,&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x6848;&#x4F8B;&#x5C55;&#x793A;&#x4E86; Polygeist &#x5728;&#x63D0;&#x5347;&#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x548C;&#x7B80;&#x5316;&#x5F00;&#x53D1;&#x6D41;&#x7A0B;&#x65B9;&#x9762;&#x7684;&#x5DE8;&#x5927;&#x6F5C;&#x529B;&#x3002;</p>
<pre class="language-"><code class="lang-bash">cgeist input.c <span class="token parameter variable">-S</span> -emit-mlir <span class="token operator">|</span> mlir-opt <span class="token parameter variable">--canonicalize</span> <span class="token parameter variable">--cse</span> <span class="token operator">&gt;</span> output.mlir
</code></pre>
<h3 id="2022-llvmhpc-william-s-moses-polygeist-c-frontend-for-mlir">2022 LLVMHPC William S. Moses, Polygeist: C++ Frontend for MLIR</h3>
<p><a href="https://www.youtube.com/watch?v=LIHxtR4Hop4" target="_blank">text</a></p>
<h4 id="the-mlir-framework">The MLIR Framework</h4>
<ul>
<li>MLIR is a recent compiler infrastructure designed for reuse and extensibility</li>
<li>Rather than providing a predefined set of instructions and types, MLIR operates on collections of dialects that contain sets of interoperable user-defined operations, attributes and types</li>
<li>Anyone can define their own optimizable dialect/operation, with a large set of existing dialects (structured control flow, affine, GPU, quantum, fully homomorphic encryption, circuits, LLVM, and more!)</li>
<li>MLIR &#x662F;&#x4E00;&#x79CD;&#x4E3A;&#x91CD;&#x7528;&#x548C;&#x53EF;&#x6269;&#x5C55;&#x6027;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#x6700;&#x65B0;&#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x67B6;&#x6784;</li>
<li>MLIR &#x4E0D;&#x662F;&#x63D0;&#x4F9B;&#x4E00;&#x7EC4;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x6307;&#x4EE4;&#x548C;&#x7C7B;&#x578B;,&#x800C;&#x662F;&#x5BF9;&#x5305;&#x542B;&#x4E00;&#x7EC4;&#x53EF;&#x4E92;&#x64CD;&#x4F5C;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x64CD;&#x4F5C;&#x3001;&#x5C5E;&#x6027;&#x548C;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x8A00;&#x96C6;&#x5408;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</li>
<li>&#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5927;&#x91CF;&#x73B0;&#x6709;&#x65B9;&#x8A00;(&#x7ED3;&#x6784;&#x5316;&#x63A7;&#x5236;&#x6D41;&#x3001;&#x4EFF;&#x5C04;&#x3001;GPU&#x3001;&#x91CF;&#x5B50;&#x3001;&#x5B8C;&#x5168;&#x540C;&#x6001;&#x52A0;&#x5BC6;&#x3001;&#x7535;&#x8DEF;&#x3001;LLVM &#x7B49;!)&#x5B9A;&#x4E49;&#x81EA;&#x5DF1;&#x53EF;&#x4F18;&#x5316;&#x7684;&#x65B9;&#x8A00;/&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<h4 id="the-polyhedral-model">The Polyhedral Model</h4>
<ul>
<li>Represent programs as a collection of computations and constraints on a multi-dimensional grid (polyhedron)</li>
<li>Makes it easy to analyze and specify program transformations best exploit the available hardware</li>
<li>Loop restructuring for spatial/temporal locality, automatic parallelization, etc.</li>
<li>One of the best frameworks for optimizing compute-intensive programs like machine learning kernels or scientific simulations as well as for programming accelerators.</li>
</ul>
<h4 id="preserve-the-parallel-structure">Preserve the parallel structure</h4>
<ul>
<li>Maintain GPU parallelism in a form understandable to the compiler</li>
<li>Enables optimization between caller and kernel</li>
<li><p>Enable parallelism-specific optimization</p>
</li>
<li><p>&#x5C06;&#x7A0B;&#x5E8F;&#x8868;&#x793A;&#x4E3A;&#x591A;&#x7EF4;&#x7F51;&#x683C;(&#x591A;&#x9762;&#x4F53;)&#x4E0A;&#x7684;&#x8BA1;&#x7B97;&#x548C;&#x7EA6;&#x675F;&#x96C6;&#x5408;</p>
</li>
<li>&#x4FBF;&#x4E8E;&#x5206;&#x6790;&#x548C;&#x6307;&#x5B9A;&#x6700;&#x4F73;&#x5229;&#x7528;&#x53EF;&#x7528;&#x786C;&#x4EF6;&#x7684;&#x7A0B;&#x5E8F;&#x8F6C;&#x6362;</li>
<li>&#x7528;&#x4E8E;&#x7A7A;&#x95F4;/&#x65F6;&#x95F4;&#x5C40;&#x90E8;&#x6027;&#x3001;&#x81EA;&#x52A8;&#x5E76;&#x884C;&#x5316;&#x7B49;&#x7684;&#x5FAA;&#x73AF;&#x91CD;&#x6784;</li>
<li>&#x4F18;&#x5316;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x5185;&#x6838;&#x6216;&#x79D1;&#x5B66;&#x6A21;&#x62DF;&#x7B49;&#x8BA1;&#x7B97;&#x5BC6;&#x96C6;&#x578B;&#x7A0B;&#x5E8F;&#x4EE5;&#x53CA;&#x7F16;&#x7A0B;&#x52A0;&#x901F;&#x5668;&#x7684;&#x6700;&#x4F73;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;</li>
</ul>
<h4 id="synchronization-via-memory">Synchronization via Memory</h4>
<ul>
<li>Synchronization (sync_threads) ensures all threads within a block finish executing codeA before executing codeB</li>
<li>The desired synchronization behavior can be reproduced by defining sync_threads to have the union of the memory semantics of the code before and after the sync.</li>
<li><p>This prevents code motion of instructions which require the synchronization for correctness, but permits other code motion (e.g. index computation).</p>
</li>
<li><p>&#x540C;&#x6B65; &#xFF08;sync_threads&#xFF09; &#x786E;&#x4FDD;&#x5757;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x5728;&#x6267;&#x884C; CodeB &#x4E4B;&#x524D;&#x5B8C;&#x6210;&#x5BF9; CodeA &#x7684;&#x6267;&#x884C;</p>
</li>
<li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9A;&#x4E49; sync_threads &#x6765;&#x91CD;&#x73B0;&#x6240;&#x9700;&#x7684;&#x540C;&#x6B65;&#x884C;&#x4E3A;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x540C;&#x6B65;&#x4E4B;&#x524D;&#x548C;&#x4E4B;&#x540E;&#x5177;&#x6709;&#x4EE3;&#x7801;&#x7684;&#x5185;&#x5B58;&#x8BED;&#x4E49;&#x7684;&#x5E76;&#x96C6;&#x3002;</li>
<li><p>&#x8FD9;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x9700;&#x8981;&#x540C;&#x6B65;&#x4EE5;&#x786E;&#x4FDD;&#x6B63;&#x786E;&#x6027;&#x7684;&#x6307;&#x4EE4;&#x7684;&#x4EE3;&#x7801;&#x79FB;&#x52A8;&#xFF0C;&#x4F46;&#x5141;&#x8BB8;&#x5176;&#x4ED6;&#x4EE3;&#x7801;&#x79FB;&#x52A8;&#xFF08;&#x4F8B;&#x5982;&#x7D22;&#x5F15;&#x8BA1;&#x7B97;&#xFF09;&#x3002;</p>
</li>
<li><p>High-level synchronization representation enables new optimizations, like sync elimination.</p>
</li>
<li><p>A synchronize instruction is not needed if the set of read/writes before the sync don&#x2019;t conflict with the read/writes after the sync.</p>
</li>
<li><p>&#x9AD8;&#x7EA7;&#x540C;&#x6B65;&#x8868;&#x793A;&#x652F;&#x6301;&#x65B0;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x4F8B;&#x5982;&#x540C;&#x6B65;&#x6D88;&#x9664;&#x3002;</p>
</li>
<li>&#x5982;&#x679C;&#x540C;&#x6B65;&#x524D;&#x7684;&#x8BFB;/&#x5199;&#x96C6;&#x4E0E;&#x540C;&#x6B65;&#x540E;&#x7684;&#x8BFB;/&#x5199;&#x96C6;&#x4E0D;&#x51B2;&#x7A81;&#xFF0C;&#x5219;&#x4E0D;&#x9700;&#x8981; synchronize &#x6307;&#x4EE4;&#x3002;</li>
</ul>
<pre class="language-"><code class="lang-c++">__global__ void bpnn_layerforward(...) {
  __shared__ float node[HEIGHT];
  __shared__ float weights[HEIGHT][WIDTH];

  if ( tx == 0 )
    node[ty] = input[index_in] ;

  // Unnecessary Barrier #1
  // None of the read/writes below the sync
  //  (weights, hidden)
  // intersect with the read/writes above the sync
  //  (node, input)
  __syncthreads();

  // Unnecessary Store #1
  weights[ty][tx] = hidden[index];

  __syncthreads();
  // Unnecessary Load #1
  weights[ty][tx] = weights[ty][tx] * node[ty];
  // &#x2026;
}
</code></pre>
<h4 id="gpu-transpilation">GPU Transpilation</h4>
<ul>
<li>A unified representation of parallelism enables programs in one parallel architecture (e.g. CUDA) to be compiled to another (e.g. CPU/OpenMP)</li>
<li><strong>Most CPU backends do not have an equivalent block synchronization</strong></li>
<li>Efficiently lower a top-level synchronization by distributing the parallel for loop around the sync, and interchanging control flow</li>
</ul>
<pre class="language-"><code class="lang-llvm"><span class="token keyword">parallel_for</span> <span class="token variable">%i</span> <span class="token punctuation">=</span> <span class="token number">0</span> <span class="token keyword">to</span> N <span class="token punctuation">{</span>
  codeA<span class="token punctuation">(</span><span class="token variable">%i</span><span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token keyword">sync_threads</span><span class="token comment">;</span>
  codeB<span class="token punctuation">(</span><span class="token variable">%i</span><span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token punctuation">}</span>
<span class="token comment">; =&gt;</span>
<span class="token keyword">parallel_for</span> <span class="token variable">%i</span> <span class="token punctuation">=</span> <span class="token number">0</span> <span class="token keyword">to</span> N <span class="token punctuation">{</span>
  codeA<span class="token punctuation">(</span><span class="token variable">%i</span><span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">parallel_for</span> <span class="token variable">%i</span> <span class="token punctuation">=</span> <span class="token number">0</span> <span class="token keyword">to</span> N <span class="token punctuation">{</span>
  codeB<span class="token punctuation">(</span><span class="token variable">%i</span><span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="gpu-synchronization-lowering-control-flow">GPU Synchronization Lowering: Control Flow</h4>
<p>Synchronization within control flow (for, if, while, etc) can be lowered by splitting around the control flop and interchanging the parallelism.</p>
<pre class="language-"><code class="lang-c++">parallel_for %i = 0 to N {
  for %j = &#x2026; {
    codeB1(%i, %j);
    sync_threads;
    codeB2(%i, %j);
  }
}
; Interchange =&gt;
for %j = &#x2026; {
    parallel_for %i = 0 to N {
        codeB1(%i, %j);
        sync_threads;
        codeB2(%i, %j);
  }
}
; Split =&gt;
for %j = &#x2026; {
    parallel_for %i = 0 to N {
        codeB1(%i, %j);
    }
    parallel_for %i = 0 to N {
        codeB2(%i, %j);
    }
}
</code></pre>
<h4 id="gpu-transpilation-performance">GPU Transpilation Performance</h4>
<ul>
<li>CUDA programs transcompiled by Polygeist not only match the performance of handwritten OpenMP programs, but achieve a speedup!<ul>
<li>58% geomean speedup on Rodinia</li>
<li>2.7x geomean speedup on PyTorch versus built-in CPU backend (also using our MocCUDA compatibility layer)</li>
</ul>
</li>
</ul>
<p><img src="GPU_Transpilation_Performance.png" alt="GPU Transpilation Performance"></p>
<p><img src="GPU_Memory_Hierarchy.png" alt="GPU Memory Hierarchy"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../LearnMocCUDA/MocCUDA.html" class="navigation navigation-prev " aria-label="Previous page: Learn MocCUDA">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../LearnPolyhedralModel/Note.html" class="navigation navigation-next " aria-label="Next page: Learn Polyhedral Compilation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Learn Polygeist","level":"1.2.16","depth":2,"next":{"title":"Learn Polyhedral Compilation","level":"1.2.17","depth":2,"path":"Learn/LearnPolyhedralModel/Note.md","ref":"Learn/LearnPolyhedralModel/Note.md","articles":[]},"previous":{"title":"Learn MocCUDA","level":"1.2.15","depth":2,"path":"Learn/LearnMocCUDA/MocCUDA.md","ref":"Learn/LearnMocCUDA/MocCUDA.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-codeblock","-lunr","-search","search-pro","expandable-chapters","code","chapter-fold","splitter","github","-highlight","prism","prism-themes","theme-comscore","katex-pp"],"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"chapter-fold":{},"prism":{"lang":{"shell":"bash"},"css":["prism-themes/themes/prism-synthwave84.css"]},"github":{"url":"https://github.com/houhuawei23/Notes"},"splitter":{},"search-pro":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"prism-themes":{},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"katex-pp":{},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"Introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"cn","gitbook":"*","description":"This is such a great book!"},"file":{"path":"Learn/LearnPolygeist/Note.md","mtime":"2024-12-29T11:42:16.636Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-12-29T11:43:04.527Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

