
<!DOCTYPE HTML>
<html lang="cn" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original Â· Notes of hhw</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="houhuawei23">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex-pp/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Note.html" />
    
    
    <link rel="prev" href="2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../ConfigExamples/ConfigExamples.html">
            
                <a href="../../ConfigExamples/ConfigExamples.html">
            
                    
                    ConfigExamples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Git
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../Git/Github.html">
            
                <a href="../../Git/Github.html">
            
                    
                    Github
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../Git/git.html">
            
                <a href="../../Git/git.html">
            
                    
                    git
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Guides
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../Guides/Self-Cultivation-of-Programmers.html">
            
                <a href="../../Guides/Self-Cultivation-of-Programmers.html">
            
                    
                    Self-Cultivation-of-Programmers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Learn.html">
            
                <a href="../Learn.html">
            
                    
                    Learn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../LearnDrones/Note.html">
            
                <a href="../LearnDrones/Note.html">
            
                    
                    LearnDrones
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../LearnDrones/FastDrone-250.html">
            
                <a href="../LearnDrones/FastDrone-250.html">
            
                    
                    FastDrone-250
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" >
            
                <span>
            
                    
                    Planner
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.2.1" data-path="../LearnDrones/Planner/FastPlanner-2019.html">
            
                <a href="../LearnDrones/Planner/FastPlanner-2019.html">
            
                    
                    FastPlanner-2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.2" data-path="../LearnDrones/Planner/EGO-Swarm-2021.html">
            
                <a href="../LearnDrones/Planner/EGO-Swarm-2021.html">
            
                    
                    EGO-Swarm-2021
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.3" data-path="../LearnDrones/Planner/EGO-Planner-2020.html">
            
                <a href="../LearnDrones/Planner/EGO-Planner-2020.html">
            
                    
                    EGO-Planner-2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.4" data-path="../LearnDrones/Planner/Gradient-Based-Motion-Planning.html">
            
                <a href="../LearnDrones/Planner/Gradient-Based-Motion-Planning.html">
            
                    
                    Gradient-Based-Motion-Planning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.5" data-path="../LearnDrones/Planner/MicroFlyingRobots-2021.html">
            
                <a href="../LearnDrones/Planner/MicroFlyingRobots-2021.html">
            
                    
                    MicroFlyingRobots-2021
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.6" data-path="../LearnDrones/Planner/Distributed-Swarm-Trajectory-Opt-for-Formation-Flight-in-Dense-Envs-2022.html">
            
                <a href="../LearnDrones/Planner/Distributed-Swarm-Trajectory-Opt-for-Formation-Flight-in-Dense-Envs-2022.html">
            
                    
                    Distributed-Swarm-Trajectory-Opt-for-Formation-Flight-in-Dense-Envs-2022
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2.7" data-path="../LearnDrones/Planner/Robust-Efficient-Trajectory-Planning-for-Formation-Flight-in-Dense-Environments-2023.html">
            
                <a href="../LearnDrones/Planner/Robust-Efficient-Trajectory-Planning-for-Formation-Flight-in-Dense-Environments-2023.html">
            
                    
                    Robust-Efficient-Trajectory-Planning-for-Formation-Flight-in-Dense-Environments-2023
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" >
            
                <span>
            
                    
                    TaskAssignment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.3.1" data-path="../LearnDrones/TaskAssignment/">
            
                <a href="../LearnDrones/TaskAssignment/">
            
                    
                    index
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.2" data-path="../LearnDrones/TaskAssignment/2018.10-Should_We_Compete_or_Should_We_Cooperate_Applying_Game_Theory_to_Task_Allocation_in_Drone_Swarms.html">
            
                <a href="../LearnDrones/TaskAssignment/2018.10-Should_We_Compete_or_Should_We_Cooperate_Applying_Game_Theory_to_Task_Allocation_in_Drone_Swarms.html">
            
                    
                    2018.10 Should_We_Compete_or_Should_We_Cooperate_Applying_Game_Theory_to_Task_Allocation_in_Drone_Swarms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.3" data-path="../LearnDrones/TaskAssignment/2019.11-A_Mission_Planning_and_Task_Allocation_Framework_For_Multi-UAV_Swarm_Coordination.html">
            
                <a href="../LearnDrones/TaskAssignment/2019.11-A_Mission_Planning_and_Task_Allocation_Framework_For_Multi-UAV_Swarm_Coordination.html">
            
                    
                    2019 A Mission Planning and Task Allocation Framework For Multi-UAV Swarm Coordination
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.4" data-path="../LearnDrones/TaskAssignment/2020.08-Energy_Efficient_Task_Cooperation_for_Multi-UAV_Networks:_A_Coalition_Formation_Game_Approach.html">
            
                <a href="../LearnDrones/TaskAssignment/2020.08-Energy_Efficient_Task_Cooperation_for_Multi-UAV_Networks:_A_Coalition_Formation_Game_Approach.html">
            
                    
                    2020 Energy Efficient Task Cooperation for Multi-UAV Networks: A Coalition Formation Game Approach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.5" data-path="../LearnDrones/TaskAssignment/2022.06-Task_assignment_algorithms_for_unmanned_aerial_vehicle_networks_A_comprehensive_survey.html">
            
                <a href="../LearnDrones/TaskAssignment/2022.06-Task_assignment_algorithms_for_unmanned_aerial_vehicle_networks_A_comprehensive_survey.html">
            
                    
                    2022.06 Task_assignment_algorithms_for_unmanned_aerial_vehicle_networks_A_comprehensive_survey
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.6" data-path="../LearnDrones/TaskAssignment/2022.10-A_Survey_of_UAV_Swarm_Task_Allocation_Based_on_the_Perspective_of_Coalition_Formation.html">
            
                <a href="../LearnDrones/TaskAssignment/2022.10-A_Survey_of_UAV_Swarm_Task_Allocation_Based_on_the_Perspective_of_Coalition_Formation.html">
            
                    
                    2022.10 A Survey of UAV Swarm Task Allocation Based on the Perspective of Coalition Formation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.7" data-path="../LearnDrones/TaskAssignment/2024-Distributed_task_allocation_algorithm_for_heterogeneous_unmanned_aerial_vehic_swarm_based_on_coalition_formation_game.html">
            
                <a href="../LearnDrones/TaskAssignment/2024-Distributed_task_allocation_algorithm_for_heterogeneous_unmanned_aerial_vehic_swarm_based_on_coalition_formation_game.html">
            
                    
                    2024 Distributed_task_allocation_algorithm_for_heterogeneous_unmanned_aerial_vehic_swarm_based_on_coalition_formation_game
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3.8" data-path="../LearnDrones/TaskAssignment/2024.12-Application_of_Task_Allocation_Algorithms_in_Multi-UAV_Intelligent_Transportation_Systems_A_Critical_Review.html">
            
                <a href="../LearnDrones/TaskAssignment/2024.12-Application_of_Task_Allocation_Algorithms_in_Multi-UAV_Intelligent_Transportation_Systems_A_Critical_Review.html">
            
                    
                    2024.12 Application_of_Task_Allocation_Algorithms_in_Multi-UAV_Intelligent_Transportation_Systems_A_Critical_Review
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../LearnDrones/Ceres-Solver.html">
            
                <a href="../LearnDrones/Ceres-Solver.html">
            
                    
                    Ceres-Solver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="../LearnDrones/Eigen.html">
            
                <a href="../LearnDrones/Eigen.html">
            
                    
                    Eigen
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../GPU2CPU.html">
            
                <a href="../GPU2CPU.html">
            
                    
                    GPU2CPU
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../LearnAIMA/">
            
                <a href="../LearnAIMA/">
            
                    
                    LearnAIMA
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../LearnAIMA/Ch12.html">
            
                <a href="../LearnAIMA/Ch12.html">
            
                    
                    Ch12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../LearnAIMA/Ch13/Ch13.html">
            
                <a href="../LearnAIMA/Ch13/Ch13.html">
            
                    
                    Ch13
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.2.1" data-path="../LearnAIMA/Ch13/BayesianNetwork.html">
            
                <a href="../LearnAIMA/Ch13/BayesianNetwork.html">
            
                    
                    BayesianNetwork
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="../LearnAIMA/Ch18/Ch18.html">
            
                <a href="../LearnAIMA/Ch18/Ch18.html">
            
                    
                    Ch18
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" >
            
                <span>
            
                    
                    LearnCUDA
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="../LearnCUDA/APT-CUDA.html">
            
                <a href="../LearnCUDA/APT-CUDA.html">
            
                    
                    APT-CUDA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2" data-path="../LearnCUDA/CUDA.html">
            
                <a href="../LearnCUDA/CUDA.html">
            
                    
                    CUDA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.3" data-path="../LearnCUDA/CUDA_multi.html">
            
                <a href="../LearnCUDA/CUDA_multi.html">
            
                    
                    CUDA_multi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.4" data-path="../LearnCUDA/NCCL.html">
            
                <a href="../LearnCUDA/NCCL.html">
            
                    
                    NCCL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.5" data-path="../LearnCUDA/TensorCores.html">
            
                <a href="../LearnCUDA/TensorCores.html">
            
                    
                    TensorCores
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" >
            
                <span>
            
                    
                    LearnCV
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.5.1" data-path="../LearnCV/ComputerVisoin.html">
            
                <a href="../LearnCV/ComputerVisoin.html">
            
                    
                    ComputerVisoin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5.2" data-path="../LearnCV/OpenCV/OpenCV.html">
            
                <a href="../LearnCV/OpenCV/OpenCV.html">
            
                    
                    OpenCV
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6" >
            
                <span>
            
                    
                    LearnConda
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../LearnConda/ChangeBaseEnv.html">
            
                <a href="../LearnConda/ChangeBaseEnv.html">
            
                    
                    ChangeBaseEnv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../LearnConda/Conda.html">
            
                <a href="../LearnConda/Conda.html">
            
                    
                    Conda
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" >
            
                <span>
            
                    
                    LearnDocker
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.1" data-path="../LearnDocker/docker.html">
            
                <a href="../LearnDocker/docker.html">
            
                    
                    docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.8" >
            
                <span>
            
                    
                    LearnGPU2CPU-by-GPT
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.8.1" data-path="../LearnGPU2CPU-by-GPT/Note.html">
            
                <a href="../LearnGPU2CPU-by-GPT/Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.9" >
            
                <span>
            
                    
                    LearnGameDev
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.9.1" data-path="../LearnGameDev/Note.html">
            
                <a href="../LearnGameDev/Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.10" >
            
                <span>
            
                    
                    LearnGameTheory
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.10.1" data-path="../LearnGameTheory/CoalitionalGames.html">
            
                <a href="../LearnGameTheory/CoalitionalGames.html">
            
                    
                    CoalitionalGames
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10.2" data-path="../LearnGameTheory/GameTheory.html">
            
                <a href="../LearnGameTheory/GameTheory.html">
            
                    
                    GameTheory
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.11" >
            
                <span>
            
                    
                    LearnJinJia2
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.11.1" data-path="../LearnJinJia2/Jinjia2.html">
            
                <a href="../LearnJinJia2/Jinjia2.html">
            
                    
                    Jinjia2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.12" >
            
                <span>
            
                    
                    LearnLalrpop
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.12.1" data-path="../LearnLalrpop/Lalrpop.html">
            
                <a href="../LearnLalrpop/Lalrpop.html">
            
                    
                    Lalrpop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.13" >
            
                <span>
            
                    
                    LearnMLIR
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="../LearnMLIR/CodegenDialectOverview.html">
            
                <a href="../LearnMLIR/CodegenDialectOverview.html">
            
                    
                    CodegenDialectOverview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.2" data-path="../LearnMLIR/Dialects.html">
            
                <a href="../LearnMLIR/Dialects.html">
            
                    
                    Dialects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.3" data-path="../LearnMLIR/Linalg.html">
            
                <a href="../LearnMLIR/Linalg.html">
            
                    
                    Linalg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.4" data-path="../LearnMLIR/MLIR-LanRef.html">
            
                <a href="../LearnMLIR/MLIR-LanRef.html">
            
                    
                    MLIR-LanRef
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13.5" data-path="../LearnMLIR/PIR.html">
            
                <a href="../LearnMLIR/PIR.html">
            
                    
                    PIR
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.14" >
            
                <span>
            
                    
                    LearnMocCUDA
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.14.1" data-path="../LearnMocCUDA/CUDA-Wrap.html">
            
                <a href="../LearnMocCUDA/CUDA-Wrap.html">
            
                    
                    CUDA-Wrap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.2" data-path="../LearnMocCUDA/LibBlocksRuntime.html">
            
                <a href="../LearnMocCUDA/LibBlocksRuntime.html">
            
                    
                    LibBlocksRuntime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.3" data-path="../LearnMocCUDA/LibDispatch.html">
            
                <a href="../LearnMocCUDA/LibDispatch.html">
            
                    
                    LibDispatch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.4" data-path="../LearnMocCUDA/LibUnwind.html">
            
                <a href="../LearnMocCUDA/LibUnwind.html">
            
                    
                    LibUnwind
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.5" data-path="../LearnMocCUDA/MakefileNote.html">
            
                <a href="../LearnMocCUDA/MakefileNote.html">
            
                    
                    MakefileNote
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.6" data-path="../LearnMocCUDA/MocCUDA.html">
            
                <a href="../LearnMocCUDA/MocCUDA.html">
            
                    
                    MocCUDA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.7" data-path="../LearnMocCUDA/OpenBLAS.html">
            
                <a href="../LearnMocCUDA/OpenBLAS.html">
            
                    
                    OpenBLAS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.8" data-path="../LearnMocCUDA/OpenMPI.html">
            
                <a href="../LearnMocCUDA/OpenMPI.html">
            
                    
                    OpenMPI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.9" data-path="../LearnMocCUDA/Spack.html">
            
                <a href="../LearnMocCUDA/Spack.html">
            
                    
                    Spack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.10" data-path="../LearnMocCUDA/pytorch.needed.libs.Note.html">
            
                <a href="../LearnMocCUDA/pytorch.needed.libs.Note.html">
            
                    
                    pytorch.needed.libs.Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.15" >
            
                <span>
            
                    
                    LearnMordenCpp
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.15.1" data-path="../LearnMordenCpp/Note.html">
            
                <a href="../LearnMordenCpp/Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.16" >
            
                <span>
            
                    
                    LearnPest
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.16.1" data-path="../LearnPest/ParsingExpressionGrammar.html">
            
                <a href="../LearnPest/ParsingExpressionGrammar.html">
            
                    
                    ParsingExpressionGrammar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16.2" data-path="../LearnPest/pest.html">
            
                <a href="../LearnPest/pest.html">
            
                    
                    pest
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.17" >
            
                <span>
            
                    
                    LearnPolygeist
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.17.1" data-path="2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.html">
            
                <a href="2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.html">
            
                    
                    2021_Polygeist-Raising C to Polyhedral MLIR-translated_only
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.17.2" data-path="2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original.html">
            
                <a href="2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original.html">
            
                    
                    2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17.3" data-path="Note.html">
            
                <a href="Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.18" >
            
                <span>
            
                    
                    LearnPolyhedralModel
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.18.1" data-path="../LearnPolyhedralModel/AffineTransformation.html">
            
                <a href="../LearnPolyhedralModel/AffineTransformation.html">
            
                    
                    AffineTransformation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18.2" data-path="../LearnPolyhedralModel/Note.html">
            
                <a href="../LearnPolyhedralModel/Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.19" >
            
                <span>
            
                    
                    LearnROCm
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.19.1" data-path="../LearnROCm/ROCm.html">
            
                <a href="../LearnROCm/ROCm.html">
            
                    
                    ROCm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.20" >
            
                <span>
            
                    
                    LearnROS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.20.1" data-path="../LearnROS/ROS-Packages.html">
            
                <a href="../LearnROS/ROS-Packages.html">
            
                    
                    ROS-Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20.2" data-path="../LearnROS/ROS.html">
            
                <a href="../LearnROS/ROS.html">
            
                    
                    ROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20.3" data-path="../LearnROS/ROS2.html">
            
                <a href="../LearnROS/ROS2.html">
            
                    
                    ROS2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20.4" data-path="../LearnROS/ROS2_debian12.html">
            
                <a href="../LearnROS/ROS2_debian12.html">
            
                    
                    ROS2_debian12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20.5" data-path="../LearnROS/SourceInstall.html">
            
                <a href="../LearnROS/SourceInstall.html">
            
                    
                    SourceInstall
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.21" >
            
                <span>
            
                    
                    LearnRust
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.21.1" data-path="../LearnRust/LifetimeExample.html">
            
                <a href="../LearnRust/LifetimeExample.html">
            
                    
                    LifetimeExample
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21.2" data-path="../LearnRust/Problems_Solutions.html">
            
                <a href="../LearnRust/Problems_Solutions.html">
            
                    
                    Problems_Solutions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21.3" data-path="../LearnRust/Resources.html">
            
                <a href="../LearnRust/Resources.html">
            
                    
                    Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21.4" data-path="../LearnRust/RustBook.html">
            
                <a href="../LearnRust/RustBook.html">
            
                    
                    RustBook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21.5" data-path="../LearnRust/RustLanRef.html">
            
                <a href="../LearnRust/RustLanRef.html">
            
                    
                    RustLanRef
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21.6" data-path="../LearnRust/RustProgrammingLanguage.html">
            
                <a href="../LearnRust/RustProgrammingLanguage.html">
            
                    
                    RustProgrammingLanguage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.22" >
            
                <span>
            
                    
                    PersonalWebsite
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.22.1" data-path="../PersonalWebsite/Jekyll.html">
            
                <a href="../PersonalWebsite/Jekyll.html">
            
                    
                    Jekyll
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.22.2" data-path="../PersonalWebsite/Note.html">
            
                <a href="../PersonalWebsite/Note.html">
            
                    
                    Note
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.22.3" data-path="../PersonalWebsite/Ruby.html">
            
                <a href="../PersonalWebsite/Ruby.html">
            
                    
                    Ruby
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.22.4" data-path="../PersonalWebsite/al-folio.html">
            
                <a href="../PersonalWebsite/al-folio.html">
            
                    
                    al-folio
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../Linux/Linux.html">
            
                <a href="../../Linux/Linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../Linux/Display/Display.html">
            
                <a href="../../Linux/Display/Display.html">
            
                    
                    Display
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../../Linux/Display/GNOME-Default.html">
            
                <a href="../../Linux/Display/GNOME-Default.html">
            
                    
                    GNOME-Default
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../../Linux/Display/Hyprland.html">
            
                <a href="../../Linux/Display/Hyprland.html">
            
                    
                    Hyprland
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../../Linux/Display/Wayland.html">
            
                <a href="../../Linux/Display/Wayland.html">
            
                    
                    Wayland
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../Linux/Flashback.html">
            
                <a href="../../Linux/Flashback.html">
            
                    
                    Flashback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../Linux/InputMethod.html">
            
                <a href="../../Linux/InputMethod.html">
            
                    
                    InputMethod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../Linux/LSB.html">
            
                <a href="../../Linux/LSB.html">
            
                    
                    LSB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../Linux/LinuxFamily/LinuxFamily.html">
            
                <a href="../../Linux/LinuxFamily/LinuxFamily.html">
            
                    
                    LinuxFamily
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../../Linux/LinuxFamily/ArchLinux.html">
            
                <a href="../../Linux/LinuxFamily/ArchLinux.html">
            
                    
                    ArchLinux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.2" data-path="../../Linux/LinuxFamily/DebianFamily.html">
            
                <a href="../../Linux/LinuxFamily/DebianFamily.html">
            
                    
                    DebianFamily
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.3" data-path="../../Linux/LinuxFamily/GentooLinux.html">
            
                <a href="../../Linux/LinuxFamily/GentooLinux.html">
            
                    
                    GentooLinux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.4" data-path="../../Linux/LinuxFamily/RedHatFamily.html">
            
                <a href="../../Linux/LinuxFamily/RedHatFamily.html">
            
                    
                    RedHatFamily
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../Linux/Nautilus.html">
            
                <a href="../../Linux/Nautilus.html">
            
                    
                    Nautilus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../Linux/PrintingDrivers.html">
            
                <a href="../../Linux/PrintingDrivers.html">
            
                    
                    PrintingDrivers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../Linux/UserManagement.html">
            
                <a href="../../Linux/UserManagement.html">
            
                    
                    UserManagement
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../Linux/apt.html">
            
                <a href="../../Linux/apt.html">
            
                    
                    apt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../../Linux/curl.html">
            
                <a href="../../Linux/curl.html">
            
                    
                    curl
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../Misc/Misc.html">
            
                <a href="../../Misc/Misc.html">
            
                    
                    Misc
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../Misc/00_Links.html">
            
                <a href="../../Misc/00_Links.html">
            
                    
                    00_Links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../Misc/01_GitHubReps.html">
            
                <a href="../../Misc/01_GitHubReps.html">
            
                    
                    01_GitHubReps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../Misc/Bochs.html">
            
                <a href="../../Misc/Bochs.html">
            
                    
                    Bochs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../Misc/Compression.html">
            
                <a href="../../Misc/Compression.html">
            
                    
                    Compression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../../Misc/ComputationForcePlatforms.html">
            
                <a href="../../Misc/ComputationForcePlatforms.html">
            
                    
                    ComputationForcePlatforms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../../Misc/Copy.html">
            
                <a href="../../Misc/Copy.html">
            
                    
                    Copy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../../Misc/Drawing.html">
            
                <a href="../../Misc/Drawing.html">
            
                    
                    Drawing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../../Misc/Flatpack.html">
            
                <a href="../../Misc/Flatpack.html">
            
                    
                    Flatpack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../../Misc/Fonts.html">
            
                <a href="../../Misc/Fonts.html">
            
                    
                    Fonts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../../Misc/FuzzTesting/FuzzTesting.html">
            
                <a href="../../Misc/FuzzTesting/FuzzTesting.html">
            
                    
                    FuzzTesting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.10.1" data-path="../../Misc/FuzzTesting/AFL.RS.html">
            
                <a href="../../Misc/FuzzTesting/AFL.RS.html">
            
                    
                    AFL.RS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10.2" data-path="../../Misc/FuzzTesting/Issues_Solutions.html">
            
                <a href="../../Misc/FuzzTesting/Issues_Solutions.html">
            
                    
                    Issues_Solutions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../../Misc/GIS/GIS.html">
            
                <a href="../../Misc/GIS/GIS.html">
            
                    
                    GIS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.11.1" data-path="../../Misc/GIS/OpenShp.html">
            
                <a href="../../Misc/GIS/OpenShp.html">
            
                    
                    OpenShp
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../../Misc/GRUB.html">
            
                <a href="../../Misc/GRUB.html">
            
                    
                    GRUB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../../Misc/GitBook.html">
            
                <a href="../../Misc/GitBook.html">
            
                    
                    GitBook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../../Misc/Hyper-V.html">
            
                <a href="../../Misc/Hyper-V.html">
            
                    
                    Hyper-V
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../../Misc/LLVM.html">
            
                <a href="../../Misc/LLVM.html">
            
                    
                    LLVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.16" data-path="../../Misc/Logics.html">
            
                <a href="../../Misc/Logics.html">
            
                    
                    Logics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.17" data-path="../../Misc/Markdown.html">
            
                <a href="../../Misc/Markdown.html">
            
                    
                    Markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.18" data-path="../../Misc/MemoryOrder.html">
            
                <a href="../../Misc/MemoryOrder.html">
            
                    
                    MemoryOrder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.19" data-path="../../Misc/NPM.html">
            
                <a href="../../Misc/NPM.html">
            
                    
                    NPM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.20" data-path="../../Misc/PowerShell.html">
            
                <a href="../../Misc/PowerShell.html">
            
                    
                    PowerShell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.21" data-path="../../Misc/RegularExp.html">
            
                <a href="../../Misc/RegularExp.html">
            
                    
                    RegularExp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.22" data-path="../../Misc/StorageTechs.html">
            
                <a href="../../Misc/StorageTechs.html">
            
                    
                    StorageTechs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.23" data-path="../../Misc/TWRP.html">
            
                <a href="../../Misc/TWRP.html">
            
                    
                    TWRP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.24" >
            
                <span>
            
                    
                    TimeSeriesPrediction
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.24.1" data-path="../../Misc/TimeSeriesPrediction/ACF.html">
            
                <a href="../../Misc/TimeSeriesPrediction/ACF.html">
            
                    
                    ACF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.24.2" data-path="../../Misc/TimeSeriesPrediction/ACF_vs_PACF.html">
            
                <a href="../../Misc/TimeSeriesPrediction/ACF_vs_PACF.html">
            
                    
                    ACF_vs_PACF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.24.3" data-path="../../Misc/TimeSeriesPrediction/ARIMA.html">
            
                <a href="../../Misc/TimeSeriesPrediction/ARIMA.html">
            
                    
                    ARIMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.24.4" data-path="../../Misc/TimeSeriesPrediction/PACF.html">
            
                <a href="../../Misc/TimeSeriesPrediction/PACF.html">
            
                    
                    PACF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.25" data-path="../../Misc/Typst.html">
            
                <a href="../../Misc/Typst.html">
            
                    
                    Typst
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.26" data-path="../../Misc/VScode.html">
            
                <a href="../../Misc/VScode.html">
            
                    
                    VScode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.27" data-path="../../Misc/Vitural-Card.html">
            
                <a href="../../Misc/Vitural-Card.html">
            
                    
                    Vitural-Card
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.28" data-path="../../Misc/WSL.html">
            
                <a href="../../Misc/WSL.html">
            
                    
                    WSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../Network/Network.html">
            
                <a href="../../Network/Network.html">
            
                    
                    Network
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../Network/ChangeMac.html">
            
                <a href="../../Network/ChangeMac.html">
            
                    
                    ChangeMac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../../Network/DNS.html">
            
                <a href="../../Network/DNS.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../../Network/RandomMac.html">
            
                <a href="../../Network/RandomMac.html">
            
                    
                    RandomMac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../../Network/Tailscale.html">
            
                <a href="../../Network/Tailscale.html">
            
                    
                    Tailscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../../Network/Wifi.html">
            
                <a href="../../Network/Wifi.html">
            
                    
                    Wifi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../Papers/Papers.html">
            
                <a href="../../Papers/Papers.html">
            
                    
                    Papers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../Papers/AttentionIsTuringComplete.html">
            
                <a href="../../Papers/AttentionIsTuringComplete.html">
            
                    
                    AttentionIsTuringComplete
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../../Papers/Spatially varying nanophotonic neural networks.html">
            
                <a href="../../Papers/Spatially varying nanophotonic neural networks.html">
            
                    
                    Spatially varying nanophotonic neural networks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../Programming/Programming.html">
            
                <a href="../../Programming/Programming.html">
            
                    
                    Programming
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../Programming/CRTP.html">
            
                <a href="../../Programming/CRTP.html">
            
                    
                    CRTP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../PythonLibs/PythonLibs.html">
            
                <a href="../../PythonLibs/PythonLibs.html">
            
                    
                    PythonLibs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../../PythonLibs/ArgParse.html">
            
                <a href="../../PythonLibs/ArgParse.html">
            
                    
                    ArgParse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../../PythonLibs/AsyncSSH.html">
            
                <a href="../../PythonLibs/AsyncSSH.html">
            
                    
                    AsyncSSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../../PythonLibs/Dask.html">
            
                <a href="../../PythonLibs/Dask.html">
            
                    
                    Dask
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" >
            
                <span>
            
                    
                    Dlib
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.4.1" data-path="../../PythonLibs/Dlib/DlibPythonBindings.html">
            
                <a href="../../PythonLibs/Dlib/DlibPythonBindings.html">
            
                    
                    DlibPythonBindings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11.5" >
            
                <span>
            
                    
                    LearnPyQt5
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.5.1" data-path="../../PythonLibs/LearnPyQt5/PyQt5.html">
            
                <a href="../../PythonLibs/LearnPyQt5/PyQt5.html">
            
                    
                    PyQt5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5.2" data-path="../../PythonLibs/LearnPyQt5/QtStyleSheets.html">
            
                <a href="../../PythonLibs/LearnPyQt5/QtStyleSheets.html">
            
                    
                    QtStyleSheets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../../ReadingNotes/ReadingNotes.html">
            
                <a href="../../ReadingNotes/ReadingNotes.html">
            
                    
                    ReadingNotes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../../ReadingNotes/A_Brief_History_of_Humankind.html">
            
                <a href="../../ReadingNotes/A_Brief_History_of_Humankind.html">
            
                    
                    A_Brief_History_of_Humankind
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../../ReadingNotes/Feynman.html">
            
                <a href="../../ReadingNotes/Feynman.html">
            
                    
                    Feynman
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../../ReadingNotes/math_philosiphy.html">
            
                <a href="../../ReadingNotes/math_philosiphy.html">
            
                    
                    math_philosiphy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../../ReadingNotes/philosiphy.html">
            
                <a href="../../ReadingNotes/philosiphy.html">
            
                    
                    philosiphy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../../ReadingNotes/ç ç©¶ä¸å­¦é£-å¼ ç³åº-1948.html">
            
                <a href="../../ReadingNotes/ç ç©¶ä¸å­¦é£-å¼ ç³åº-1948.html">
            
                    
                    ç ç©¶ä¸å­¦é£-å¼ ç³åº-1948
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" >
            
                <span>
            
                    
                    è®¡ç®ä¹é­-å´å
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.6.1" data-path="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp0.html">
            
                <a href="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp0.html">
            
                    
                    cp0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6.2" data-path="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp1.html">
            
                <a href="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp1.html">
            
                    
                    cp1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6.3" data-path="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp2.html">
            
                <a href="../../ReadingNotes/è®¡ç®ä¹é­-å´å/cp2.html">
            
                    
                    cp2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6.4" data-path="../../ReadingNotes/è®¡ç®ä¹é­-å´å/">
            
                <a href="../../ReadingNotes/è®¡ç®ä¹é­-å´å/">
            
                    
                    index
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../../ReadingNotes/è®ºéå¹´ä¿®å»-å¼ ç³åº-1946.html">
            
                <a href="../../ReadingNotes/è®ºéå¹´ä¿®å»-å¼ ç³åº-1946.html">
            
                    
                    è®ºéå¹´ä¿®å»-å¼ ç³åº-1946
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../../ReadingNotes/è®ºéå¹´çä¿®å»-å¼ é»å¤©-1938.html">
            
                <a href="../../ReadingNotes/è®ºéå¹´çä¿®å»-å¼ é»å¤©-1938.html">
            
                    
                    è®ºéå¹´çä¿®å»-å¼ é»å¤©-1938
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.9" data-path="../../ReadingNotes/è¯­å½-æ¯æ³½ä¸.html">
            
                <a href="../../ReadingNotes/è¯­å½-æ¯æ³½ä¸.html">
            
                    
                    è¯­å½-æ¯æ³½ä¸
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.10" data-path="../../ReadingNotes/éå¹´å¨éæ©èä¸æ¶çèè-é©¬åæ-1835.html">
            
                <a href="../../ReadingNotes/éå¹´å¨éæ©èä¸æ¶çèè-é©¬åæ-1835.html">
            
                    
                    éå¹´å¨éæ©èä¸æ¶çèè-é©¬åæ-1835
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="gpt-academic-report">GPT-Academic Report</h1>
<h2 id="title"># Title:</h2>
<p>Polygeist: Raising C to Polyhedral MLIR</p>
<h2 id="abstract"># Abstract:</h2>
<p>We present Polygeist, a new compilation flow that connects the MLIR compiler infrastructure to cutting edge polyhedral optimization tools. It consists of a C and C++ frontend capable of converting a broad range of existing codes into MLIR suitable for polyhedral transformation and a bi-directional conversion between MLIR and OpenScop exchange format. The Polygeist/MLIR intermediate representation featuring high-level (affine) loop constructs and n-D arrays embedded into a single static assignment (SSA) substrate enables an unprecedented combination of SSA-based and polyhedral optimizations. We illustrate this by proposing and implementing two extra transformations: statement splitting and reduction parallelization. Our evaluation demonstrates that Polygeist outperforms on average both an LLVM IR-level optimizer (Polly) and a source-to-source state-of-the-art polyhedral compiler (Pluto) when exercised on the Polybench/C benchmark suite in sequential (2.53x vs 1.41x, 2.34x) and parallel mode (9.47x vs 3.26x, 7.54x) thanks to the new representation and transformations.</p>
<h2 id="meta-translation"># Meta Translation</h2>
<p>&#x6807;&#x9898;&#xFF1A;Polygeist: &#x5C06;C&#x63D0;&#x5347;&#x5230;&#x591A;&#x9762;&#x4F53;MLIR</p>
<p>&#x6458;&#x8981;&#xFF1A;&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x4E86;Polygeist&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#xFF0C;&#x65E8;&#x5728;&#x5C06;MLIR&#x7F16;&#x8BD1;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4E0E;&#x524D;&#x6CBF;&#x7684;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x5DE5;&#x5177;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x3002;&#x5B83;&#x5305;&#x62EC;&#x4E00;&#x4E2A;C&#x548C;C++&#x524D;&#x7AEF;&#xFF0C;&#x80FD;&#x591F;&#x5C06;&#x5E7F;&#x6CDB;&#x7684;&#x73B0;&#x6709;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x9002;&#x5408;&#x591A;&#x9762;&#x4F53;&#x53D8;&#x6362;&#x7684;MLIR&#xFF0C;&#x5E76;&#x5B9E;&#x73B0;MLIR&#x4E0E;OpenScop&#x4EA4;&#x6362;&#x683C;&#x5F0F;&#x4E4B;&#x95F4;&#x7684;&#x53CC;&#x5411;&#x8F6C;&#x6362;&#x3002;Polygeist/MLIR&#x4E2D;&#x95F4;&#x8868;&#x793A;&#x5177;&#x5907;&#x9AD8;&#x5C42;&#xFF08;&#x4EFF;&#x5C04;&#xFF09;&#x5FAA;&#x73AF;&#x6784;&#x9020;&#x548C;&#x5D4C;&#x5165;&#x5230;&#x5355;&#x4E00;&#x9759;&#x6001;&#x8D4B;&#x503C;&#xFF08;SSA&#xFF09;&#x57FA;&#x7840;&#x7ED3;&#x6784;&#x4E2D;&#x7684;n&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x524D;&#x6240;&#x672A;&#x6709;&#x7684;SSA&#x57FA;&#x7840;&#x548C;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x7684;&#x7ED3;&#x5408;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x63D0;&#x51FA;&#x548C;&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;&#x989D;&#x5916;&#x53D8;&#x6362;&#xFF1A;&#x8BED;&#x53E5;&#x5206;&#x5272;&#x548C;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#xFF0C;&#x6765;&#x8BC1;&#x660E;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x8BC4;&#x4F30;&#x8868;&#x660E;&#xFF0C;Polygeist&#x5728;Polybench/C&#x57FA;&#x51C6;&#x5957;&#x4EF6;&#x7684;&#x987A;&#x5E8F;&#x6A21;&#x5F0F;&#xFF08;2.53x&#x5BF9;&#x6BD4;1.41x&#xFF0C;2.34x&#xFF09;&#x548C;&#x5E76;&#x884C;&#x6A21;&#x5F0F;&#xFF08;9.47x&#x5BF9;&#x6BD4;3.26x&#xFF0C;7.54x&#xFF09;&#x4E0A;&#x7684;&#x8868;&#x73B0;&#x5E73;&#x5747;&#x4F18;&#x4E8E;LLVM IR&#x7EA7;&#x522B;&#x4F18;&#x5316;&#x5668;&#xFF08;Polly&#xFF09;&#x548C;&#x5148;&#x8FDB;&#x7684;&#x6E90;&#x5230;&#x6E90;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x5668;&#xFF08;Pluto&#xFF09;&#xFF0C;&#x8FD9;&#x5F97;&#x76CA;&#x4E8E;&#x65B0;&#x7684;&#x8868;&#x793A;&#x548C;&#x53D8;&#x6362;&#x3002;</p>
<h2 id="i-introduction"># I. INTRODUCTION</h2>
<p>Improving the efficiency of computation has always been one of the prime goals of computing. Program performance can be improved significantly by reaping the benefits of parallelism, temporal and spatial locality, and other performance sources. Relevant program transformations are particularly tedious and challenging when targeting modern multicore CPUs and GPUs with deep memory hierarchies and parallelism, and are often performed automatically by optimizing compilers.
The polyhedral model enables precise analyses and a relatively easy specification of transformations (loop restructuring, automatic parallelization, etc.) that take advantage of hardware performance sources. As a result, there is growing evidence that the polyhedral model is one of the best frameworks for efficient transformation of compute-intensive programs [1], [2], [3], and for programming accelerator architectures [4], [5], [6]. Consequently, the compiler community has focused on building tools that identify and optimize parts of the program that can be represented within the polyhedral model (commonly referred to as static-control parts, or SCoP&apos;s). Such tools tend to fall into two categories.
Compiler-based tools like Polly [7] and Graphite [8] detect and transform SCoPs in compiler intermediate representations (IRs). While this offers seamless integration with rest of the compiler, the lack of high-level structure and information hinders the tools&apos; ability to perform analyses and transformations. This structure needs to be recovered from optimized IR, often Fig. 1. The Polygeist compilation flow consists of 4 stages. The frontend traverses Clang AST to emit MLIR SCF dialect (Section III-A), which is raised to the Affine dialect and pre-optimized (Section III-B). The IR is then processed by a polyhedral scheduler (Sections III-C,III-D) before postoptimization and parallelization (Section III-E). Finally, it is translated to LLVM IR for further optimization and binary generation by LLVM. imperfectly or at a significant cost [9]. Moreover, common compiler optimizations such as LICM may interfere with the process [10]. Finally, low-level IRs often lack constructs for, e.g., parallelism or reductions, produced by the transformation, which makes the flow more complex.
Source-to-source compilers such as Pluto [11], POCC [12] and PPCG [5] operate directly on C or C++ code. While this can effectively leverage the high-level information from source code, the effectiveness of such tools is often reduced by the lack of enabling optimizations such as those converting hazardous memory loads into single-assignment virtual registers. Furthermore, the transformation results must be expressed in C, which is known to be complex [13], [14] and is also missing constructs for, e.g., reduction loops or register values not backed by memory storage.
This paper proposes and evaluates the benefits of a polyhedral compilation flow, Polygeist (Figure 1), that can leverage both the high-level structure available in source code and the fine-grained control of compiler optimization provided by lowlevel IRs. It builds on the recent MLIR compiler infrastructure that allows the interplay of multiple abstraction levels within the same representation, during the same transformations [15]. Intermixable MLIR abstractions, or dialects, include highlevel constructs such as loops, parallel and reduction patterns; low-level representations fully covering LLVM IR [16]; and a polyhedral-inspired representation featuring loops and memory accesses annotated with affine expressions. Moreover, by combining the best of source-level and IR-level tools in an end-to-end polyhedral flow, Polygeist preserves high-level information and leverages them to perform new or improved %result = &quot;dialect.operation&quot;(%operand, %operand) {attribute = #dialect&lt;&quot;value&quot;&gt;} ({ // Inside a nested region. ^basic_block(%block_argument: !dialect.type):
&quot;another.operation&quot;() : () -&gt; () }) : (!dialect.type) -&gt; !dialect.result_type Fig. 2. Generic MLIR syntax for an operation with two operands, one result, one attribute and a single-block region.
optimizations, such as statement splitting and loop-carried value detection, on a lower-level abstraction as well as to influence downstream optimizations.
We make the following contributions:
&#x2022; a C and C++ frontend for MLIR that preserves high-level loop structure from the original source code; &#x2022; an end-to-end flow with raising to and lowering from the polyhedral model, leveraging our abstraction to perform more optimizations than both source-and IR-level tools, including reduction parallelization; &#x2022; an exploration of new transformation opportunities created by Polygeist, in particular, statement splitting; &#x2022; and an end-to-end comparison between Polygeist and state-of-the-art source-and IR-based tools (Pluto [11] and Polly [14]) along with optimization case studies.</p>
<p>I. &#x5F15;&#x8A00;</p>
<p>&#x63D0;&#x9AD8;&#x8BA1;&#x7B97;&#x6548;&#x7387;&#x4E00;&#x76F4;&#x662F;&#x8BA1;&#x7B97;&#x9886;&#x57DF;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x6807;&#x4E4B;&#x4E00;&#x3002;&#x901A;&#x8FC7;&#x5229;&#x7528;&#x5E76;&#x884C;&#x6027;&#x3001;&#x65F6;&#x95F4;&#x548C;&#x7A7A;&#x95F4;&#x5C40;&#x90E8;&#x6027;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x6027;&#x80FD;&#x6765;&#x6E90;&#xFF0C;&#x53EF;&#x4EE5;&#x663E;&#x8457;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x6027;&#x80FD;&#x3002;&#x5F53;&#x9488;&#x5BF9;&#x73B0;&#x4EE3;&#x591A;&#x6838; CPU &#x548C; GPU &#x8FDB;&#x884C;&#x76F8;&#x5173;&#x7A0B;&#x5E8F;&#x53D8;&#x6362;&#x65F6;&#xFF0C;&#x8FD9;&#x4E9B;&#x53D8;&#x6362;&#x5C24;&#x5176;&#x7E41;&#x7410;&#x4E14;&#x5177;&#x6709;&#x6311;&#x6218;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x73B0;&#x4EE3;&#x67B6;&#x6784;&#x5177;&#x6709;&#x6DF1;&#x5EA6;&#x5185;&#x5B58;&#x5C42;&#x6B21;&#x548C;&#x5E76;&#x884C;&#x6027;&#xFF0C;&#x901A;&#x5E38;&#x7531;&#x4F18;&#x5316;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x3002;</p>
<p>&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x7CBE;&#x786E;&#x5206;&#x6790;&#x548C;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#x7684;&#x53D8;&#x6362;&#x89C4;&#x8303;&#xFF08;&#x5982;&#x5FAA;&#x73AF;&#x91CD;&#x6784;&#x3001;&#x81EA;&#x52A8;&#x5E76;&#x884C;&#x5316;&#x7B49;&#xFF09;&#xFF0C;&#x4EE5;&#x5229;&#x7528;&#x786C;&#x4EF6;&#x6027;&#x80FD;&#x6765;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6709;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x8BC1;&#x636E;&#x8868;&#x660E;&#xFF0C;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x662F;&#x9AD8;&#x6548;&#x8F6C;&#x5316;&#x8BA1;&#x7B97;&#x5BC6;&#x96C6;&#x578B;&#x7A0B;&#x5E8F; [1]&#x3001;[2]&#x3001;[3] &#x548C;&#x7F16;&#x7A0B;&#x52A0;&#x901F;&#x5668;&#x67B6;&#x6784; [4]&#x3001;[5]&#x3001;[6] &#x7684;&#x6700;&#x4F73;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x793E;&#x533A;&#x4E13;&#x6CE8;&#x4E8E;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x8BC6;&#x522B;&#x548C;&#x4F18;&#x5316;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x4E2D;&#x8868;&#x793A;&#x7684;&#x7A0B;&#x5E8F;&#x90E8;&#x5206;&#xFF08;&#x901A;&#x5E38;&#x79F0;&#x4E3A;&#x9759;&#x6001;&#x63A7;&#x5236;&#x90E8;&#x5206;&#x6216; SCoP&#xFF09;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x5F80;&#x5F80;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#x3002;</p>
<p>&#x57FA;&#x4E8E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5982; Polly [7] &#x548C; Graphite [8]&#xFF0C;&#x5728;&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#x95F4;&#x8868;&#x793A;&#xFF08;IR&#xFF09;&#x4E2D;&#x68C0;&#x6D4B;&#x548C;&#x8F6C;&#x6362; SCoP&#x3002;&#x5C3D;&#x7BA1;&#x8FD9;&#x4E0E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x65E0;&#x7F1D;&#x96C6;&#x6210;&#xFF0C;&#x4F46;&#x7F3A;&#x4E4F;&#x9AD8;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x548C;&#x4FE1;&#x606F;&#x9650;&#x5236;&#x4E86;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x548C;&#x53D8;&#x6362;&#x7684;&#x80FD;&#x529B;&#x3002;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x901A;&#x5E38;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4F18;&#x5316;&#x540E;&#x7684; IR &#x6062;&#x590D;&#xFF0C;&#x5F80;&#x5F80;&#x662F;&#x4EE5;&#x4E0D;&#x5B8C;&#x5168;&#x6216;&#x9AD8;&#x6210;&#x672C;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0; [9]&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8BF8;&#x5982; LICM &#x7684;&#x5E38;&#x89C1;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x53EF;&#x80FD;&#x4F1A;&#x5E72;&#x6270;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B; [10]&#x3002;&#x6700;&#x540E;&#xFF0C;&#x4F4E;&#x7EA7; IR &#x901A;&#x5E38;&#x7F3A;&#x4E4F;&#x7531;&#x53D8;&#x6362;&#x751F;&#x6210;&#x7684;&#x5E76;&#x884C;&#x6027;&#x6216;&#x5F52;&#x7EA6;&#x7684;&#x6784;&#x9020;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x6D41;&#x7A0B;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;</p>
<p>&#x6E90;&#x5230;&#x6E90;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5982; Pluto [11]&#x3001;POCC [12] &#x548C; PPCG [5]&#xFF0C;&#x76F4;&#x63A5;&#x5728; C &#x6216; C++ &#x4EE3;&#x7801;&#x4E0A;&#x64CD;&#x4F5C;&#x3002;&#x867D;&#x7136;&#x8FD9;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x5229;&#x7528;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x9AD8;&#x5C42;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x7684;&#x6709;&#x6548;&#x6027;&#x5F80;&#x5F80;&#x56E0;&#x7F3A;&#x4E4F;&#x542F;&#x7528;&#x4F18;&#x5316;&#x800C;&#x964D;&#x4F4E;&#xFF0C;&#x4F8B;&#x5982;&#x5C06;&#x5371;&#x9669;&#x7684;&#x5185;&#x5B58;&#x52A0;&#x8F7D;&#x8F6C;&#x6362;&#x4E3A;&#x5355;&#x8D4B;&#x503C;&#x865A;&#x62DF;&#x5BC4;&#x5B58;&#x5668;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x53D8;&#x6362;&#x7ED3;&#x679C;&#x5FC5;&#x987B;&#x7528; C &#x8868;&#x8FBE;&#xFF0C;&#x800C; C &#x8BED;&#x8A00;&#x672C;&#x8EAB;&#x7684;&#x590D;&#x6742;&#x6027;&#x4F17;&#x6240;&#x5468;&#x77E5; [13]&#x3001;[14]&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x7F3A;&#x4E4F;&#x4F8B;&#x5982;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#x6216;&#x672A;&#x88AB;&#x5185;&#x5B58;&#x5B58;&#x50A8;&#x652F;&#x6301;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x503C;&#x7684;&#x6784;&#x9020;&#x3002;</p>
<p>&#x672C;&#x6587;&#x63D0;&#x51FA;&#x5E76;&#x8BC4;&#x4F30;&#x4E86;&#x4E00;&#x79CD;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B; Polygeist&#xFF08;&#x56FE; 1&#xFF09;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x8BE5;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x9AD8;&#x5C42;&#x7ED3;&#x6784;&#x4EE5;&#x53CA;&#x7531;&#x4F4E;&#x7EA7; IR &#x63D0;&#x4F9B;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x7684;&#x7EC6;&#x7C92;&#x5EA6;&#x63A7;&#x5236;&#x3002;&#x5B83;&#x6784;&#x5EFA;&#x5728;&#x6700;&#x8FD1;&#x7684; MLIR &#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4E4B;&#x4E0A;&#xFF0C;&#x8BE5;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x5141;&#x8BB8;&#x5728;&#x540C;&#x4E00;&#x8868;&#x793A;&#x4E2D;&#x3001;&#x5728;&#x540C;&#x4E00;&#x53D8;&#x6362;&#x8FC7;&#x7A0B;&#x4E2D;&#x6DF7;&#x5408;&#x591A;&#x4E2A;&#x62BD;&#x8C61;&#x5C42;&#x6B21; [15]&#x3002;&#x53EF;&#x4E92;&#x6362;&#x7684; MLIR &#x62BD;&#x8C61;&#x6216;&#x65B9;&#x8A00;&#x5305;&#x62EC;&#x9AD8;&#x5C42;&#x6784;&#x9020;&#xFF0C;&#x5982;&#x5FAA;&#x73AF;&#x3001;&#x5E76;&#x884C;&#x548C;&#x5F52;&#x7EA6;&#x6A21;&#x5F0F;&#xFF1B;&#x5B8C;&#x6574;&#x8986;&#x76D6; LLVM IR &#x7684;&#x4F4E;&#x5C42;&#x8868;&#x793A; [16]&#xFF1B;&#x4EE5;&#x53CA;&#x4E00;&#x79CD;&#x53D7;&#x5230;&#x591A;&#x9762;&#x4F53;&#x542F;&#x53D1;&#x7684;&#x8868;&#x793A;&#xFF0C;&#x5177;&#x6709;&#x5E26;&#x6709;&#x4EFF;&#x5C04;&#x8868;&#x8FBE;&#x5F0F;&#x6CE8;&#x91CA;&#x7684;&#x5FAA;&#x73AF;&#x548C;&#x5185;&#x5B58;&#x8BBF;&#x95EE;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7;&#x5C06;&#x6E90;&#x7EA7;&#x548C; IR &#x7EA7;&#x5DE5;&#x5177;&#x7684;&#x4F18;&#x52BF;&#x7ED3;&#x5408;&#x5728;&#x4E00;&#x4E2A;&#x7AEF;&#x5230;&#x7AEF;&#x7684;&#x591A;&#x9762;&#x4F53;&#x6D41;&#x7A0B;&#x4E2D;&#xFF0C;Polygeist &#x4FDD;&#x7559;&#x4E86;&#x9AD8;&#x5C42;&#x4FE1;&#x606F;&#x5E76;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5728;&#x8F83;&#x4F4E;&#x7EA7;&#x522B;&#x62BD;&#x8C61;&#x4E0A;&#x6267;&#x884C;&#x65B0;&#x7684;&#x6216;&#x6539;&#x8FDB;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x5982;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x548C;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x503C;&#x68C0;&#x6D4B;&#xFF0C;&#x540C;&#x65F6;&#x5F71;&#x54CD;&#x540E;&#x7EED;&#x4F18;&#x5316;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x8D21;&#x732E;&#x5982;&#x4E0B;&#xFF1A;
&#x2022; &#x4E00;&#x4E2A; C &#x548C; C++ &#x7684; MLIR &#x524D;&#x7AEF;&#xFF0C;&#x4FDD;&#x7559;&#x539F;&#x59CB;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x9AD8;&#x5C42;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#xFF1B;
&#x2022; &#x4E00;&#x4E2A;&#x7AEF;&#x5230;&#x7AEF;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5B9E;&#x73B0;&#x5411;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x7684;&#x63D0;&#x5347;&#x548C;&#x964D;&#x4F4E;&#xFF0C;&#x5229;&#x7528;&#x6211;&#x4EEC;&#x7684;&#x62BD;&#x8C61;&#x6267;&#x884C;&#x6BD4;&#x6E90;&#x7EA7;&#x548C; IR &#x7EA7;&#x5DE5;&#x5177;&#x66F4;&#x591A;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x5305;&#x62EC;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#xFF1B;
&#x2022; &#x63A2;&#x7D22; Polygeist &#x521B;&#x5EFA;&#x7684;&#x65B0;&#x53D8;&#x6362;&#x673A;&#x4F1A;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#xFF1B;
&#x2022; &#x4EE5;&#x53CA; Polygeist &#x4E0E;&#x6700;&#x5148;&#x8FDB;&#x7684;&#x57FA;&#x4E8E;&#x6E90;&#x548C; IR &#x7684;&#x5DE5;&#x5177;&#xFF08;Pluto [11] &#x548C; Polly [14]&#xFF09;&#x4E4B;&#x95F4;&#x7684;&#x7AEF;&#x5230;&#x7AEF;&#x6BD4;&#x8F83;&#xFF0C;&#x4EE5;&#x53CA;&#x4F18;&#x5316;&#x6848;&#x4F8B;&#x7814;&#x7A76;&#x3002;</p>
<h2 id="a-overview"># A. Overview</h2>
<p>MLIR is an optimizing compiler infrastructure inspired by LLVM [16] with a focus on extensibility and modularity [15]. Its main novelty is the IR supporting a fully extensible set of instructions (called operations) and types. Practically, MLIR combines SSA with nested regions, allowing one to express a range of concepts as first-class operations including machine instructions such as floating-point addition, structured control flow such as loops, hardware circuitry [17], and large machine learning graphs. Operations define the runtime semantics of a program and process immutable values. Compile-time information about values is expressed in types, and information about operations is expressed in attributes. Operations can have attached regions, which in turn contain (basic) blocks of further operations. The generic syntax, accepted by all operations, illustrates the structure of MLIR in Figure 2. Additionally, MLIR supports user-defined custom syntax.
Attributes, operations, and types are organized in dialects, which can be thought of as modular libraries. MLIR provides a handful of dialects that define common operations such as modules, functions, loops, memory or arithmetic instructions, and ubiquitous types such as integers and floats. We discuss the dialects relevant to Polygeist in the following sections.</p>
<p>A. &#x6982;&#x8FF0;</p>
<p>MLIR&#x662F;&#x4E00;&#x79CD;&#x4F18;&#x5316;&#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x53D7;&#x5230;LLVM&#x7684;&#x542F;&#x53D1;&#xFF0C;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x6269;&#x5C55;&#x6027;&#x548C;&#x6A21;&#x5757;&#x5316;&#x3002;&#x5176;&#x4E3B;&#x8981;&#x521B;&#x65B0;&#x5728;&#x4E8E;&#x652F;&#x6301;&#x5B8C;&#x5168;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x4E00;&#x7EC4;&#x6307;&#x4EE4;&#xFF08;&#x79F0;&#x4E3A;&#x64CD;&#x4F5C;&#xFF09;&#x548C;&#x7C7B;&#x578B;&#x7684;&#x4E2D;&#x95F4;&#x8868;&#x793A;&#xFF08;IR&#xFF09;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;MLIR&#x5C06;&#x9759;&#x6001;&#x5355;&#x8D4B;&#x503C;&#xFF08;SSA&#xFF09;&#x4E0E;&#x5D4C;&#x5957;&#x533A;&#x57DF;&#x76F8;&#x7ED3;&#x5408;&#xFF0C;&#x4F7F;&#x5F97;&#x80FD;&#x591F;&#x5C06;&#x4E00;&#x7CFB;&#x5217;&#x6982;&#x5FF5;&#x8868;&#x793A;&#x4E3A;&#x4E00;&#x7C7B;&#x4E00;&#x6D41;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5305;&#x62EC;&#x673A;&#x5668;&#x6307;&#x4EE4;&#xFF0C;&#x4F8B;&#x5982;&#x6D6E;&#x70B9;&#x52A0;&#x6CD5;&#x3001;&#x7ED3;&#x6784;&#x5316;&#x63A7;&#x5236;&#x6D41;&#xFF0C;&#x4F8B;&#x5982;&#x5FAA;&#x73AF;&#x3001;&#x786C;&#x4EF6;&#x7535;&#x8DEF;&#xFF0C;&#x4EE5;&#x53CA;&#x5927;&#x578B;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x56FE;&#x3002;&#x64CD;&#x4F5C;&#x5B9A;&#x4E49;&#x4E86;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x8BED;&#x4E49;&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x4E0D;&#x53EF;&#x53D8;&#x503C;&#x3002;&#x6709;&#x5173;&#x503C;&#x7684;&#x7F16;&#x8BD1;&#x65F6;&#x4FE1;&#x606F;&#x7528;&#x7C7B;&#x578B;&#x8868;&#x793A;&#xFF0C;&#x800C;&#x6709;&#x5173;&#x64CD;&#x4F5C;&#x7684;&#x4FE1;&#x606F;&#x7528;&#x5C5E;&#x6027;&#x8868;&#x793A;&#x3002;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x9644;&#x5E26;&#x533A;&#x57DF;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x533A;&#x57DF;&#x5185;&#x90E8;&#x53C8;&#x5305;&#x542B;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;&#x7684;&#xFF08;&#x57FA;&#x672C;&#xFF09;&#x5757;&#x3002;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x63A5;&#x53D7;&#x7684;&#x901A;&#x7528;&#x8BED;&#x6CD5;&#x5728;&#x56FE;2&#x4E2D;&#x5C55;&#x793A;&#x4E86;MLIR&#x7684;&#x7ED3;&#x6784;&#x3002;&#x6B64;&#x5916;&#xFF0C;MLIR&#x652F;&#x6301;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x8BED;&#x6CD5;&#x3002;</p>
<p>&#x5C5E;&#x6027;&#x3001;&#x64CD;&#x4F5C;&#x548C;&#x7C7B;&#x578B;&#x88AB;&#x7EC4;&#x7EC7;&#x5728;&#x65B9;&#x8A00;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x6A21;&#x5757;&#x5316;&#x5E93;&#x3002;MLIR&#x63D0;&#x4F9B;&#x4E86;&#x5C11;&#x91CF;&#x65B9;&#x8A00;&#xFF0C;&#x4EE5;&#x5B9A;&#x4E49;&#x5E38;&#x89C1;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x6A21;&#x5757;&#x3001;&#x51FD;&#x6570;&#x3001;&#x5FAA;&#x73AF;&#x3001;&#x5185;&#x5B58;&#x6216;&#x7B97;&#x672F;&#x6307;&#x4EE4;&#xFF0C;&#x4EE5;&#x53CA;&#x50CF;&#x6574;&#x6570;&#x548C;&#x6D6E;&#x70B9;&#x6570;&#x8FD9;&#x6837;&#x7684;&#x901A;&#x7528;&#x7C7B;&#x578B;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x8BA8;&#x8BBA;&#x4E0E;Polygeist&#x76F8;&#x5173;&#x7684;&#x65B9;&#x8A00;&#x3002;</p>
<h2 id="b-affine-and-memref-dialects"># B. Affine and MemRef Dialects</h2>
<p>The Affine dialect [18] aims at representing SCoP&apos;s with explicit polyhedral-friendly loop and conditional constructs. The core of its representation is the following classification of value categories: &#x2022; Symbols-integer values that are known to be loopinvariant but unknown at compile-time, also referred to as program parameters in polyhedral literature, typically array dimensions or function arguments. In MLIR, symbols are values defined in the top-level region of an operation with &quot;affine scope&quot; semantics, e.g., functions; or array dimensions, constants, and affine map (see below) application results regardless of their definition point. &#x2022; Dimensions-are an extension of symbols that also accepts induction variables of affine loops. &#x2022; Non-affine-any other values. Symbols and dimensions have index type, which is a platform-specific integer that fits a pointer (intptr_t in C).
MLIR provides two attributes relevant for the Affine dialect:
&#x2022; Affine maps are multi-dimensional (quasi-)linear functions that map a list of dimension and symbol arguments to a list of results. For example,
(d 0 , d 1 , d 2 , s 0 ) &#x2192; (d 0 + d 1 , s 0 &#x2022; d 2 )
is a two-dimensional quasi-affine map, which can be expressed in MLIR as affine_map&lt;(d0,d1,d2)[s0] -&gt; (d0+d1, s0 * d2)&gt;. Dimensions (in parentheses on the left) and symbols (in brackets on the left) are separated to allow quasi-linear expressions: symbols are treated as constants, which can therefore be multiplied with dimensions, whereas a product of two dimensions is invalid. &#x2022; Integer sets are collections of integer tuples constrained by conjunctions of (quasi-)linear expressions. For example, a &quot;triangular&quot; set {(d 0 , d 1 ) :
0 &#x2264; d 0 &lt; s 0 &#x2227; 0 &#x2264; d 1 &#x2264; d 0 } is rep- resented as affine_set&lt;(d0,d1)[s0]: (d0 &gt;= 0, s0-d0-1 &gt;= 0, d1 &gt;= 0, d0-d1 &gt;= 0)&gt;.
The Affine dialect makes use of the concepts above to define a set of operations. An affine.for is a &quot;for&quot; loop with loop-invariant lower and upper bounds expressed as affine maps with a constant step. An affine.parallel is a &quot;multifor&quot; loop nest, iterations of which may be executed concurrently. Both kinds of loops support reductions via loopcarried values as well as max(min) expression lower(upper) bounds. An affine.if is a conditional construct, with an optional else region, and a condition defined as inclusion of the given values into an integer set. Finally, affine.load and affine.store express memory accesses where the address computation is expressed as an affine map. A core MLIR type-memref, which stands for memory reference-and the corresponding memref dialect are also featured in Figure 3. The memref type describes a structured multi-index pointer into memory, e.g., memref&lt;?xf32&gt; denotes a 1-d array of floating-point elements; and the memref dialect provides memory and type manipulation operations, e.g., memref.dim retrieves the dimensionality of a memref object. memref does not allow internal aliasing, i.e., different subscripts always point to different addresses. This effectively defines away the delinearization problem that hinders the application of polyhedral techniques at the LLVM IR level [9]. Throughout this paper, we only consider memrefs with the default layout that corresponds to contiguous row-major storage compatible with C ABI (Application Binary Interface). In practice, memrefs support arbitrary layouts expressible as affine maps, but these are not necessary in Polygeist context.</p>
<h2 id="b-&#x4EFF;&#x5C04;&#x548C;&#x5185;&#x5B58;&#x5F15;&#x7528;&#x65B9;&#x8A00;">B. &#x4EFF;&#x5C04;&#x548C;&#x5185;&#x5B58;&#x5F15;&#x7528;&#x65B9;&#x8A00;</h2>
<p>&#x4EFF;&#x5C04;&#x65B9;&#x8A00; [18] &#x65E8;&#x5728;&#x8868;&#x793A;&#x5177;&#x6709;&#x663E;&#x5F0F;&#x9002;&#x5408;&#x591A;&#x9762;&#x4F53;&#x7684;&#x5FAA;&#x73AF;&#x548C;&#x6761;&#x4EF6;&#x6784;&#x9020;&#x7684;&#x9759;&#x6001;&#x8BA1;&#x7B97;&#x7A0B;&#x5E8F;&#xFF08;SCoP&#xFF09;&#x3002;&#x5176;&#x8868;&#x793A;&#x7684;&#x6838;&#x5FC3;&#x662F;&#x4EE5;&#x4E0B;&#x503C;&#x7C7B;&#x522B;&#x7684;&#x5206;&#x7C7B;&#xFF1A;</p>
<ul>
<li><strong>&#x7B26;&#x53F7;</strong>&#x2014;&#x2014;&#x5DF2;&#x77E5;&#x4E3A;&#x5FAA;&#x73AF;&#x4E0D;&#x53D8;&#x4F46;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x672A;&#x77E5;&#x7684;&#x6574;&#x6570;&#x503C;&#xFF0C;&#x5728;&#x591A;&#x9762;&#x4F53;&#x6587;&#x732E;&#x4E2D;&#x4E5F;&#x79F0;&#x4E3A;&#x7A0B;&#x5E8F;&#x53C2;&#x6570;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x6570;&#x7EC4;&#x7EF4;&#x5EA6;&#x6216;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x3002;&#x5728; MLIR &#x4E2D;&#xFF0C;&#x7B26;&#x53F7;&#x662F;&#x5728;&#x5177;&#x6709;&#x201C;&#x4EFF;&#x5C04;&#x8303;&#x56F4;&#x201D;&#x8BED;&#x4E49;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x9876;&#x7EA7;&#x533A;&#x57DF;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x503C;&#xFF0C;&#x4F8B;&#x5982;&#x51FD;&#x6570;&#xFF1B;&#x6216;&#x8005;&#x6570;&#x7EC4;&#x7EF4;&#x5EA6;&#x3001;&#x5E38;&#x91CF;&#x548C;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#xFF08;&#x89C1;&#x4E0B;&#x6587;&#xFF09;&#x5E94;&#x7528;&#x7ED3;&#x679C;&#xFF0C;&#x65E0;&#x8BBA;&#x5B83;&#x4EEC;&#x7684;&#x5B9A;&#x4E49;&#x70B9;&#x5728;&#x54EA;&#x91CC;&#x3002;</li>
<li><strong>&#x7EF4;&#x5EA6;</strong>&#x2014;&#x2014;&#x662F;&#x7B26;&#x53F7;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x63A5;&#x53D7;&#x4EFF;&#x5C04;&#x5FAA;&#x73AF;&#x7684;&#x5F52;&#x7EB3;&#x53D8;&#x91CF;&#x3002;</li>
<li><strong>&#x975E;&#x4EFF;&#x5C04;</strong>&#x2014;&#x2014;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x503C;&#x3002;&#x7B26;&#x53F7;&#x548C;&#x7EF4;&#x5EA6;&#x5177;&#x6709;&#x7D22;&#x5F15;&#x7C7B;&#x578B;&#xFF0C;&#x5373;&#x5E73;&#x53F0;&#x7279;&#x5B9A;&#x7684;&#x6574;&#x6570;&#xFF0C;&#x9002;&#x5408;&#x6307;&#x9488;&#xFF08;&#x5728; C &#x4E2D;&#x4E3A; intptr_t&#xFF09;&#x3002;</li>
</ul>
<p>MLIR &#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x4E0E;&#x4EFF;&#x5C04;&#x65B9;&#x8A00;&#x76F8;&#x5173;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</p>
<ul>
<li><p><strong>&#x4EFF;&#x5C04;&#x6620;&#x5C04;</strong>&#x662F;&#x591A;&#x7EF4;&#x7684;&#xFF08;&#x51C6;&#xFF09;&#x7EBF;&#x6027;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5C06;&#x4E00;&#x7EC4;&#x7EF4;&#x5EA6;&#x548C;&#x7B26;&#x53F7;&#x53C2;&#x6570;&#x6620;&#x5C04;&#x5230;&#x4E00;&#x7EC4;&#x7ED3;&#x679C;&#x3002;&#x4F8B;&#x5982;&#xFF0C;</p>
<p>( (d_0, d_1, d_2, s_0) \rightarrow (d_0 + d_1, s_0 \cdot d_2) )</p>
<p>&#x662F;&#x4E00;&#x4E2A;&#x4E8C;&#x7EF4;&#x51C6;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; MLIR &#x4E2D;&#x8868;&#x793A;&#x4E3A; <code>affine_map&lt;(d0,d1,d2)[s0] -&gt; (d0+d1, s0 * d2)&gt;</code>&#x3002;&#x7EF4;&#x5EA6;&#xFF08;&#x5DE6;&#x4FA7;&#x7684;&#x62EC;&#x53F7;&#x5185;&#xFF09;&#x548C;&#x7B26;&#x53F7;&#xFF08;&#x5DE6;&#x4FA7;&#x7684;&#x65B9;&#x62EC;&#x53F7;&#x5185;&#xFF09;&#x88AB;&#x5206;&#x9694;&#x5F00;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x51C6;&#x7EBF;&#x6027;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;&#x7B26;&#x53F7;&#x88AB;&#x89C6;&#x4E3A;&#x5E38;&#x91CF;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4E0E;&#x7EF4;&#x5EA6;&#x76F8;&#x4E58;&#xFF0C;&#x800C;&#x4E24;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;&#x4E58;&#x79EF;&#x662F;&#x65E0;&#x6548;&#x7684;&#x3002;</p>
</li>
<li><p><strong>&#x6574;&#x6570;&#x96C6;</strong>&#x662F;&#x88AB;&#xFF08;&#x51C6;&#xFF09;&#x7EBF;&#x6027;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x5408;&#x53D6;&#x9650;&#x5236;&#x7684;&#x6574;&#x6570;&#x5143;&#x7EC4;&#x96C6;&#x5408;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x201C;&#x4E09;&#x89D2;&#x5F62;&#x201D;&#x96C6;&#x5408; ({(d_0, d_1) : 0 \leq d_0 &lt; s_0 \land 0 \leq d_1 \leq d_0}) &#x8868;&#x793A;&#x4E3A; <code>affine_set&lt;(d0,d1)[s0]: (d0 &gt;= 0, s0-d0-1 &gt;= 0, d1 &gt;= 0, d0-d1 &gt;= 0)&gt;</code>&#x3002;</p>
</li>
</ul>
<p>&#x4EFF;&#x5C04;&#x65B9;&#x8A00;&#x5229;&#x7528;&#x4E0A;&#x8FF0;&#x6982;&#x5FF5;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7EC4;&#x64CD;&#x4F5C;&#x3002;<code>affine.for</code> &#x662F;&#x4E00;&#x4E2A;&#x201C;for&#x201D;&#x5FAA;&#x73AF;&#xFF0C;&#x5176;&#x5FAA;&#x73AF;&#x4E0D;&#x53D8;&#x7684;&#x4E0B;&#x754C;&#x548C;&#x4E0A;&#x754C;&#x8868;&#x793A;&#x4E3A;&#x5E26;&#x6709;&#x5E38;&#x91CF;&#x6B65;&#x957F;&#x7684;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#x3002;<code>affine.parallel</code> &#x662F;&#x4E00;&#x4E2A;&#x201C;&#x591A;&#x91CD;for&#x201D;&#x5FAA;&#x73AF;&#x5D4C;&#x5957;&#xFF0C;&#x5176;&#x8FED;&#x4EE3;&#x53EF;&#x4EE5;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x4E24;&#x79CD;&#x5FAA;&#x73AF;&#x90FD;&#x652F;&#x6301;&#x901A;&#x8FC7;&#x5FAA;&#x73AF;&#x4F20;&#x9012;&#x503C;&#x8FDB;&#x884C;&#x5F52;&#x7EA6;&#xFF0C;&#x4EE5;&#x53CA; max(min) &#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E0B;&#xFF08;&#x4E0A;&#xFF09;&#x754C;&#x3002;<code>affine.if</code> &#x662F;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x6784;&#x9020;&#xFF0C;&#x5E26;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684; else &#x533A;&#x57DF;&#xFF0C;&#x6761;&#x4EF6;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x7ED9;&#x5B9A;&#x503C;&#x5305;&#x542B;&#x5728;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x96C6;&#x4E2D;&#x3002;&#x6700;&#x540E;&#xFF0C;<code>affine.load</code> &#x548C; <code>affine.store</code> &#x8868;&#x793A;&#x5185;&#x5B58;&#x8BBF;&#x95EE;&#xFF0C;&#x5176;&#x4E2D;&#x5730;&#x5740;&#x8BA1;&#x7B97;&#x8868;&#x793A;&#x4E3A;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#x3002;&#x6838;&#x5FC3;&#x7684; MLIR &#x7C7B;&#x578B;&#x2014;&#x2014;&#x5185;&#x5B58;&#x5F15;&#x7528;&#xFF08;memref&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x76F8;&#x5E94;&#x7684; memref &#x65B9;&#x8A00;&#x4E5F;&#x5728;&#x56FE; 3 &#x4E2D;&#x5C55;&#x793A;&#x3002;memref &#x7C7B;&#x578B;&#x63CF;&#x8FF0;&#x4E86;&#x6307;&#x5411;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x6784;&#x5316;&#x591A;&#x7D22;&#x5F15;&#x6307;&#x9488;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;<code>memref&lt;?xf32&gt;</code> &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x6D6E;&#x70B9;&#x5143;&#x7D20;&#x7684;&#x4E00;&#x7EF4;&#x6570;&#x7EC4;&#xFF1B;&#x800C; memref &#x65B9;&#x8A00;&#x63D0;&#x4F9B;&#x4E86;&#x5185;&#x5B58;&#x548C;&#x7C7B;&#x578B;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982; <code>memref.dim</code> &#x68C0;&#x7D22; memref &#x5BF9;&#x8C61;&#x7684;&#x7EF4;&#x5EA6;&#x3002;memref &#x4E0D;&#x5141;&#x8BB8;&#x5185;&#x90E8;&#x522B;&#x540D;&#xFF0C;&#x5373;&#x4E0D;&#x540C;&#x7684;&#x4E0B;&#x6807;&#x59CB;&#x7EC8;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x6709;&#x6548;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x9650;&#x5236;&#x591A;&#x9762;&#x4F53;&#x6280;&#x672F;&#x5728; LLVM IR &#x7EA7;&#x522B;&#x5E94;&#x7528;&#x7684;&#x53BB;&#x7EBF;&#x6027;&#x5316;&#x95EE;&#x9898; [9]&#x3002;&#x5728;&#x672C;&#x6587;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8003;&#x8651;&#x4E0E;&#x517C;&#x5BB9; C ABI&#xFF08;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E8C;&#x8FDB;&#x5236;&#x63A5;&#x53E3;&#xFF09;&#x7684;&#x8FDE;&#x7EED;&#x884C;&#x4E3B;&#x5B58;&#x50A8;&#x5BF9;&#x5E94;&#x7684;&#x9ED8;&#x8BA4;&#x5E03;&#x5C40;&#x7684; memrefs&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;memrefs &#x652F;&#x6301;&#x53EF;&#x4F5C;&#x4E3A;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#x8868;&#x8FBE;&#x7684;&#x4EFB;&#x610F;&#x5E03;&#x5C40;&#xFF0C;&#x4F46;&#x5728; Polygeist &#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x5E76;&#x4E0D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002;</p>
<h2 id="c-other-relevant-core-dialects"># C. Other Relevant Core Dialects</h2>
<p>MLIR provides several dozen dialects. Out of those, only a handful are relevant for our discussion:
&#x2022; The Structured Control Flow (scf) dialect defines the control flow operations such as loops and conditionals that are not constrained by affine categorization rules. For example, the scf.for loop accepts any integer value as loop bounds, which are not necessarily affine expressions. &#x2022; The Standard (std) dialect contains common operations such as integer and float arithmetic, which is used as a common lowering point from higher-level dialects before fanning out into multiple target dialects and can be seen as a generalization of LLVM IR [16]. &#x2022; The LLVM dialect directly maps from LLVM IR instructions and types to MLIR, primarily to simplify the translation between them. &#x2022; The OpenMP dialect provides a dialect-and platformagnostic representation of OpenMP directives such as &quot;parallel&quot; and &quot;workshare loop&quot;, which can be used to transform OpenMP constructs or emit LLVM IR that interacts with the OpenMP runtime. &#x2022; The Math dialect groups together mathematical operations on integer and floating type beyond simple arithmetic, e.g., math.pow or math.sqrt.</p>
<p>MLIR&#x63D0;&#x4F9B;&#x4E86;&#x51E0;&#x5341;&#x79CD;&#x65B9;&#x8A00;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x65B9;&#x8A00;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;&#x5C11;&#x6570;&#x51E0;&#x79CD;&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x8BA8;&#x8BBA;&#x76F8;&#x5173;&#xFF1A;</p>
<ul>
<li>&#x7ED3;&#x6784;&#x5316;&#x63A7;&#x5236;&#x6D41;&#xFF08;scf&#xFF09;&#x65B9;&#x8A00;&#x5B9A;&#x4E49;&#x4E86;&#x63A7;&#x5236;&#x6D41;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x5FAA;&#x73AF;&#x548C;&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#xFF0C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x4E0D;&#x53D7;&#x4EFF;&#x5C04;&#x5206;&#x7C7B;&#x89C4;&#x5219;&#x7684;&#x9650;&#x5236;&#x3002;&#x4F8B;&#x5982;&#xFF0C;scf.for &#x5FAA;&#x73AF;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4EFB;&#x4F55;&#x6574;&#x6570;&#x503C;&#x4F5C;&#x4E3A;&#x5FAA;&#x73AF;&#x8FB9;&#x754C;&#xFF0C;&#x8FD9;&#x4E9B;&#x8FB9;&#x754C;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x4EFF;&#x5C04;&#x8868;&#x8FBE;&#x5F0F;&#x3002;</li>
<li>&#x6807;&#x51C6;&#xFF08;std&#xFF09;&#x65B9;&#x8A00;&#x5305;&#x542B;&#x5E38;&#x89C1;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x6574;&#x6570;&#x548C;&#x6D6E;&#x70B9;&#x7B97;&#x672F;&#xFF0C;&#x8FD9;&#x88AB;&#x7528;&#x4F5C;&#x4ECE;&#x66F4;&#x9AD8;&#x7EA7;&#x522B;&#x65B9;&#x8A00;&#x5230;&#x591A;&#x4E2A;&#x76EE;&#x6807;&#x65B9;&#x8A00;&#x7684;&#x5171;&#x540C;&#x964D;&#x4F4E;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;LLVM IR&#x7684;&#x6982;&#x62EC;[16]&#x3002;</li>
<li>LLVM&#x65B9;&#x8A00;&#x76F4;&#x63A5;&#x5C06;LLVM IR&#x6307;&#x4EE4;&#x548C;&#x7C7B;&#x578B;&#x6620;&#x5C04;&#x5230;MLIR&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x3002;</li>
<li>OpenMP&#x65B9;&#x8A00;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x4E0E;&#x65B9;&#x8A00;&#x548C;&#x5E73;&#x53F0;&#x65E0;&#x5173;&#x7684;OpenMP&#x6307;&#x4EE4;&#x8868;&#x793A;&#xFF0C;&#x4F8B;&#x5982;&#x201C;parallel&#x201D;&#x548C;&#x201C;workshare loop&#x201D;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x8F6C;&#x6362;OpenMP&#x6784;&#x9020;&#x6216;&#x751F;&#x6210;&#x4E0E;OpenMP&#x8FD0;&#x884C;&#x65F6;&#x4EA4;&#x4E92;&#x7684;LLVM IR&#x3002;</li>
<li>&#x6570;&#x5B66;&#x65B9;&#x8A00;&#x5C06;&#x6574;&#x6570;&#x548C;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;&#x4E0A;&#x7684;&#x6570;&#x5B66;&#x64CD;&#x4F5C;&#xFF08;&#x8D85;&#x51FA;&#x7B80;&#x5355;&#x7B97;&#x672F;&#xFF09;&#x5F52;&#x4E3A;&#x4E00;&#x7EC4;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;math.pow&#x6216;math.sqrt&#x3002;</li>
</ul>
<h2 id="iii-an-affine-mlir-compilation-pipeline"># III. AN (AFFINE) MLIR COMPILATION PIPELINE</h2>
<p>The Polygeist pipeline consists of 4 components (Figure 1):  4). This allows Polygeist to preserve more of the structure available within the original program (e.g., multi-dimensional arrays) and enables interaction with MLIR&apos;s high-level memory operations.
This diverges from the C ABI for any functions with pointer arguments and wouldn&apos;t interface correctly with C functions. Polygeist addresses this by providing an attribute for function arguments and allocations to use a C-compatible pointer type rather than memref, applied by default to external functions such as strcmp and scanf. When calling a pointer-ABI function with a memref-ABI argument, Polygeist generates wrapper code that recovers the C ABI-compatible pointer from memref and ensures the correct result. Figure 5 shows an example demonstrating how the Polygeist and C ABI may interact for a small program.
When allocating and deallocating memory, this difference in ABI becomes significant. This is because allocating several bytes of an array with malloc then casting to a memref will not result in legal code (as memref itself may not be implemented with a raw pointer). Thus, Polygeist identifies calls to allocation and deallocation functions and replaces them with legal equivalents for memref.
Functions and global variables are emitted using the same name used by the C or C++ ABI. This ensures that all external values are loaded correctly, and multi-versioned functions (such as those generated by C++ templates or overloading) have distinct names and definitions.
c) Instruction Generation: For most instructions, Polygeist directly emits an MLIR operation corresponding to the equivalent C operation (addi for integer add, call for function call, etc.). For some special instructions such as a call to pow, Polygeist chooses to emit a specific MLIR operation in the Math dialect, instead of a call to an external function (defined in libm). This permits such instructions to be better analyzed and optimized within MLIR.
Operations that involve memory or pointer arithmetic require additional handling. MLIR does not have a generic pointer arithmetic instruction; instead, it requires that load and store operations contain all of the indices being looked up. This presents issues for operations that perform pointer arithmetic. To remedy this, we introduce a temporary subindex operation for memref&apos;s keeps track of the additional address offsets. A subsequent optimization pass within Polygeist, forwards the offsets in a subindex to any load or store which uses them.
d) Local Variables: Local variables are handled by allocating a memref on stack at the top of a function. This permits the desired semantics of C or C++ to be implemented with relative ease. However, as many local variables and arguments contain memref types, this immediately results in a memref of a memref-a hindrance for most MLIR optimizations as it is illegal outside of Polygeist. As a remedy, we implement a heavyweight memory-to-register (mem2reg) transformation pass that eliminates unnecessary loads, stores, and allocations within MLIR constructs. Empirically this eliminates all memrefs of memref in the Polybench suite.</p>
<p>III. &#x4E00;&#x4E2A;&#xFF08;&#x4EFF;&#x5C04;&#xFF09;MLIR&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;</p>
<p>Polygeist&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#x7531;4&#x4E2A;&#x7EC4;&#x4EF6;&#x7EC4;&#x6210;&#xFF08;&#x89C1;&#x56FE;1&#xFF09;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;Polygeist&#x80FD;&#x591F;&#x4FDD;&#x7559;&#x539F;&#x59CB;&#x7A0B;&#x5E8F;&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x66F4;&#x591A;&#x7ED3;&#x6784;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x591A;&#x7EF4;&#x6570;&#x7EC4;&#xFF09;&#xFF0C;&#x5E76;&#x80FD;&#x591F;&#x4E0E;MLIR&#x7684;&#x9AD8;&#x7EA7;&#x5185;&#x5B58;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;&#x8FD9;&#x4E0E;&#x4EFB;&#x4F55;&#x5177;&#x6709;&#x6307;&#x9488;&#x53C2;&#x6570;&#x7684;C ABI&#x4E0D;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x4E0E;C&#x51FD;&#x6570;&#x7684;&#x63A5;&#x53E3;&#x4E0D;&#x4E00;&#x81F4;&#x3002;Polygeist&#x901A;&#x8FC7;&#x4E3A;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x548C;&#x5206;&#x914D;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x4F7F;&#x5176;&#x4F7F;&#x7528;&#x4E0E;C&#x517C;&#x5BB9;&#x7684;&#x6307;&#x9488;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;memref&#xFF0C;&#x9ED8;&#x8BA4;&#x9002;&#x7528;&#x4E8E;&#x5916;&#x90E8;&#x51FD;&#x6570;&#xFF0C;&#x5982;strcmp&#x548C;scanf&#x3002;&#x5F53;&#x4F7F;&#x7528;memref ABI&#x53C2;&#x6570;&#x8C03;&#x7528;&#x6307;&#x9488; ABI&#x51FD;&#x6570;&#x65F6;&#xFF0C;Polygeist&#x751F;&#x6210;&#x5305;&#x88C5;&#x4EE3;&#x7801;&#xFF0C;&#x4ECE;memref&#x4E2D;&#x6062;&#x590D;&#x4E0E;C ABI&#x517C;&#x5BB9;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x5E76;&#x786E;&#x4FDD;&#x7ED3;&#x679C;&#x6B63;&#x786E;&#x3002;&#x56FE;5&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x6F14;&#x793A;&#x4E86;Polygeist&#x4E0E;C ABI&#x5728;&#x4E00;&#x4E2A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x4E92;&#x52A8;&#x3002;</p>
<p>&#x5728;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8FD9;&#x79CD;ABI&#x7684;&#x5DEE;&#x5F02;&#x663E;&#x5F97;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;malloc&#x5206;&#x914D;&#x6570;&#x7EC4;&#x7684;&#x51E0;&#x4E2A;&#x5B57;&#x8282;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;memref&#x5C06;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5408;&#x6CD5;&#x4EE3;&#x7801;&#xFF08;&#x56E0;&#x4E3A;memref&#x672C;&#x8EAB;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x7528;&#x539F;&#x59CB;&#x6307;&#x9488;&#x5B9E;&#x73B0;&#x7684;&#xFF09;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Polygeist&#x8BC6;&#x522B;&#x5BF9;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x66FF;&#x6362;&#x4E3A;memref&#x7684;&#x5408;&#x6CD5;&#x7B49;&#x6548;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x51FD;&#x6570;&#x548C;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4F7F;&#x7528;C&#x6216;C++ ABI&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x76F8;&#x540C;&#x540D;&#x79F0;&#x53D1;&#x51FA;&#x3002;&#x8FD9;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x5916;&#x90E8;&#x503C;&#x90FD;&#x88AB;&#x6B63;&#x786E;&#x52A0;&#x8F7D;&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x7248;&#x672C;&#x51FD;&#x6570;&#xFF08;&#x5982;C++&#x6A21;&#x677F;&#x6216;&#x91CD;&#x8F7D;&#x751F;&#x6210;&#x7684;&#x51FD;&#x6570;&#xFF09;&#x62E5;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x79F0;&#x548C;&#x5B9A;&#x4E49;&#x3002;</p>
<p>c) &#x6307;&#x4EE4;&#x751F;&#x6210;&#xFF1A;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x6307;&#x4EE4;&#xFF0C;Polygeist&#x76F4;&#x63A5;&#x53D1;&#x51FA;&#x4E0E;&#x7B49;&#x6548;C&#x64CD;&#x4F5C;&#x76F8;&#x5BF9;&#x5E94;&#x7684;MLIR&#x64CD;&#x4F5C;&#xFF08;&#x5982;&#x6574;&#x6570;&#x52A0;&#x6CD5;&#x7684;addi&#xFF0C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;call&#x7B49;&#xFF09;&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x5BF9;pow&#x7684;&#x8C03;&#x7528;&#xFF0C;Polygeist&#x9009;&#x62E9;&#x53D1;&#x51FA;Math&#x65B9;&#x8A00;&#x4E2D;&#x7279;&#x5B9A;&#x7684;MLIR&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8C03;&#x7528;&#x5916;&#x90E8;&#x51FD;&#x6570;&#xFF08;&#x5728;libm&#x4E2D;&#x5B9A;&#x4E49;&#xFF09;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x80FD;&#x591F;&#x5728;MLIR&#x4E2D;&#x66F4;&#x597D;&#x5730;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x548C;&#x4F18;&#x5316;&#x3002;</p>
<p>&#x6D89;&#x53CA;&#x5185;&#x5B58;&#x6216;&#x6307;&#x9488;&#x7B97;&#x672F;&#x7684;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x989D;&#x5916;&#x5904;&#x7406;&#x3002;MLIR&#x6CA1;&#x6709;&#x901A;&#x7528;&#x7684;&#x6307;&#x9488;&#x7B97;&#x672F;&#x6307;&#x4EE4;&#xFF1B;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x8981;&#x6C42;load&#x548C;store&#x64CD;&#x4F5C;&#x5305;&#x542B;&#x6240;&#x6709;&#x88AB;&#x67E5;&#x627E;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x8FD9;&#x4E3A;&#x6267;&#x884C;&#x6307;&#x9488;&#x7B97;&#x672F;&#x7684;&#x64CD;&#x4F5C;&#x5E26;&#x6765;&#x4E86;&#x95EE;&#x9898;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x5B50;&#x7D22;&#x5F15;&#x64CD;&#x4F5C;&#xFF0C;&#x7528;&#x4E8E;memref&#xFF0C;&#x4EE5;&#x8DDF;&#x8E2A;&#x9644;&#x52A0;&#x7684;&#x5730;&#x5740;&#x504F;&#x79FB;&#x3002;&#x5728;Polygeist&#x4E2D;&#x7684;&#x540E;&#x7EED;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5C06;&#x5B50;&#x7D22;&#x5F15;&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x8F6C;&#x53D1;&#x7ED9;&#x4EFB;&#x4F55;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x7684;load&#x6216;store&#x3002;</p>
<p>d) &#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF1A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x901A;&#x8FC7;&#x5728;&#x51FD;&#x6570;&#x9876;&#x90E8;&#x5206;&#x914D;&#x4E00;&#x4E2A;memref&#x5728;&#x6808;&#x4E0A;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;C&#x6216;C++&#x7684;&#x6240;&#x9700;&#x8BED;&#x4E49;&#x80FD;&#x591F;&#x76F8;&#x5BF9;&#x5BB9;&#x6613;&#x5730;&#x5B9E;&#x73B0;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x7531;&#x4E8E;&#x8BB8;&#x591A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x53C2;&#x6570;&#x5305;&#x542B;memref&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x7ACB;&#x5373;&#x5BFC;&#x81F4;&#x4E86;memref&#x7684;memref-&#x8FD9;&#x5BF9;&#x5927;&#x591A;&#x6570;MLIR&#x4F18;&#x5316;&#x6765;&#x8BF4;&#x662F;&#x4E00;&#x4E2A;&#x969C;&#x788D;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;Polygeist&#x4E4B;&#x5916;&#x8FD9;&#x662F;&#x4E0D;&#x5408;&#x6CD5;&#x7684;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x91CD;&#x91CF;&#x7EA7;&#x7684;&#x5185;&#x5B58;&#x5230;&#x5BC4;&#x5B58;&#x5668;&#xFF08;mem2reg&#xFF09;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x6D88;&#x9664;&#x4E86;MLIR&#x6784;&#x9020;&#x4E2D;&#x7684;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x52A0;&#x8F7D;&#x3001;&#x5B58;&#x50A8;&#x548C;&#x5206;&#x914D;&#x3002;&#x6839;&#x636E;&#x7ECF;&#x9A8C;&#xFF0C;&#x8FD9;&#x6D88;&#x9664;&#x4E86;Polybench&#x5957;&#x4EF6;&#x4E2D;&#x6240;&#x6709;memref&#x7684;memref&#x3002;</p>
<h2 id="b-raising-to-affine"># B. Raising to Affine</h2>
<p>The translation from C or C++ to MLIR directly preserves high-level information about loop structure and n-D arrays, but does not generate other Affine operations. Polygeist subsequently raises memory, conditional, and looping operations into their Affine dialect counterparts if it can prove them to be legal affine operations. If the corresponding frontend code was enclosed within #pragma scop, Polygeist assumes it is always legal to raise all operations within that region without additional checks. 1 Any operations which are not proven or assumed to be affine remain untouched. We perform simplifications on affine maps to remove loops with zero or one iteration and drop branches of a conditional with a condition known at compile time.</p>
<p>&#x5C06;C&#x6216;C++&#x76F4;&#x63A5;&#x7FFB;&#x8BD1;&#x4E3A;MLIR&#x80FD;&#x591F;&#x4FDD;&#x7559;&#x5173;&#x4E8E;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#x548C;n&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x9AD8;&#x7EA7;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x751F;&#x6210;&#x5176;&#x4ED6;&#x7684;&#x4EFF;&#x5C04;&#x64CD;&#x4F5C;&#x3002;&#x4E4B;&#x540E;&#xFF0C;Polygeist&#x5C06;&#x5185;&#x5B58;&#x3001;&#x6761;&#x4EF6;&#x548C;&#x5FAA;&#x73AF;&#x64CD;&#x4F5C;&#x63D0;&#x5347;&#x81F3;&#x5176;&#x4EFF;&#x5C04;&#x65B9;&#x8A00;&#x5BF9;&#x5E94;&#x7269;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x80FD;&#x591F;&#x8BC1;&#x660E;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x662F;&#x5408;&#x6CD5;&#x7684;&#x4EFF;&#x5C04;&#x64CD;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x76F8;&#x5E94;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x88AB;&#x5305;&#x88F9;&#x5728;<code>#pragma scop</code>&#x4E2D;&#xFF0C;Polygeist&#x5047;&#x8BBE;&#x5728;&#x8BE5;&#x533A;&#x57DF;&#x5185;&#x63D0;&#x5347;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x59CB;&#x7EC8;&#x5408;&#x6CD5;&#x7684;&#xFF0C;&#x4E14;&#x65E0;&#x9700;&#x989D;&#x5916;&#x68C0;&#x67E5;&#x3002;&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x672A;&#x88AB;&#x8BC1;&#x660E;&#x6216;&#x5047;&#x8BBE;&#x4E3A;&#x4EFF;&#x5C04;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5219;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;&#x6211;&#x4EEC;&#x5BF9;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#x8FDB;&#x884C;&#x7B80;&#x5316;&#xFF0C;&#x4EE5;&#x53BB;&#x9664;&#x5177;&#x6709;&#x96F6;&#x6B21;&#x6216;&#x4E00;&#x6B21;&#x8FED;&#x4EE3;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;&#x5E76;&#x5220;&#x9664;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x5DF2;&#x77E5;&#x6761;&#x4EF6;&#x7684;&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#x7684;&#x5206;&#x652F;&#x3002;</p>
<h2 id="a-memory-operations-and-loop-bounds"># a) Memory operations and loop bounds:</h2>
<p>To convert an operation, Polygeist replaces its bound and subscript operands with identity affine maps (affine_map&lt;() [s0]-&gt;(s0)&gt;[%bound]). It then folds the operations computing the map operands, e.g., addi, muli, into the map itself. Values that are transitively derived from loop induction variables become map dimensions and other values become symbols. For example, affine_map&lt; ()[s0]-&gt;(s0)&gt; [%bound] with %bound = addi %N, %i, where %i is an induction variable, is folded into
affine_map&lt;(d0)[s0] -&gt;(s0 + d0)&gt;(%i)[%N].
The process terminates when no operations can be folded or when Affine value categorization rules are satisfied.
b) Conditionals: Conditional operations are emitted by the frontend for two input code patterns: if conditions and ternary expressions. The condition is transformed by introducing an integer set and by folding the operands into it similarly to the affine maps, with in addition and operations separating set constraints and not operations inverting them (affine.if only accepts &#x2265; 0 and = 0 constraints). Polygeist processes nested conditionals with C-style shortcircuit semantics, in which the subsequent conditions are checked within the body of the preceding conditionals, by hoisting conditions outside the outermost conditional when legal and replacing them with a boolean operation or a select. This is always legal within #pragma scop.
Conditionals emitted for ternary expressions often involve memory loads in their regions, which prevent hoisting due to side effects. We reuse our mem2reg pass to replace those to equivalent earlier loads when possible to enable hoisting. Empirically, this is sufficient to process all ternary expressions in the Polybench/C suite [19]. Otherwise, ternary expressions would need to be packed into a single statement by the downstream polyhedral pass.</p>
<p>a) &#x5185;&#x5B58;&#x64CD;&#x4F5C;&#x548C;&#x5FAA;&#x73AF;&#x8FB9;&#x754C;&#xFF1A;&#x4E3A;&#x4E86;&#x8F6C;&#x6362;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#xFF0C;Polygeist &#x7528;&#x6052;&#x7B49;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#xFF08;affine_map&lt;() [s0]-&gt;(s0)&gt;[%bound]&#xFF09;&#x66FF;&#x6362;&#x5176;&#x8FB9;&#x754C;&#x548C;&#x4E0B;&#x6807;&#x64CD;&#x4F5C;&#x6570;&#x3002;&#x5B83;&#x7136;&#x540E;&#x5C06;&#x8BA1;&#x7B97;&#x6620;&#x5C04;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x52A0;&#x6CD5;&#xFF08;addi&#xFF09;&#x3001;&#x4E58;&#x6CD5;&#xFF08;muli&#xFF09;&#xFF0C;&#x6298;&#x53E0;&#x5230;&#x6620;&#x5C04;&#x672C;&#x8EAB;&#x4E2D;&#x3002;&#x4ECE;&#x5FAA;&#x73AF;&#x5F52;&#x7EB3;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x5F97;&#x51FA;&#x7684;&#x503C;&#x53D8;&#x6210;&#x4E86;&#x6620;&#x5C04;&#x7EF4;&#x5EA6;&#xFF0C;&#x5176;&#x4ED6;&#x503C;&#x5219;&#x53D8;&#x6210;&#x7B26;&#x53F7;&#x3002;&#x4F8B;&#x5982;&#xFF0C;affine_map&lt; ()[s0]-&gt;(s0)&gt; [%bound] &#x5728; %bound = addi %N, %i &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D; %i &#x662F;&#x4E00;&#x4E2A;&#x5F52;&#x7EB3;&#x53D8;&#x91CF;&#xFF0C;&#x88AB;&#x6298;&#x53E0;&#x4E3A; affine_map&lt;(d0)[s0] -&gt;(s0 + d0)&gt;(%i)[%N]&#x3002;&#x8BE5;&#x8FC7;&#x7A0B;&#x5728;&#x65E0;&#x6CD5;&#x518D;&#x6298;&#x53E0;&#x64CD;&#x4F5C;&#x6216;&#x6EE1;&#x8DB3;&#x4EFF;&#x5C04;&#x503C;&#x5206;&#x7C7B;&#x89C4;&#x5219;&#x65F6;&#x7EC8;&#x6B62;&#x3002;</p>
<p>b) &#x6761;&#x4EF6;&#x8BED;&#x53E5;&#xFF1A;&#x524D;&#x7AEF;&#x4E3A;&#x4E24;&#x79CD;&#x8F93;&#x5165;&#x4EE3;&#x7801;&#x6A21;&#x5F0F;&#xFF08;if &#x6761;&#x4EF6;&#x548C;&#x4E09;&#x5143;&#x8868;&#x8FBE;&#x5F0F;&#xFF09;&#x751F;&#x6210;&#x6761;&#x4EF6;&#x64CD;&#x4F5C;&#x3002;&#x6761;&#x4EF6;&#x901A;&#x8FC7;&#x5F15;&#x5165;&#x6574;&#x6570;&#x96C6;&#x5408;&#x5E76;&#x5C06;&#x64CD;&#x4F5C;&#x6570;&#x6298;&#x53E0;&#x5230;&#x5176;&#x4E2D;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#xFF0C;&#x6B64;&#x5916;&#xFF0C;&#x64CD;&#x4F5C;&#x4E4B;&#x95F4;&#x7684;&#x52A0;&#x6CD5;&#x548C;&#x8FD0;&#x7B97;&#x5206;&#x9694;&#x96C6;&#x5408;&#x7EA6;&#x675F;&#xFF0C;&#x800C;&#x975E;&#x8FD0;&#x7B97;&#x5219;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x53CD;&#x8F6C;&#xFF08;affine.if &#x4EC5;&#x63A5;&#x53D7; &#x2265; 0 &#x548C; = 0 &#x7684;&#x7EA6;&#x675F;&#xFF09;&#x3002;Polygeist &#x5904;&#x7406;&#x5D4C;&#x5957;&#x6761;&#x4EF6;&#x65F6;&#x9075;&#x5FAA; C &#x98CE;&#x683C;&#x7684;&#x77ED;&#x8DEF;&#x8BED;&#x4E49;&#xFF0C;&#x5176;&#x4E2D;&#x540E;&#x7EED;&#x6761;&#x4EF6;&#x5728;&#x524D;&#x9762;&#x6761;&#x4EF6;&#x7684;&#x4E3B;&#x4F53;&#x5185;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#xFF0C;&#x5F53;&#x6CD5;&#x5F8B;&#x5141;&#x8BB8;&#x65F6;&#xFF0C;&#x5C06;&#x6761;&#x4EF6;&#x63D0;&#x5347;&#x5230;&#x6700;&#x5916;&#x5C42;&#x6761;&#x4EF6;&#x4E4B;&#x5916;&#xFF0C;&#x5E76;&#x7528;&#x5E03;&#x5C14;&#x64CD;&#x4F5C;&#x6216;&#x9009;&#x62E9;&#x64CD;&#x4F5C;&#x66FF;&#x6362;&#x5B83;&#x4EEC;&#x3002;&#x5728; #pragma scop &#x5185;&#xFF0C;&#x8FD9;&#x603B;&#x662F;&#x5408;&#x6CD5;&#x7684;&#x3002;</p>
<p>&#x4E3A;&#x4E09;&#x5143;&#x8868;&#x8FBE;&#x5F0F;&#x751F;&#x6210;&#x7684;&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#x901A;&#x5E38;&#x6D89;&#x53CA;&#x5176;&#x533A;&#x57DF;&#x5185;&#x7684;&#x5185;&#x5B58;&#x52A0;&#x8F7D;&#xFF0C;&#x7531;&#x4E8E;&#x526F;&#x4F5C;&#x7528;&#xFF0C;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x63D0;&#x5347;&#x3002;&#x6211;&#x4EEC;&#x91CD;&#x7528; mem2reg &#x901A;&#x9053;&#xFF0C;&#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x5176;&#x66FF;&#x6362;&#x4E3A;&#x7B49;&#x6548;&#x7684;&#x65E9;&#x671F;&#x52A0;&#x8F7D;&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;&#x63D0;&#x5347;&#x3002;&#x4ECE;&#x7ECF;&#x9A8C;&#x4E0A;&#x770B;&#xFF0C;&#x8FD9;&#x8DB3;&#x4EE5;&#x5904;&#x7406; Polybench/C &#x5957;&#x4EF6;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4E09;&#x5143;&#x8868;&#x8FBE;&#x5F0F; [19]&#x3002;&#x5426;&#x5219;&#xFF0C;&#x4E09;&#x5143;&#x8868;&#x8FBE;&#x5F0F;&#x5C06;&#x9700;&#x8981;&#x88AB;&#x4E0B;&#x6E38;&#x591A;&#x9762;&#x4F53;&#x901A;&#x9053;&#x6253;&#x5305;&#x6210;&#x5355;&#x4E2A;&#x8BED;&#x53E5;&#x3002;</p>
<h2 id="c-connecting-mlir-to-polyhedral-tools-part-1"># C. Connecting MLIR to Polyhedral Tools Part-1</h2>
<p>Regions of the input program expressed using MLIR Affine dialect are amenable to the polyhedral model. Existing tools, however, cannot directly consume MLIR. We chose to implement a bi-directional conversion to and from OpenScop [20], an exchange format readily consumable by numerous polyhedral tools, including Pluto [11], and further convertible to isl [21] representation. This allows Polygeist to seamlessly connect with tools created in polyhedral compilation research without having to amend those tools to support MLIR.
Most polyhedral tools are designed to operate on C or FORTRAN inputs build around statements, which do not have a direct equivalent in MLIR. Therefore, we design a mechanism to create statement-like structure from chains of MLIR void setArray(int N, double val, double <em> array) {...} int main(int argc, char *</em> argv) { ... cmp = strcmp(str1, str2) ... double array [10]; setArray(10, 42.0, array) } &#x21D3; func @setArray(%N: i32, %val: f64, %array: memref&lt;?xf64&gt;) { %0 = index_cast %N : i32 to index affine.for %i = 0 to %0 { affine.store %val, %array[%i] : memref&lt;?xf64&gt; } return } func @main(%argc: i32, %argv: !llvm.ptr<ptr<i8>&gt;) -&gt; i32 { ... %cmp = llvm.call @strcmp(%str1, %str2) :
(!llvm.ptr<i8>, !llvm.ptr<i8>) -&gt; !llvm.i32 ... %array = memref.alloca() : memref<10xf64> %arraycst = memref.cast %array : memref<10xf64> to memref&lt;?xf64&gt; %val = constant 42.0 : f64 call @setArray(%N, %val, %arraycst) :
(i32, f64, memref&lt;?xf64&gt;) -&gt; () } Fig. 5. Example demonstrating Polygeist ABI. For functions expected to be compiled with Polygeist such as setArray, pointer arguments are replaced with memref&apos;s. For functions that require external calling conventions (such as main/strcmp), Polygeist falls back to emitting llvm.ptr and generates conversion code.
operations. We further demonstrate that this gives Polygeist an ability to favorably affect the behavior of the polyhedral scheduler by controlling statement granularity (Section III-D).</10xf64></10xf64></i8></i8></ptr<i8></p>
<p>&#x8F93;&#x5165;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528; MLIR Affine &#x65B9;&#x8A00;&#x8868;&#x8FBE;&#x7684;&#x533A;&#x57DF;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x6709;&#x5DE5;&#x5177;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; MLIR&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x5B9E;&#x73B0;&#x4E0E; OpenScop [20] &#x7684;&#x53CC;&#x5411;&#x8F6C;&#x6362;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x53EF;&#x88AB;&#x4F17;&#x591A;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7684;&#x4EA4;&#x6362;&#x683C;&#x5F0F;&#xFF0C;&#x5305;&#x62EC; Pluto [11]&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x4E00;&#x6B65;&#x53EF;&#x8F6C;&#x6362;&#x4E3A; isl [21] &#x8868;&#x793A;&#x3002;&#x8FD9;&#x4F7F;&#x5F97; Polygeist &#x80FD;&#x591F;&#x4E0E;&#x5728;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x7814;&#x7A76;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5DE5;&#x5177;&#x65E0;&#x7F1D;&#x8FDE;&#x63A5;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x4EE5;&#x652F;&#x6301; MLIR&#x3002;</p>
<p>&#x5927;&#x591A;&#x6570;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#x8BBE;&#x8BA1;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x4EE5;&#x8BED;&#x53E5;&#x4E3A;&#x57FA;&#x7840;&#x7684; C &#x6216; FORTRAN &#x8F93;&#x5165;&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x5728; MLIR &#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5BF9;&#x5E94;&#x7684;&#x7B49;&#x4EF7;&#x7269;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x4ECE;&#x4E00;&#x7CFB;&#x5217; MLIR &#x64CD;&#x4F5C;&#x521B;&#x5EFA;&#x7C7B;&#x4F3C;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x4F8B;&#x5982;&#xFF1A; </p>
<pre><code>void setArray(int N, double val, double * array) {...} 
int main(int argc, char ** argv) { ... 
cmp = strcmp(str1, str2) ... 
double array [10]; 
setArray(10, 42.0, array) }
</code></pre><p>&#x53EF;&#x8F6C;&#x6362;&#x4E3A;&#xFF1A;</p>
<pre><code>func @setArray(%N: i32, %val: f64, %array: memref&lt;?xf64&gt;) { 
    %0 = index_cast %N : i32 to index 
    affine.for %i = 0 to %0 { 
        affine.store %val, %array[%i] : memref&lt;?xf64&gt; 
    } 
    return 
} 

func @main(%argc: i32, %argv: !llvm.ptr&lt;ptr&lt;i8&gt;&gt;) -&gt; i32 { 
    ... 
    %cmp = llvm.call @strcmp(%str1, %str2) : 
    (!llvm.ptr&lt;i8&gt;, !llvm.ptr&lt;i8&gt;) -&gt; !llvm.i32 
    ... 
    %array = memref.alloca() : memref&lt;10xf64&gt; 
    %arraycst = memref.cast %array : memref&lt;10xf64&gt; to memref&lt;?xf64&gt; 
    %val = constant 42.0 : f64 
    call @setArray(%N, %val, %arraycst) : 
    (i32, f64, memref&lt;?xf64&gt;) -&gt; () 
}
</code></pre><p>&#x56FE; 5. &#x793A;&#x4F8B;&#x6F14;&#x793A;&#x4E86; Polygeist &#x7684; ABI&#x3002;&#x5BF9;&#x4E8E;&#x9884;&#x671F;&#x8981;&#x7531; Polygeist &#x7F16;&#x8BD1;&#x7684;&#x51FD;&#x6570;&#xFF08;&#x5982; setArray&#xFF09;&#xFF0C;&#x6307;&#x9488;&#x53C2;&#x6570;&#x88AB;&#x66FF;&#x6362;&#x4E3A; memref&#x3002;&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x5916;&#x90E8;&#x8C03;&#x7528;&#x7EA6;&#x5B9A;&#xFF08;&#x5982; main/strcmp&#xFF09;&#x7684;&#x51FD;&#x6570;&#xFF0C;Polygeist &#x9000;&#x56DE;&#x5230;&#x53D1;&#x51FA; llvm.ptr &#x5E76;&#x751F;&#x6210;&#x8F6C;&#x6362;&#x4EE3;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x8FDB;&#x4E00;&#x6B65;&#x8BC1;&#x660E;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97; Polygeist &#x80FD;&#x591F;&#x901A;&#x8FC7;&#x63A7;&#x5236;&#x8BED;&#x53E5;&#x7C92;&#x5EA6;&#xFF0C;&#x79EF;&#x6781;&#x5F71;&#x54CD;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x884C;&#x4E3A;&#xFF08;&#x8BE6;&#x89C1;&#x7B2C; III-D &#x8282;&#xFF09;&#x3002;</p>
<h2 id="c-connecting-mlir-to-polyhedral-tools-part-2"># C. Connecting MLIR to Polyhedral Tools Part-2</h2>
<p>a) Simple Statement Formation: Observing that C statements amenable to the polyhedral model are (mostly) variable assignments, we can derive a mechanism to identify statements from chains of MLIR operations. A store into memory is the last operation of the statement. The backward slice of this operation, i.e., the operations transitively computing its operands, belong to the statement. The slice extension stops at operations producing a value categorized as affine dimension or symbol, directly usable in affine expressions. Such values are loop induction variables or loop-invariant constants.
Some operations may end up in multiple statements if the value is used more than once. However, we need the mapping between operations and statements to be bidirectional in order to emit MLIR after the scheduler has restructured the program without considering SSA value visibility rules. If an operation with multiple uses is side effect free, Polygeist simply duplicates it. For operations whose duplication is illegal, Polygeist stores their results in stack-allocated memref&apos;s and replaces all further uses with memory loads. Figure 6 illustrates the transformation for value %0 used in operation %20. This creates a new statement.
b) Region-Spanning Dependencies: In some cases, a statement may consist of MLIR operations across different (nested) loops, e.g., a load from memory into an SSA register happens in an outer loop while it is used in inner loops. The  location of such a statement in the loop hierarchy is unclear. More importantly, it cannot be communicated to the polyhedral scheduler. Polygeist resolves this by storing the value in a stack-allocated memref in the defining region and loading it back in the user regions. Figure 6 illustrates this transformation for value %0 used in operation %10. Similarly to the basic case, this creates a new statement in the outer loop that can be scheduled independently.
This approach can be seen as a reg2mem conversion, the inverse of mem2reg performed in the frontend. It only applies to a subset of values, and may be undone after polyhedral scheduling has completed. Furthermore, to decrease the number of dependencies and memory footprint, Polygeist performs a simple value analysis and avoids creating stack-allocated buffers if the same value is already available in another memory location and can be read from there.</p>
<p>a) &#x7B80;&#x5355;&#x8BED;&#x53E5;&#x5F62;&#x6210;&#xFF1A;&#x89C2;&#x5BDF;&#x5230;&#x7B26;&#x5408;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x7684;C&#x8BED;&#x53E5;&#x4E3B;&#x8981;&#x662F;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63A8;&#x5BFC;&#x51FA;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x4ECE;MLIR&#x64CD;&#x4F5C;&#x94FE;&#x4E2D;&#x8BC6;&#x522B;&#x8BED;&#x53E5;&#x3002;&#x5B58;&#x50A8;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x662F;&#x8BE5;&#x8BED;&#x53E5;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x3002;&#x8BE5;&#x64CD;&#x4F5C;&#x7684;&#x9006;&#x5411;&#x5207;&#x7247;&#xFF0C;&#x5373;&#x4F20;&#x9012;&#x8BA1;&#x7B97;&#x5176;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5C5E;&#x4E8E;&#x8BE5;&#x8BED;&#x53E5;&#x3002;&#x5207;&#x7247;&#x6269;&#x5C55;&#x5728;&#x751F;&#x6210;&#x88AB;&#x5206;&#x7C7B;&#x4E3A;&#x4EFF;&#x5C04;&#x7EF4;&#x5EA6;&#x6216;&#x7B26;&#x53F7;&#x7684;&#x503C;&#x7684;&#x64CD;&#x4F5C;&#x5904;&#x505C;&#x6B62;&#xFF0C;&#x8FD9;&#x4E9B;&#x503C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x4E8E;&#x4EFF;&#x5C04;&#x8868;&#x8FBE;&#x5F0F;&#x3002;&#x6B64;&#x7C7B;&#x503C;&#x5305;&#x62EC;&#x5FAA;&#x73AF;&#x5F52;&#x7EB3;&#x53D8;&#x91CF;&#x6216;&#x5FAA;&#x73AF;&#x4E0D;&#x53D8;&#x5E38;&#x91CF;&#x3002;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x5728;&#x591A;&#x4E2A;&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x503C;&#x88AB;&#x591A;&#x6B21;&#x4F7F;&#x7528;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x4E0E;&#x8BED;&#x53E5;&#x4E4B;&#x95F4;&#x7684;&#x6620;&#x5C04;&#x662F;&#x53CC;&#x5411;&#x7684;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x8C03;&#x5EA6;&#x5668;&#x91CD;&#x65B0;&#x7ED3;&#x6784;&#x5316;&#x7A0B;&#x5E8F;&#x540E;&#x53D1;&#x51FA;MLIR&#xFF0C;&#x800C;&#x4E0D;&#x8003;&#x8651;SSA&#x503C;&#x7684;&#x53EF;&#x89C1;&#x6027;&#x89C4;&#x5219;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x591A;&#x6B21;&#x4F7F;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#x6CA1;&#x6709;&#x526F;&#x4F5C;&#x7528;&#xFF0C;Polygeist&#x4F1A;&#x7B80;&#x5355;&#x5730;&#x590D;&#x5236;&#x5B83;&#x3002;&#x5BF9;&#x4E8E;&#x91CD;&#x590D;&#x64CD;&#x4F5C;&#x7684;&#x590D;&#x5236;&#x4E0D;&#x5408;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#xFF0C;Polygeist&#x5C06;&#x5176;&#x7ED3;&#x679C;&#x5B58;&#x50A8;&#x5728;&#x5806;&#x6808;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5F15;&#x7528;&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;&#x6240;&#x6709;&#x540E;&#x7EED;&#x4F7F;&#x7528;&#x66FF;&#x6362;&#x4E3A;&#x5185;&#x5B58;&#x52A0;&#x8F7D;&#x3002;&#x56FE;6&#x5C55;&#x793A;&#x4E86;&#x5728;&#x64CD;&#x4F5C;%20&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x503C;%0&#x7684;&#x8F6C;&#x6362;&#x3002;&#x8FD9;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BED;&#x53E5;&#x3002;</p>
<p>b) &#x8DE8;&#x533A;&#x57DF;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF1A;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x53EF;&#x80FD;&#x7531;&#x4E0D;&#x540C;&#xFF08;&#x5D4C;&#x5957;&#xFF09;&#x5FAA;&#x73AF;&#x4E2D;&#x7684;MLIR&#x64CD;&#x4F5C;&#x7EC4;&#x6210;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4ECE;&#x5185;&#x5B58;&#x52A0;&#x8F7D;&#x5230;SSA&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x64CD;&#x4F5C;&#x53D1;&#x751F;&#x5728;&#x5916;&#x90E8;&#x5FAA;&#x73AF;&#x4E2D;&#xFF0C;&#x800C;&#x5B83;&#x5728;&#x5185;&#x90E8;&#x5FAA;&#x73AF;&#x4E2D;&#x88AB;&#x4F7F;&#x7528;&#x3002;&#x8BE5;&#x8BED;&#x53E5;&#x5728;&#x5FAA;&#x73AF;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x5E76;&#x4E0D;&#x660E;&#x786E;&#x3002;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x65E0;&#x6CD5;&#x5C06;&#x5176;&#x4F20;&#x8FBE;&#x7ED9;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#x3002;Polygeist&#x901A;&#x8FC7;&#x5728;&#x5B9A;&#x4E49;&#x533A;&#x57DF;&#x4E2D;&#x5C06;&#x503C;&#x5B58;&#x50A8;&#x5728;&#x5806;&#x6808;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5F15;&#x7528;&#x4E2D;&#xFF0C;&#x5E76;&#x5728;&#x4F7F;&#x7528;&#x533A;&#x57DF;&#x4E2D;&#x5C06;&#x5176;&#x52A0;&#x8F7D;&#x56DE;&#x53BB;&#xFF0C;&#x4ECE;&#x800C;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#x3002;&#x56FE;6&#x5C55;&#x793A;&#x4E86;&#x5728;&#x64CD;&#x4F5C;%10&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x503C;%0&#x7684;&#x8FD9;&#x79CD;&#x8F6C;&#x6362;&#x3002;&#x4E0E;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x7C7B;&#x4F3C;&#xFF0C;&#x8FD9;&#x5728;&#x5916;&#x90E8;&#x5FAA;&#x73AF;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BED;&#x53E5;&#xFF0C;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x8C03;&#x5EA6;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;reg2mem&#x8F6C;&#x6362;&#xFF0C;&#x8FD9;&#x662F;&#x5728;&#x524D;&#x7AEF;&#x6267;&#x884C;&#x7684;mem2reg&#x7684;&#x53CD;&#x5411;&#x64CD;&#x4F5C;&#x3002;&#x5B83;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x4E00;&#x90E8;&#x5206;&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5B8C;&#x6210;&#x540E;&#x53EF;&#x4EE5;&#x64A4;&#x9500;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x548C;&#x5185;&#x5B58;&#x5360;&#x7528;&#xFF0C;Polygeist&#x6267;&#x884C;&#x7B80;&#x5355;&#x7684;&#x503C;&#x5206;&#x6790;&#xFF0C;&#x5E76;&#x5728;&#x540C;&#x4E00;&#x503C;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x4F4D;&#x7F6E;&#x53EF;&#x7528;&#x5E76;&#x80FD;&#x591F;&#x4ECE;&#x90A3;&#x91CC;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x907F;&#x514D;&#x521B;&#x5EFA;&#x5806;&#x6808;&#x5206;&#x914D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;</p>
<h2 id="c-connecting-mlir-to-polyhedral-tools-part-3"># C. Connecting MLIR to Polyhedral Tools Part-3</h2>
<p>c) SCoP Formation: To define a SCoP, we outline individual statements into functions so that they can be represented as opaque calls with known memory footprints, similarly to Pencil [22]. This process also makes the inter-statement SSA dependencies clear. These dependencies exist between calls that use the same SSA value, but there are no values defined by these calls. We lift all local stack allocations and place them at the entry block of the surrounding function in order to keep them visible after loop restructuring. Figure 7 demonstrates the resulting IR.
The remaining components of the polyhedral representation are derived as follows: the domain of the statement is defined to be the iteration space of its enclosing loops, constrained by their respective lower and upper bounds, and intersected with any &quot;if&quot; conditions. This process leverages the fact that MLIR expresses bounds and conditions directly as affine constructs. The access relations for each statement are obtained  as unions of affine maps of the affine.load (read) and affine.store (must-write) operations, with RHS of the relation annotated by an &quot;array&quot; that corresponds to the SSA value of the accessed memref. Initial schedules are assigned using the (2d + 1) formalism, with odd dimensions representing the lexical order of loops in the input program and even dimensions being equal to loop induction variables. Affine constructs in OpenScop are represented as lists of linear equality (= 0) or inequality (&#x2265; 0) coefficients, which matches exactly the internal representation in MLIR, making the conversion straightforward.
d) Code Generation Back to MLIR: The Pluto scheduler produces new schedules in OpenScop as a result. Generating loop structure back from affine schedules is a solved, albeit daunting, problem [13], [14]. Polygeist relies on CLooG [13] to generate an initial loop-level AST, which it then converts to Affine dialect loops and conditionals. There is no need to simplify affine expressions at code generation since MLIR accepts them directly and can simplify them at a later stage. Statements are introduced as function calls with rewritten operands and then inlined.</p>
<p>c) SCoP &#x5F62;&#x6210;&#xFF1A;&#x4E3A;&#x4E86;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; SCoP&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5355;&#x72EC;&#x7684;&#x8BED;&#x53E5;&#x5212;&#x5206;&#x4E3A;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x5B83;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x8868;&#x793A;&#x4E3A;&#x5177;&#x6709;&#x5DF2;&#x77E5;&#x5185;&#x5B58;&#x5360;&#x7528;&#x7684;&#x900F;&#x660E;&#x8C03;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E; Pencil [22]&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E5F;&#x4F7F;&#x5F97;&#x8BED;&#x53E5;&#x95F4;&#x7684; SSA &#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x53D8;&#x5F97;&#x6E05;&#x6670;&#x3002;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x5B58;&#x5728;&#x4E8E;&#x4F7F;&#x7528;&#x76F8;&#x540C; SSA &#x503C;&#x7684;&#x8C03;&#x7528;&#x4E4B;&#x95F4;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x8C03;&#x7528;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x4EFB;&#x4F55;&#x503C;&#x3002;&#x6211;&#x4EEC;&#x63D0;&#x5347;&#x6240;&#x6709;&#x5C40;&#x90E8;&#x6808;&#x5206;&#x914D;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x4EEC;&#x653E;&#x7F6E;&#x5728;&#x5468;&#x56F4;&#x51FD;&#x6570;&#x7684;&#x5165;&#x53E3;&#x5757;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;&#x5B83;&#x4EEC;&#x5728;&#x5FAA;&#x73AF;&#x91CD;&#x6784;&#x540E;&#x4ECD;&#x7136;&#x53EF;&#x89C1;&#x3002;&#x56FE; 7 &#x5C55;&#x793A;&#x4E86;&#x5F97;&#x5230;&#x7684; IR&#x3002;</p>
<p>&#x591A;&#x9762;&#x4F53;&#x8868;&#x793A;&#x7684;&#x5176;&#x4F59;&#x7EC4;&#x4EF6;&#x5982;&#x4E0B;&#x6D3E;&#x751F;&#xFF1A;&#x8BED;&#x53E5;&#x7684;&#x57DF;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x5176;&#x6240;&#x5305;&#x542B;&#x5FAA;&#x73AF;&#x7684;&#x8FED;&#x4EE3;&#x7A7A;&#x95F4;&#xFF0C;&#x7531;&#x5404;&#x81EA;&#x7684;&#x4E0B;&#x754C;&#x548C;&#x4E0A;&#x754C;&#x7EA6;&#x675F;&#xFF0C;&#x5E76;&#x4E0E;&#x4EFB;&#x4F55;&#x201C;if&#x201D;&#x6761;&#x4EF6;&#x76F8;&#x4EA4;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5229;&#x7528;&#x4E86; MLIR &#x76F4;&#x63A5;&#x5C06;&#x8FB9;&#x754C;&#x548C;&#x6761;&#x4EF6;&#x8868;&#x793A;&#x4E3A;&#x4EFF;&#x5C04;&#x6784;&#x9020;&#x7684;&#x7279;&#x6027;&#x3002;&#x6BCF;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x8BBF;&#x95EE;&#x5173;&#x7CFB;&#x4F5C;&#x4E3A; affine.load&#xFF08;&#x8BFB;&#x53D6;&#xFF09;&#x548C; affine.store&#xFF08;&#x5FC5;&#x987B;&#x5199;&#x5165;&#xFF09;&#x64CD;&#x4F5C;&#x7684;&#x4EFF;&#x5C04;&#x6620;&#x5C04;&#x7684;&#x5E76;&#x96C6;&#x83B7;&#x5F97;&#xFF0C;&#x5173;&#x7CFB;&#x7684;&#x53F3;&#x4FA7;&#x88AB;&#x6CE8;&#x91CA;&#x4E3A;&#x4E0E;&#x88AB;&#x8BBF;&#x95EE;&#x7684; memref &#x5BF9;&#x5E94;&#x7684;&#x201C;&#x6570;&#x7EC4;&#x201D;&#xFF0C;&#x8FD9;&#x5BF9;&#x5E94;&#x4E8E; SSA &#x503C;&#x3002;&#x521D;&#x59CB;&#x8C03;&#x5EA6;&#x662F;&#x4F7F;&#x7528; (2d + 1) &#x5F62;&#x5F0F;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x5947;&#x6570;&#x7EF4;&#x5EA6;&#x8868;&#x793A;&#x8F93;&#x5165;&#x7A0B;&#x5E8F;&#x4E2D;&#x5FAA;&#x73AF;&#x7684;&#x8BCD;&#x6CD5;&#x987A;&#x5E8F;&#xFF0C;&#x800C;&#x5076;&#x6570;&#x7EF4;&#x5EA6;&#x7B49;&#x4E8E;&#x5FAA;&#x73AF;&#x5F15;&#x5BFC;&#x53D8;&#x91CF;&#x3002;OpenScop &#x4E2D;&#x7684;&#x4EFF;&#x5C04;&#x6784;&#x9020;&#x8868;&#x793A;&#x4E3A;&#x7EBF;&#x6027;&#x7B49;&#x5F0F; (= 0) &#x6216;&#x4E0D;&#x7B49;&#x5F0F; (&#x2265; 0) &#x7CFB;&#x6570;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x6B63;&#x597D;&#x4E0E; MLIR &#x4E2D;&#x7684;&#x5185;&#x90E8;&#x8868;&#x793A;&#x76F8;&#x5339;&#x914D;&#xFF0C;&#x4F7F;&#x8F6C;&#x6362;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x660E;&#x4E86;&#x3002;</p>
<p>d) &#x4EE3;&#x7801;&#x751F;&#x6210;&#x56DE; MLIR&#xFF1A;Pluto &#x8C03;&#x5EA6;&#x5668;&#x56E0;&#x6B64;&#x751F;&#x6210;&#x4E86; OpenScop &#x4E2D;&#x7684;&#x65B0;&#x8C03;&#x5EA6;&#x3002;&#x4ECE;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x751F;&#x6210;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#x662F;&#x4E00;&#x4E2A;&#x5DF2;&#x89E3;&#x51B3;&#x4F46;&#x76F8;&#x5F53;&#x590D;&#x6742;&#x7684;&#x95EE;&#x9898; [13]&#xFF0C;[14]&#x3002;Polygeist &#x4F9D;&#x8D56;&#x4E8E; CLooG [13] &#x6765;&#x751F;&#x6210;&#x521D;&#x59CB;&#x7684;&#x5FAA;&#x73AF;&#x7EA7; AST&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x4EFF;&#x5C04;&#x65B9;&#x8A00;&#x7684;&#x5FAA;&#x73AF;&#x548C;&#x6761;&#x4EF6;&#x3002;&#x5728;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x65F6;&#x65E0;&#x9700;&#x7B80;&#x5316;&#x4EFF;&#x5C04;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A; MLIR &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63A5;&#x53D7;&#x5B83;&#x4EEC;&#xFF0C;&#x5E76;&#x80FD;&#x591F;&#x5728;&#x540E;&#x7EED;&#x9636;&#x6BB5;&#x8FDB;&#x884C;&#x7B80;&#x5316;&#x3002;&#x8BED;&#x53E5;&#x4F5C;&#x4E3A;&#x5177;&#x6709;&#x91CD;&#x5199;&#x64CD;&#x4F5C;&#x6570;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x5F15;&#x5165;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5185;&#x8054;&#x3002;</p>
<h2 id="d-controlling-statement-granularity"># D. Controlling Statement Granularity</h2>
<p>Recall that Polygeist reconstructs &quot;statements&quot; from sequences of primitive operations (Section III-C). We initially designed an approach that recovers the statement structure similar to that in the C input, but this is not a requirement. Instead, statements can be formed from any subsets of MLIR operations as long as they can be organized into loops and sorted topologically (i.e., there are no use-def cycles between statements). To expose the dependencies between such statements to the affine scheduler, we reuse the idea of going through scratchpad memory: each statement writes the values required by other statements to dedicated memory locations, and the following statements read from those. The scratchpads are subject to partial array expansion [23] to minimize their effect on the affine scheduler as single-element scratchpad arrays create artificial scalar dependencies. This change in statement granularity gives the affine scheduler unprecedented flexibility allowing it to chose different schedules for different parts of the same C statement. Consider, for example, the statement S in Figure 8(top) surrounded by three loops iterating over i, j and k. Such contraction patterns are common in computational programs (this particular example can be found in the correlation benchmark with B&#x2261;C, see Section V-E). The loop order that best exploits the locality is (k, i, j), which results in temporal locality for reads from B (the value is reused in all iterations of the now-innermost j loop) and in spatial locality for reads from C (consecutive values are read by consecutive iterations, increasing the likelihood of L1 cache hits). Yet, Pluto never proposes such an order because of a reduction dependency along the k dimension due to repeated read/write access to A[i][j] as Pluto tends to pick loops with fewer dependencies as outermost. While the dependency itself is inevitable, it can be moved into a separate statement T in Figure 8(bottom left). This approach provides scheduler with more freedom of choice for the first statement at a lesser memory cost than expanding the entire A array. It also factors out the reduction into a &quot;canonical&quot; statement that is easier to process for the downstream passes, e.g., vectorization.
Implementing this transformation at the C level would require manipulating C AST and reasoning about C (or even C++) semantics. This is typically out of reach for source-tosource polyhedral optimizers such as Pluto that treat statements as black boxes. While it is possible to implement this transformation at the LLVM IR level, e.g., in Polly, where statements are also reconstructed and injection of temporary allocations is easy, the heuristic driving the transformation is based on the loop structure and multi-dimensional access patterns which are difficult to recover at such a low level [9].
The space of potential splittings is huge-each MLIR operation can potentially become a statement. Therefore, we devise a heuristic to address the contraction cases similar to Figure 8. Reduction statement splitting applies to statements:
&#x2022; surrounded by at least 3 loops;
&#x2022; with LHS =RHS, and using all loops but the innermost;
&#x2022; with two or more different access patterns on the RHS. This covers statements that could have locality improved by a different loop order and with low risk of undesired fission. This heuristic merely serves as an illustration of the kind of new transformations Polygeist can enable.</p>
<p>D. &#x63A7;&#x5236;&#x8BED;&#x53E5;&#x7C92;&#x5EA6;</p>
<p>&#x56DE;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;Polygeist &#x662F;&#x901A;&#x8FC7;&#x539F;&#x59CB;&#x64CD;&#x4F5C;&#x7684;&#x5E8F;&#x5217;&#x91CD;&#x5EFA;&#x201C;&#x8BED;&#x53E5;&#x201D;&#x7684;&#xFF08;&#x89C1;&#x7B2C;&#x4E09;&#x8282;C&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x6700;&#x521D;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x79CD;&#x6062;&#x590D;&#x4E0E; C &#x8F93;&#x5165;&#x4E2D;&#x76F8;&#x4F3C;&#x7684;&#x8BED;&#x53E5;&#x7ED3;&#x6784;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x53EA;&#x8981;&#x53EF;&#x4EE5;&#x5C06;&#x8BED;&#x53E5;&#x7EC4;&#x7EC7;&#x6210;&#x5FAA;&#x73AF;&#x5E76;&#x8FDB;&#x884C;&#x62D3;&#x6251;&#x6392;&#x5E8F;&#xFF08;&#x5373;&#x8BED;&#x53E5;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x4F7F;&#x7528;-&#x5B9A;&#x4E49;&#x5FAA;&#x73AF;&#xFF09;&#xFF0C;&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x7531;&#x4EFB;&#x4F55;&#x5B50;&#x96C6;&#x7684; MLIR &#x64CD;&#x4F5C;&#x5F62;&#x6210;&#x3002;&#x4E3A;&#x4E86;&#x5411;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x66B4;&#x9732;&#x8FD9;&#x4E9B;&#x8BED;&#x53E5;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x91CD;&#x7528;&#x4E86;&#x901A;&#x8FC7;&#x4E34;&#x65F6;&#x5B58;&#x50A8;&#x5668;&#x7684;&#x601D;&#x60F3;&#xFF1A;&#x6BCF;&#x4E2A;&#x8BED;&#x53E5;&#x5C06;&#x5176;&#x4ED6;&#x8BED;&#x53E5;&#x6240;&#x9700;&#x7684;&#x503C;&#x5199;&#x5165;&#x4E13;&#x7528;&#x5185;&#x5B58;&#x4F4D;&#x7F6E;&#xFF0C;&#x968F;&#x540E;&#x8BED;&#x53E5;&#x4ECE;&#x8FD9;&#x4E9B;&#x4F4D;&#x7F6E;&#x8BFB;&#x53D6;&#x3002;&#x4E34;&#x65F6;&#x5B58;&#x50A8;&#x5668;&#x53D7;&#x5230;&#x90E8;&#x5206;&#x6570;&#x7EC4;&#x6269;&#x5C55;&#x7684;&#x9650;&#x5236;[23]&#xFF0C;&#x4EE5;&#x6700;&#x5C0F;&#x5316;&#x5B83;&#x4EEC;&#x5BF9;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x4E3A;&#x5355;&#x5143;&#x7D20;&#x7684;&#x4E34;&#x65F6;&#x5B58;&#x50A8;&#x5668;&#x6570;&#x7EC4;&#x4F1A;&#x4EA7;&#x751F;&#x4EBA;&#x4E3A;&#x7684;&#x6807;&#x91CF;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;&#x8FD9;&#x79CD;&#x8BED;&#x53E5;&#x7C92;&#x5EA6;&#x7684;&#x53D8;&#x5316;&#x4E3A;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x524D;&#x6240;&#x672A;&#x6709;&#x7684;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x4F7F;&#x5176;&#x80FD;&#x591F;&#x4E3A;&#x540C;&#x4E00; C &#x8BED;&#x53E5;&#x7684;&#x4E0D;&#x540C;&#x90E8;&#x5206;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x8C03;&#x5EA6;&#x3002;&#x4EE5;&#x56FE;8&#xFF08;&#x9876;&#x90E8;&#xFF09;&#x4E2D;&#x7684;&#x8BED;&#x53E5; S &#x4E3A;&#x4F8B;&#xFF0C;&#x8BE5;&#x8BED;&#x53E5;&#x88AB;&#x4E09;&#x4E2A;&#x9488;&#x5BF9; i&#x3001;j &#x548C; k &#x7684;&#x5FAA;&#x73AF;&#x5305;&#x56F4;&#x3002;&#x8FD9;&#x79CD;&#x6536;&#x7F29;&#x6A21;&#x5F0F;&#x5728;&#x8BA1;&#x7B97;&#x7A0B;&#x5E8F;&#x4E2D;&#x5F88;&#x5E38;&#x89C1;&#xFF08;&#x6B64;&#x7279;&#x5B9A;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x5728;&#x76F8;&#x5173;&#x57FA;&#x51C6;&#x4E2D;&#x627E;&#x5230;&#xFF0C;B&#x2261;C&#xFF0C;&#x89C1;&#x7B2C;&#x4E94;&#x8282;E&#xFF09;&#x3002;&#x6700;&#x4F73;&#x5229;&#x7528;&#x5C40;&#x90E8;&#x6027;&#x7684;&#x5FAA;&#x73AF;&#x987A;&#x5E8F;&#x662F; (k, i, j)&#xFF0C;&#x8FD9;&#x5BF9;&#x4ECE; B &#x7684;&#x8BFB;&#x53D6;&#x4EA7;&#x751F;&#x65F6;&#x6548;&#x5C40;&#x90E8;&#x6027;&#xFF08;&#x8BE5;&#x503C;&#x5728;&#x73B0;&#x5728;&#x6700;&#x5185;&#x5C42;&#x7684; j &#x5FAA;&#x73AF;&#x7684;&#x6240;&#x6709;&#x8FED;&#x4EE3;&#x4E2D;&#x88AB;&#x91CD;&#x7528;&#xFF09;&#x5E76;&#x5BF9;&#x4ECE; C &#x7684;&#x8BFB;&#x53D6;&#x4EA7;&#x751F;&#x7A7A;&#x95F4;&#x5C40;&#x90E8;&#x6027;&#xFF08;&#x8FDE;&#x7EED;&#x7684;&#x503C;&#x88AB;&#x8FDE;&#x7EED;&#x7684;&#x8FED;&#x4EE3;&#x8BFB;&#x53D6;&#xFF0C;&#x4ECE;&#x800C;&#x589E;&#x52A0;&#x4E86; L1 &#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x7684;&#x53EF;&#x80FD;&#x6027;&#xFF09;&#x3002;&#x7136;&#x800C;&#xFF0C;Pluto &#x4ECE;&#x672A;&#x63D0;&#x51FA;&#x8FD9;&#x6837;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728; k &#x7EF4;&#x5EA6;&#x4E0A;&#x7531;&#x4E8E;&#x5BF9; A[i][j] &#x7684;&#x91CD;&#x590D;&#x8BFB;/&#x5199;&#x8BBF;&#x95EE;&#x800C;&#x5B58;&#x5728;&#x51CF;&#x5C11;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;Pluto &#x8D8B;&#x5411;&#x4E8E;&#x9009;&#x62E9;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x8F83;&#x5C11;&#x7684;&#x5FAA;&#x73AF;&#x4F5C;&#x4E3A;&#x6700;&#x5916;&#x5C42;&#x3002;&#x867D;&#x7136;&#x8FD9;&#x79CD;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#x7684;&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x4EE5;&#x8F6C;&#x79FB;&#x5230;&#x56FE;8&#xFF08;&#x5E95;&#x90E8;&#x5DE6;&#x4FA7;&#xFF09;&#x7684;&#x5355;&#x72EC;&#x8BED;&#x53E5; T &#x4E2D;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4E3A;&#x8C03;&#x5EA6;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x9009;&#x62E9;&#x81EA;&#x7531;&#x5EA6;&#xFF0C;&#x5185;&#x5B58;&#x6210;&#x672C;&#x76F8;&#x5BF9;&#x8F83;&#x4F4E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6269;&#x5C55;&#x6574;&#x4E2A; A &#x6570;&#x7EC4;&#x3002;&#x5B83;&#x8FD8;&#x5C06;&#x51CF;&#x5C11;&#x95EE;&#x9898;&#x5206;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x201C;&#x89C4;&#x8303;&#x201D;&#x8BED;&#x53E5;&#xFF0C;&#x4F7F;&#x5F97;&#x4E0B;&#x6E38;&#x5904;&#x7406;&#xFF08;&#x4F8B;&#x5982;&#x5411;&#x91CF;&#x5316;&#xFF09;&#x66F4;&#x5BB9;&#x6613;&#x8FDB;&#x884C;&#x3002;</p>
<p>&#x5728; C &#x7EA7;&#x522B;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x8F6C;&#x6362;&#x5C06;&#x9700;&#x8981;&#x64CD;&#x4F5C; C &#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;&#xFF08;AST&#xFF09;&#x5E76;&#x63A8;&#x7406; C&#xFF08;&#x751A;&#x81F3; C++&#xFF09;&#x7684;&#x8BED;&#x4E49;&#x3002;&#x8FD9;&#x901A;&#x5E38;&#x8D85;&#x51FA;&#x4E86;&#x8BF8;&#x5982; Pluto &#x8FD9;&#x6837;&#x7684;&#x6E90;&#x5230;&#x6E90;&#x591A;&#x9762;&#x4F53;&#x4F18;&#x5316;&#x5668;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x5668;&#x5C06;&#x8BED;&#x53E5;&#x89C6;&#x4E3A;&#x9ED1;&#x7BB1;&#x3002;&#x867D;&#x7136;&#x5728; LLVM IR &#x7EA7;&#x522B;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x8F6C;&#x6362;&#x4E5F;&#x662F;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x5728; Polly &#x4E2D;&#xFF0C;&#x5728;&#x90A3;&#x91CC;&#x8BED;&#x53E5;&#x4E5F;&#x88AB;&#x91CD;&#x5EFA;&#x4E14;&#x6682;&#x65F6;&#x5206;&#x914D;&#x7684;&#x6CE8;&#x5165;&#x8F83;&#x4E3A;&#x5BB9;&#x6613;&#xFF0C;&#x4F46;&#x9A71;&#x52A8;&#x8F6C;&#x6362;&#x7684;&#x542F;&#x53D1;&#x5F0F;&#x662F;&#x57FA;&#x4E8E;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#x548C;&#x591A;&#x7EF4;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#x7684;&#xFF0C;&#x800C;&#x5728;&#x5982;&#x6B64;&#x4F4E;&#x7684;&#x7EA7;&#x522B;&#x6062;&#x590D;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x662F;&#x56F0;&#x96BE;&#x7684;[9]&#x3002;</p>
<p>&#x6F5C;&#x5728;&#x5206;&#x5272;&#x7684;&#x7A7A;&#x95F4;&#x662F;&#x5DE8;&#x5927;&#x7684;&#x2014;&#x2014;&#x6BCF;&#x4E2A; MLIR &#x64CD;&#x4F5C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x79CD;&#x542F;&#x53D1;&#x5F0F;&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;&#x7C7B;&#x4F3C;&#x4E8E;&#x56FE;8&#x7684;&#x6536;&#x7F29;&#x60C5;&#x51B5;&#x3002;&#x51CF;&#x5C11;&#x8BED;&#x53E5;&#x5206;&#x5272;&#x9002;&#x7528;&#x4E8E;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#xFF1A;
&#x2022; &#x81F3;&#x5C11;&#x88AB; 3 &#x4E2A;&#x5FAA;&#x73AF;&#x5305;&#x56F4;&#xFF1B;
&#x2022; &#x5DE6;&#x4FA7; = &#x53F3;&#x4FA7;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x6240;&#x6709;&#x5FAA;&#x73AF;&#xFF0C;&#x9664;&#x4E86;&#x6700;&#x5185;&#x5C42;&#x7684;&#xFF1B;
&#x2022; &#x53F3;&#x4FA7;&#x5177;&#x6709;&#x4E24;&#x4E2A;&#x6216;&#x66F4;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#x3002;&#x8FD9;&#x6DB5;&#x76D6;&#x4E86;&#x90A3;&#x4E9B;&#x53EF;&#x80FD;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x5FAA;&#x73AF;&#x987A;&#x5E8F;&#x6539;&#x5584;&#x5C40;&#x90E8;&#x6027;&#x7684;&#x8BED;&#x53E5;&#xFF0C;&#x5E76;&#x4E14;&#x98CE;&#x9669;&#x8F83;&#x4F4E;&#xFF0C;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x4E0D;&#x5E0C;&#x671B;&#x7684;&#x5206;&#x88C2;&#x3002;&#x8FD9;&#x4E2A;&#x542F;&#x53D1;&#x5F0F;&#x65B9;&#x6CD5;&#x4EC5;&#x4F5C;&#x4E3A; Polygeist &#x80FD;&#x591F;&#x542F;&#x7528;&#x7684;&#x65B0;&#x8F6C;&#x6362;&#x7C7B;&#x578B;&#x7684;&#x793A;&#x4F8B;&#x3002;</p>
<h2 id="e-post-transformations-and-backend"># E. Post-Transformations and Backend</h2>
<p>Polygeist allows one to operate on both quasi-syntactic and SSA level, enabling analyses and optimizations that are extremely difficult, if not impossible, to perform at either level in isolation. In addition to statement splitting, we propose two techniques that demonstrate the potential of Polygeist.
a) Transforming Loops with Carried Values (Reductions): Polygeist leverages MLIR&apos;s first-class support for loopcarried values to detect, express and transform reduction-like loops. This support does not require source code annotations, unlike source-level tools [24] that use annotations to enable detection, nor complex modifications for parallel code emission, unlike Polly [25], which suffers from LLVM missing first-class parallel constructs. We do not modify the polyhedral scheduler either, relying on post-processing for reduction parallelization, including outermost parallel reduction loops.
The overall approach follows the definition proposed in [26] with adaptations to MLIR&apos;s region-based IR, and is illustrated in Figure 9. Polygeist identifies memory locations modified on each iteration, i.e. load/store pairs with loop-invariant subscripts and no interleaving aliasing stores, by scanning the single-block body of the loop. These are transformed into loop-carried values or secondary induction variables, with the load/store pair lifted out of the loop and repurposed for reading the initial and storing the final value. Loop-carried values may be updated by a chain of side effect-free operations in the loop body. If this chain is known to be associative and commutative, the loop is a reduction. Loop-carried values are detected even in absence of reduction-compatible operations. Loops with such values contribute to mem2reg, decreasing memory footprint, but are not subject to parallelization. b) Late Parallelization: Rather than relying on the dependence distance information obtained by the affine scheduler, Polygeist performs a separate polyhedral analysis to detect loop parallelism in the generated code. The analysis itself is a classical polyhedral dependence analysis [27], [28] implemented on top of MLIR region structure. Performing it after SSA-based optimizations, in particular mem2reg and reduction detection, allows parallelizing more loops. In particular, reduction loops and loops with variables whose value is only relevant within a single iteration similar to live-range reordering [29] but without expensive additional polyhedral analyses (live-range of an SSA value defined in a loop never extends beyond the loop).</p>
<p>E. &#x540E;&#x53D8;&#x6362;&#x53CA;&#x540E;&#x7AEF;</p>
<p>Polygeist &#x4F7F;&#x5F97;&#x5728; quasi-syntactic &#x548C; SSA &#x5C42;&#x9762;&#x4E0A;&#x64CD;&#x4F5C;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;&#x5728;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5C42;&#x9762;&#x4E0A;&#x5355;&#x72EC;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x548C;&#x4F18;&#x5316;&#x65F6;&#x6781;&#x5176;&#x56F0;&#x96BE;&#xFF08;&#x751A;&#x81F3;&#x4E0D;&#x53EF;&#x80FD;&#xFF09;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x9664;&#x4E86;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x4E86;&#x4E24;&#x79CD;&#x5C55;&#x793A; Polygeist &#x6F5C;&#x529B;&#x7684;&#x6280;&#x672F;&#x3002;</p>
<p>a) &#x8F6C;&#x6362;&#x5E26;&#x6709;&#x5EF6;&#x7EED;&#x503C;&#x7684;&#x5FAA;&#x73AF;&#xFF08;&#x5F52;&#x7EA6;&#xFF09;&#xFF1A;Polygeist &#x5229;&#x7528; MLIR &#x5BF9;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x503C;&#x7684;&#x4E00;&#x7EA7;&#x652F;&#x6301;&#xFF0C;&#x6765;&#x68C0;&#x6D4B;&#x3001;&#x8868;&#x8FBE;&#x548C;&#x8F6C;&#x6362;&#x7C7B;&#x4F3C;&#x5F52;&#x7EA6;&#x7684;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x79CD;&#x652F;&#x6301;&#x4E0D;&#x9700;&#x8981;&#x6E90;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#xFF0C;&#x800C;&#x4E0E;&#x4F7F;&#x7528;&#x6CE8;&#x91CA;&#x4EE5;&#x542F;&#x7528;&#x68C0;&#x6D4B;&#x7684;&#x6E90;&#x7EA7;&#x5DE5;&#x5177; [24] &#x4E0D;&#x540C;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x590D;&#x6742;&#x7684;&#x4FEE;&#x6539;&#x6765;&#x8FDB;&#x884C;&#x5E76;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x751F;&#x6210;&#xFF0C;&#x4E0E; Polly [25] &#x4E0D;&#x540C;&#xFF0C;&#x540E;&#x8005;&#x53D7;&#x5230; LLVM &#x7F3A;&#x5931;&#x4E00;&#x7EA7;&#x5E76;&#x884C;&#x6784;&#x9020;&#x7684;&#x9650;&#x5236;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x672A;&#x5BF9;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x800C;&#x662F;&#x4F9D;&#x8D56;&#x540E;&#x5904;&#x7406;&#x6765;&#x8FDB;&#x884C;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#xFF0C;&#x5305;&#x62EC;&#x6700;&#x5916;&#x5C42;&#x7684;&#x5E76;&#x884C;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#x3002;</p>
<p>&#x603B;&#x4F53;&#x65B9;&#x6CD5;&#x9075;&#x5FAA;&#x4E86; [26] &#x4E2D;&#x63D0;&#x51FA;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x9488;&#x5BF9; MLIR &#x7684;&#x57FA;&#x4E8E;&#x533A;&#x57DF;&#x7684;&#x4E2D;&#x95F4;&#x8868;&#x793A;&#x8FDB;&#x884C;&#x4E86;&#x8C03;&#x6574;&#xFF0C;&#x5982;&#x56FE; 9 &#x6240;&#x793A;&#x3002;Polygeist &#x901A;&#x8FC7;&#x626B;&#x63CF;&#x5FAA;&#x73AF;&#x7684;&#x5355;&#x5757;&#x4E3B;&#x4F53;&#xFF0C;&#x8BC6;&#x522B;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x4E2D;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x5185;&#x5B58;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x5177;&#x6709;&#x5FAA;&#x73AF;&#x4E0D;&#x53D8;&#x4E0B;&#x6807;&#x4E14;&#x6CA1;&#x6709;&#x4EA4;&#x9519;&#x522B;&#x540D;&#x5B58;&#x50A8;&#x7684;&#x52A0;&#x8F7D;/&#x5B58;&#x50A8;&#x5BF9;&#x3002;&#x8FD9;&#x4E9B;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x503C;&#x6216;&#x4E8C;&#x6B21;&#x5F52;&#x7EB3;&#x53D8;&#x91CF;&#xFF0C;&#x52A0;&#x8F7D;/&#x5B58;&#x50A8;&#x5BF9;&#x88AB;&#x63D0;&#x5347;&#x5230;&#x5FAA;&#x73AF;&#x5916;&#x5E76;&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x8BFB;&#x53D6;&#x521D;&#x59CB;&#x503C;&#x548C;&#x5B58;&#x50A8;&#x6700;&#x7EC8;&#x503C;&#x3002;&#x5728;&#x5FAA;&#x73AF;&#x4E3B;&#x4F53;&#x4E2D;&#xFF0C;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x503C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x65E0;&#x526F;&#x4F5C;&#x7528;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x94FE;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x7ED3;&#x5408;&#x7684;&#x548C;&#x4EA4;&#x6362;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x5FAA;&#x73AF;&#x5373;&#x4E3A;&#x5F52;&#x7EA6;&#x3002;&#x5373;&#x4F7F;&#x5728;&#x6CA1;&#x6709;&#x5408;&#x9002;&#x7684;&#x5F52;&#x7EA6;&#x64CD;&#x4F5C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x503C;&#x4E5F;&#x80FD;&#x88AB;&#x68C0;&#x6D4B;&#x5230;&#x3002;&#x5177;&#x6709;&#x6B64;&#x7C7B;&#x503C;&#x7684;&#x5FAA;&#x73AF;&#x5C06;&#x5BF9; mem2reg &#x4EA7;&#x751F;&#x8D21;&#x732E;&#xFF0C;&#x964D;&#x4F4E;&#x5185;&#x5B58;&#x5360;&#x7528;&#xFF0C;&#x4F46;&#x4E0D;&#x9002;&#x5408;&#x8FDB;&#x884C;&#x5E76;&#x884C;&#x5316;&#x3002;</p>
<p>b) &#x5EF6;&#x8FDF;&#x5E76;&#x884C;&#x5316;&#xFF1A;Polygeist &#x5E76;&#x4E0D;&#x4F9D;&#x8D56;&#x4E8E;&#x901A;&#x8FC7;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x83B7;&#x53D6;&#x7684;&#x4F9D;&#x8D56;&#x8DDD;&#x79BB;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x662F;&#x5BF9;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x5355;&#x72EC;&#x7684;&#x591A;&#x9762;&#x4F53;&#x5206;&#x6790;&#x4EE5;&#x68C0;&#x6D4B;&#x5FAA;&#x73AF;&#x5E76;&#x884C;&#x6027;&#x3002;&#x8BE5;&#x5206;&#x6790;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x79CD;&#x7ECF;&#x5178;&#x7684;&#x591A;&#x9762;&#x4F53;&#x4F9D;&#x8D56;&#x5206;&#x6790; [27]&#x3001;[28]&#xFF0C;&#x5728; MLIR &#x533A;&#x57DF;&#x7ED3;&#x6784;&#x4E4B;&#x4E0A;&#x5B9E;&#x73B0;&#x3002;&#x5728;&#x8FDB;&#x884C; SSA &#x57FA;&#x4E8E;&#x4F18;&#x5316;&#x4E4B;&#x540E;&#x6267;&#x884C;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x7279;&#x522B;&#x662F; mem2reg &#x548C;&#x5F52;&#x7EA6;&#x68C0;&#x6D4B;&#xFF0C;&#x80FD;&#x591F;&#x5E76;&#x884C;&#x5316;&#x66F4;&#x591A;&#x7684;&#x5FAA;&#x73AF;&#x3002;&#x7279;&#x522B;&#x662F;&#xFF0C;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#x548C;&#x90A3;&#x4E9B;&#x53D8;&#x91CF;&#x503C;&#x4EC5;&#x5728;&#x5355;&#x6B21;&#x8FED;&#x4EE3;&#x5185;&#x76F8;&#x5173;&#x7684;&#x5FAA;&#x73AF;&#xFF08;&#x7C7B;&#x4F3C;&#x4E8E;&#x6D3B;&#x8DC3;&#x8303;&#x56F4;&#x91CD;&#x6392;&#x5E8F; [29]&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x6602;&#x8D35;&#x7684;&#x989D;&#x5916;&#x591A;&#x9762;&#x4F53;&#x5206;&#x6790;&#xFF09;&#x90FD;&#x5F97;&#x5230;&#x5904;&#x7406;&#xFF08;&#x5728;&#x5FAA;&#x73AF;&#x4E2D;&#x5B9A;&#x4E49;&#x7684; SSA &#x503C;&#x7684;&#x6D3B;&#x8DC3;&#x8303;&#x56F4;&#x4ECE;&#x4E0D;&#x8D85;&#x51FA;&#x5FAA;&#x73AF;&#xFF09;&#x3002;</p>
<h2 id="iv-evaluation"># IV. EVALUATION</h2>
<p>Our evaluation has two goals. 1) We want to demonstrate that the code produced by Polygeist without additional op-  timization does not have any inexplicable performance differences than a state-of-the-art compiler like Clang. 2) We explore how Polygeist&apos;s internal representation can support a mix of affine and SSA-based transformation in the same compilation flow, and evaluate the potential benefits compared to existing source and compiler-based polyhedral tools.</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x8BC4;&#x4F30;&#x6709;&#x4E24;&#x4E2A;&#x76EE;&#x6807;&#x3002;1&#xFF09;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8BC1;&#x660E;&#xFF0C;Polygeist &#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x4F18;&#x5316;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5176;&#x6027;&#x80FD;&#x4E0E;&#x50CF; Clang &#x8FD9;&#x6837;&#x7684;&#x73B0;&#x4EE3;&#x7F16;&#x8BD1;&#x5668;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E0D;&#x53EF;&#x89E3;&#x91CA;&#x7684;&#x5DEE;&#x5F02;&#x3002;2&#xFF09;&#x6211;&#x4EEC;&#x63A2;&#x8BA8; Polygeist &#x7684;&#x5185;&#x90E8;&#x8868;&#x793A;&#x5982;&#x4F55;&#x5728;&#x540C;&#x4E00;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#x4E2D;&#x652F;&#x6301;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x548C;&#x57FA;&#x4E8E; SSA &#x7684;&#x53D8;&#x6362;&#xFF0C;&#x5E76;&#x8BC4;&#x4F30;&#x4E0E;&#x73B0;&#x6709;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x548C;&#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x4E0A;&#x7684;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#x76F8;&#x6BD4;&#x7684;&#x6F5C;&#x5728;&#x4F18;&#x52BF;&#x3002;</p>
<h2 id="a-experimental-setup"># A. Experimental Setup</h2>
<p>We ran our experiments on an AWS c5.metal instance with hyper-threading and Turbo Boost disabled. The system is Ubuntu 20.04 running on a dual-socket Intel Xeon Platinum 8275CL CPU at 3.0 GHz with 24 cores each, with 0.75, 35, 35.75 MB L1, L2, L3 cache per socket, respectively, and 256 GB RAM. We ran all 30 benchmarks from Poly-Bench [19], using the &quot;EXTRALARGE&quot; dataset. Pluto is unable to extract SCoP from the adi benchmark. We ran a total of 5 trials for each benchmark, taking the execution time reported by PolyBench; the median result is taken unless stated otherwise. Every measurement or result reported in the following sections refers to double-precision data. All experiments were run on cores 1-8, which ensured that all threads were on the same socket and did not potentially conflict with processes scheduled on core 0.
In all cases, we use two-stage compilation: (i) using clang at -O3 excluding unrolling and vectorization; or Polygeist to emit LLVM IR from C; (ii) using clang at -O3 to emit the final binary. As several optimizations are not idempotent, a second round of optimization can potentially significantly boost (and rarely, hinder) performance. This is why we chose to only perform vectorization and unrolling at the last optimization stage. Since Polygeist applies some optimizations at the MLIR level (e.g., mem2reg), we compare against the twostage compilation pipeline as a more fair baseline (CLANG). We also evaluate a single-stage compilation to assess the effect of the two-stage flow (CLANGSING).</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x53F0; AWS c5.metal &#x5B9E;&#x4F8B;&#x4E0A;&#x8FDB;&#x884C;&#x5B9E;&#x9A8C;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F8B;&#x7981;&#x7528;&#x4E86;&#x8D85;&#x7EBF;&#x7A0B;&#x548C; Turbo Boost&#x3002;&#x7CFB;&#x7EDF;&#x4E3A; Ubuntu 20.04&#xFF0C;&#x8FD0;&#x884C;&#x4E8E;&#x53CC;&#x63D2;&#x69FD; Intel Xeon Platinum 8275CL CPU&#xFF0C;&#x4E3B;&#x9891;&#x4E3A; 3.0 GHz&#xFF0C;&#x6BCF;&#x4E2A;&#x63D2;&#x69FD;&#x6709; 24 &#x4E2A;&#x6838;&#x5FC3;&#xFF0C;L1&#x3001;L2 &#x548C; L3 &#x7F13;&#x5B58;&#x5206;&#x522B;&#x4E3A; 0.75 MB&#x3001;35 MB &#x548C; 35.75 MB&#xFF0C;&#x5E76;&#x914D;&#x5907; 256 GB RAM&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x201C;EXTRALARGE&#x201D;&#x6570;&#x636E;&#x96C6;&#x8FD0;&#x884C; Poly-Bench [19] &#x4E2D;&#x7684;&#x6240;&#x6709; 30 &#x4E2A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x3002;Pluto &#x65E0;&#x6CD5;&#x4ECE; adi &#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x4E2D;&#x63D0;&#x53D6; SCoP&#x3002;&#x6211;&#x4EEC;&#x5BF9;&#x6BCF;&#x4E2A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x8FDB;&#x884C;&#x4E86;&#x603B;&#x5171; 5 &#x6B21;&#x8BD5;&#x9A8C;&#xFF0C;&#x91C7;&#x7528; PolyBench &#x62A5;&#x544A;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF1B;&#x9664;&#x975E;&#x53E6;&#x6709;&#x8BF4;&#x660E;&#xFF0C;&#x7ED3;&#x679C;&#x4EE5;&#x4E2D;&#x4F4D;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#x7ED9;&#x51FA;&#x3002;&#x4EE5;&#x4E0B;&#x5404;&#x8282;&#x4E2D;&#x62A5;&#x544A;&#x7684;&#x6BCF;&#x4E2A;&#x6D4B;&#x91CF;&#x6216;&#x7ED3;&#x679C;&#x5747;&#x4E0E;&#x53CC;&#x7CBE;&#x5EA6;&#x6570;&#x636E;&#x76F8;&#x5173;&#x3002;&#x6240;&#x6709;&#x5B9E;&#x9A8C;&#x5747;&#x5728;&#x6838;&#x5FC3; 1-8 &#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x63D2;&#x69FD;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x4E0E;&#x8C03;&#x5EA6;&#x5728;&#x6838;&#x5FC3; 0 &#x4E0A;&#x7684;&#x8FDB;&#x7A0B;&#x53D1;&#x751F;&#x6F5C;&#x5728;&#x51B2;&#x7A81;&#x3002;</p>
<p>&#x5728;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E24;&#x9636;&#x6BB5;&#x7F16;&#x8BD1;&#xFF1A;(i) &#x4F7F;&#x7528; clang &#x4EE5; -O3 &#x7EA7;&#x522B;&#x7F16;&#x8BD1;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5C55;&#x5F00;&#x548C;&#x5411;&#x91CF;&#x5316;&#xFF1B;&#x6216;&#x4F7F;&#x7528; Polygeist &#x4ECE; C &#x53D1;&#x51FA; LLVM IR&#xFF1B;(ii) &#x4F7F;&#x7528; clang &#x4EE5; -O3 &#x7EA7;&#x522B;&#x53D1;&#x51FA;&#x6700;&#x7EC8;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x67D0;&#x4E9B;&#x4F18;&#x5316;&#x5E76;&#x975E;&#x5E42;&#x7B49;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x7B2C;&#x4E8C;&#x8F6E;&#x4F18;&#x5316;&#x53EF;&#x80FD;&#x4F1A;&#x663E;&#x8457;&#x63D0;&#x5347;&#xFF08;&#x800C;&#x5F88;&#x5C11;&#x60C5;&#x51B5;&#x4F1A;&#x6291;&#x5236;&#xFF09;&#x6027;&#x80FD;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x4EC5;&#x5728;&#x6700;&#x540E;&#x4F18;&#x5316;&#x9636;&#x6BB5;&#x8FDB;&#x884C;&#x5411;&#x91CF;&#x5316;&#x548C;&#x5C55;&#x5F00;&#x7684;&#x539F;&#x56E0;&#x3002;&#x7531;&#x4E8E; Polygeist &#x5728; MLIR &#x7EA7;&#x522B;&#x5E94;&#x7528;&#x4E86;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;mem2reg&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x4E0E;&#x4E24;&#x9636;&#x6BB5;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#xFF08;CLANG&#xFF09;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x4F5C;&#x4E3A;&#x66F4;&#x516C;&#x5E73;&#x7684;&#x57FA;&#x7EBF;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x8BC4;&#x4F30;&#x4E86;&#x5355;&#x9636;&#x6BB5;&#x7F16;&#x8BD1;&#xFF0C;&#x4EE5;&#x8BC4;&#x4F30;&#x4E24;&#x9636;&#x6BB5;&#x6D41;&#x7A0B;&#x7684;&#x6548;&#x679C;&#xFF08;CLANGSING&#xFF09;&#x3002;</p>
<h2 id="b-baseline-performance"># B. Baseline Performance</h2>
<p>Polygeist must generate code with runtime as close as possible to that of existing compilation flows to establish a solid baseline. In other words, Polygeist should not introduce overhead nor speedup unless explicitly instructed otherwise, to allow for measuring the effects of additional optimizations. We evaluate this by comparing the runtime of programs produced by Polygeist with those produced by Clang at the same commit (Apr 2021) 2 . Figure 10 summarizes the results with the following flows:
&#x2022; CLANG: A compilation of the program using Clang, when running two stages of optimization; &#x2022; CLANGSING: A compilation of the program using Clang, when running one stage of optimization; &#x2022; MLIR-CLANG: A compilation flow using the Polygeist frontend and preprocessing optimizations within MLIR, but not running polyhedral scheduling nor postprocessing.</p>
<p>B. &#x57FA;&#x7EBF;&#x6027;&#x80FD;</p>
<p>Polygeist&#x5FC5;&#x987B;&#x751F;&#x6210;&#x5C3D;&#x53EF;&#x80FD;&#x63A5;&#x8FD1;&#x73B0;&#x6709;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x4EE3;&#x7801;&#xFF0C;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7A33;&#x56FA;&#x7684;&#x57FA;&#x7EBF;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;Polygeist&#x4E0D;&#x5E94;&#x8BE5;&#x5F15;&#x5165;&#x5F00;&#x9500;&#x6216;&#x52A0;&#x901F;&#xFF0C;&#x9664;&#x975E;&#x660E;&#x786E;&#x6307;&#x793A;&#xFF0C;&#x4EE5;&#x4FBF;&#x80FD;&#x591F;&#x6D4B;&#x91CF;&#x989D;&#x5916;&#x4F18;&#x5316;&#x7684;&#x6548;&#x679C;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;Polygeist&#x751F;&#x6210;&#x7684;&#x7A0B;&#x5E8F;&#x4E0E;&#x540C;&#x4E00;&#x63D0;&#x4EA4;&#x7248;&#x672C;&#xFF08;2021&#x5E74;4&#x6708;&#xFF09;&#x4E0B;Clang&#x751F;&#x6210;&#x7684;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x6765;&#x8BC4;&#x4F30;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x56FE;10&#x603B;&#x7ED3;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x6D41;&#x7A0B;&#x7684;&#x7ED3;&#x679C;&#xFF1A;
&#x2022; CLANG&#xFF1A;&#x4F7F;&#x7528;Clang&#x7F16;&#x8BD1;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD0;&#x884C;&#x4E24;&#x9636;&#x6BB5;&#x4F18;&#x5316;&#x7684;&#x8FC7;&#x7A0B;&#xFF1B;
&#x2022; CLANGSING&#xFF1A;&#x4F7F;&#x7528;Clang&#x7F16;&#x8BD1;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x9636;&#x6BB5;&#x4F18;&#x5316;&#x7684;&#x8FC7;&#x7A0B;&#xFF1B;
&#x2022; MLIR-CLANG&#xFF1A;&#x4F7F;&#x7528;Polygeist&#x524D;&#x7AEF;&#x7684;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#xFF0C;&#x5728;MLIR&#x5185;&#x8FDB;&#x884C;&#x9884;&#x5904;&#x7406;&#x4F18;&#x5316;&#xFF0C;&#x4F46;&#x4E0D;&#x6267;&#x884C;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x6216;&#x540E;&#x5904;&#x7406;&#x3002;</p>
<h2 id="c-compilation-flows"># C. Compilation Flows</h2>
<p>We compare Polygeist with a source-level and an IR-level optimizer (Pluto and Polly) in the following configurations:
&#x2022; PLUTO: Pluto compiler auto-transformation [11] using polycc 3 with -noparallel and -tile flags; &#x2022; PLUTOPAR: Same as above but with -parallel flag;
&#x2022; POLLY: Polly [7] LLVM passes with affine scheduling and tiling, and no pattern-based optimizations [30]; &#x2022; POLLYPAR: Same as above with auto-parallelization;
&#x2022; POLYGEIST: Our flow with Pluto and extra transforms; &#x2022; POLYGEISTPAR: Same as above but with -parallel Pluto schedule, Polygeist parallelization and reductions. Running between source and LLVM IR levels, we expect Polygeist to benefit from both worlds, thus getting code that is on par or better than competitors. When using Pluto, both standalone and within Polygeist, we disable the emission of vectorization hints and loop unrolling to make sure both transformations are fully controlled by the LLVM optimizer, which also runs in Polly flows. We run Polly in the latest stage of Clang compilation, using -mllvm -polly and additional flags to enable affine scheduling, tiling and parallelization as required. Polly is taken at the same LLVM commit as Clang. We disable pattern-based optimizations [30] that are not available elsewhere. Figures 11 and12 summarize the results for sequential and parallel flows, respectively.</p>
<p>&#x6211;&#x4EEC;&#x5C06;Polygeist&#x4E0E;&#x6E90;&#x4EE3;&#x7801;&#x7EA7;&#x548C;&#x4E2D;&#x95F4;&#x8868;&#x793A;&#x7EA7;&#x4F18;&#x5316;&#x5668;&#xFF08;Pluto&#x548C;Polly&#xFF09;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>PLUTO&#xFF1A;&#x4F7F;&#x7528;-polycc 3&#x53CA;-noparallel&#x548C;-tile&#x6807;&#x5FD7;&#x7684;Pluto&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#xFF1B;</li>
<li>PLUTOPAR&#xFF1A;&#x4E0E;&#x4E0A;&#x8FF0;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x4F7F;&#x7528;-parallel&#x6807;&#x5FD7;&#xFF1B;</li>
<li>POLLY&#xFF1A;Polly [7]&#x7684;LLVM&#x901A;&#x9053;&#xFF0C;&#x5177;&#x6709;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x548C;&#x5207;&#x7247;&#xFF0C;&#x6CA1;&#x6709;&#x57FA;&#x4E8E;&#x6A21;&#x5F0F;&#x7684;&#x4F18;&#x5316; [30]&#xFF1B;</li>
<li>POLLYPAR&#xFF1A;&#x4E0E;&#x4E0A;&#x8FF0;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x8FDB;&#x884C;&#x4E86;&#x81EA;&#x52A8;&#x5E76;&#x884C;&#x5316;&#xFF1B;</li>
<li>POLYGEIST&#xFF1A;&#x6211;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#xFF0C;&#x7ED3;&#x5408;&#x4E86;Pluto&#x548C;&#x989D;&#x5916;&#x7684;&#x53D8;&#x6362;&#xFF1B;</li>
<li>POLYGEISTPAR&#xFF1A;&#x4E0E;&#x4E0A;&#x8FF0;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x4F7F;&#x7528;-parallel&#x7684;Pluto&#x8C03;&#x5EA6;&#xFF0C;Polygeist&#x5E76;&#x884C;&#x5316;&#x548C;&#x5F52;&#x7EA6;&#x3002;</li>
</ul>
<p>&#x5728;&#x6E90;&#x4EE3;&#x7801;&#x548C;LLVM IR&#x7EA7;&#x522B;&#x4E4B;&#x95F4;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x671F;&#x671B;Polygeist&#x80FD;&#x591F;&#x4ECE;&#x8FD9;&#x4E24;&#x8005;&#x7684;&#x4F18;&#x70B9;&#x4E2D;&#x53D7;&#x76CA;&#xFF0C;&#x4ECE;&#x800C;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x80FD;&#x591F;&#x4E0E;&#x7ADE;&#x4E89;&#x5BF9;&#x624B;&#x76F8;&#x5AB2;&#x7F8E;&#x6216;&#x66F4;&#x4F18;&#x3002;&#x5728;&#x4F7F;&#x7528;Pluto&#x65F6;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x72EC;&#x7ACB;&#x5730;&#x8FD8;&#x662F;&#x5728;Polygeist&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x4F1A;&#x7981;&#x7528;&#x5411;&#x91CF;&#x5316;&#x63D0;&#x793A;&#x548C;&#x5FAA;&#x73AF;&#x5C55;&#x5F00;&#x7684;&#x53D1;&#x51FA;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x8FD9;&#x4E24;&#x79CD;&#x53D8;&#x6362;&#x90FD;&#x5B8C;&#x5168;&#x7531;LLVM&#x4F18;&#x5316;&#x5668;&#x63A7;&#x5236;&#xFF0C;&#x8BE5;&#x4F18;&#x5316;&#x5668;&#x4E5F;&#x5728;Polly&#x6D41;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;&#x3002;&#x6211;&#x4EEC;&#x5728;Clang&#x7F16;&#x8BD1;&#x7684;&#x6700;&#x65B0;&#x9636;&#x6BB5;&#x8FD0;&#x884C;Polly&#xFF0C;&#x4F7F;&#x7528;-mllvm -polly&#x53CA;&#x5176;&#x4ED6;&#x6807;&#x5FD7;&#x4EE5;&#x542F;&#x7528;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x3001;&#x5207;&#x7247;&#x548C;&#x5E76;&#x884C;&#x5316;&#x3002;Polly&#x4E0E;Clang&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;LLVM&#x63D0;&#x4EA4;&#x7248;&#x672C;&#x3002;&#x6211;&#x4EEC;&#x7981;&#x7528;&#x5728;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x4E0D;&#x53EF;&#x7528;&#x7684;&#x57FA;&#x4E8E;&#x6A21;&#x5F0F;&#x7684;&#x4F18;&#x5316; [30]&#x3002;&#x56FE;11&#x548C;&#x56FE;12&#x5206;&#x522B;&#x603B;&#x7ED3;&#x4E86;&#x987A;&#x5E8F;&#x548C;&#x5E76;&#x884C;&#x6D41;&#x7A0B;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<h2 id="a-benchmarking"># A. Benchmarking</h2>
<p>The transformation of reduction loops, in particular parallelization, may result in a different order of partial result accumulation. This is not allowed under IEEE 754 semantics, but is supported by compilers with -ffast-math option.
We found that Polybench allocation function hinders Clang/LLVM alias analysis, negatively affecting performance 2 LLVM commit 20d5c42e0ef5d252b434bcb610b04f1cb79fe771 3 Pluto commit dae26e77b94b2624a540c08ec7128f20cd7b7985 in, e.g., adi. Therefore, we modified all benchmarks to use malloc that is known to produce non-aliasing pointers.</p>
<p>&#x964D;&#x4F4E;&#x5FAA;&#x73AF;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5E76;&#x884C;&#x5316;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x90E8;&#x5206;&#x7ED3;&#x679C;&#x7D2F;&#x79EF;&#x7684;&#x987A;&#x5E8F;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;&#x8FD9;&#x5728; IEEE 754 &#x8BED;&#x4E49;&#x4E0B;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x4F46;&#x4F7F;&#x7528; -ffast-math &#x9009;&#x9879;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;Polybench &#x7684;&#x5206;&#x914D;&#x51FD;&#x6570;&#x4F1A;&#x59A8;&#x788D; Clang/LLVM &#x7684;&#x522B;&#x540D;&#x5206;&#x6790;&#xFF0C;&#x4ECE;&#x800C;&#x5BF9;&#x6027;&#x80FD;&#x4EA7;&#x751F;&#x8D1F;&#x9762;&#x5F71;&#x54CD; 2 LLVM &#x63D0;&#x4EA4; 20d5c42e0ef5d252b434bcb610b04f1cb79fe771 3 Pluto &#x63D0;&#x4EA4; dae26e77b94b2624a540c08ec7128f20cd7b7985&#xFF0C;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x5728; adi &#x4E2D;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x4E86;&#x6240;&#x6709;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#xFF0C;&#x4F7F;&#x7528;&#x5DF2;&#x77E5;&#x4F1A;&#x4EA7;&#x751F;&#x975E;&#x522B;&#x540D;&#x6307;&#x9488;&#x7684; malloc&#x3002;</p>
<h2 id="b-baseline-comparison"># B. Baseline Comparison</h2>
<p>We did not observe a significant difference between the runtimes of CLANG and CLANGSING configurations, with a geometric mean of 0.43% symmetric difference 4 across benchmarks. Therefore, we only consider CLANG as baseline throughout the remainder of this paper. We did not observe a significant difference between the runtimes of CLANG and MLIR-CLANG configurations either, with a geometric mean of 0.24% symmetric difference.
We found a variation in runtimes of short-running benchmarks, in particular jacobi-1d. This can be attributed to the interaction with the data initialization and benchmarking code, and with other OS processes. Excluding the benchmarks running in under 0.05s (jacobi-1d, gesummv, atax, bicg) from the analysis, we obtain 0.32% and 0.17% geomean symmetric differences respectively for the two comparisons above. These results suggest that our flow has no unexplained (dis)advantages over the baseline.</p>
<p>&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x89C2;&#x5BDF;&#x5230;CLANG&#x548C;CLANGSING&#x914D;&#x7F6E;&#x4E4B;&#x95F4;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5B58;&#x5728;&#x663E;&#x8457;&#x5DEE;&#x5F02;&#xFF0C;&#x5728;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x51E0;&#x4F55;&#x5E73;&#x5747;&#x5BF9;&#x79F0;&#x5DEE;&#x4E3A;0.43%&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x672C;&#x6587;&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4EC5;&#x8003;&#x8651;CLANG&#x4F5C;&#x4E3A;&#x57FA;&#x7EBF;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x6CA1;&#x6709;&#x89C2;&#x5BDF;&#x5230;CLANG&#x548C;MLIR-CLANG&#x914D;&#x7F6E;&#x4E4B;&#x95F4;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5B58;&#x5728;&#x663E;&#x8457;&#x5DEE;&#x5F02;&#xFF0C;&#x5176;&#x51E0;&#x4F55;&#x5E73;&#x5747;&#x5BF9;&#x79F0;&#x5DEE;&#x4E3A;0.24%&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x77ED;&#x8FD0;&#x884C;&#x57FA;&#x51C6;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5B58;&#x5728;&#x53D8;&#x52A8;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;jacobi-1d&#x4E0A;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x5F52;&#x56E0;&#x4E8E;&#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;&#x548C;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x4ECE;&#x5206;&#x6790;&#x4E2D;&#x6392;&#x9664;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x5C11;&#x4E8E;0.05&#x79D2;&#x7684;&#x57FA;&#x51C6;&#xFF08;&#x5982;jacobi-1d&#x3001;gesummv&#x3001;atax&#x3001;bicg&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x5206;&#x522B;&#x83B7;&#x5F97;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x6BD4;&#x8F83;&#x7684;&#x51E0;&#x4F55;&#x5E73;&#x5747;&#x5BF9;&#x79F0;&#x5DEE;&#x4E3A;0.32%&#x548C;0.17%&#x3002;&#x8FD9;&#x4E9B;&#x7ED3;&#x679C;&#x8868;&#x660E;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6D41;&#x7A0B;&#x5728;&#x57FA;&#x7EBF;&#x4E4B;&#x4E0A;&#x6CA1;&#x6709;&#x672A;&#x89E3;&#x91CA;&#x7684;&#xFF08;&#x4E0D;&#xFF09;&#x4F18;&#x52BF;&#x3002;</p>
<h2 id="c-performance-differences-in-sequential-code"># C. Performance Differences in Sequential Code</h2>
<p>Overall, Polygeist leads to larger speedups, with 2.53&#xD7; geometric mean, than both Pluto (2.34&#xD7;) and Polly (1.41&#xD7;), although improvements are not systematic. Some difference between Polygeist and Polly is due to the employed polyhedral schedulers, e.g., in lu and mvt. Polygeist produces code faster tha both Pluto and Polly in 2mm, 3mm and others thanks to statement splitting, see Section V-E.
Given identical statements and schedules, codegen-level optimization accounts for other performance difference. seidel-2d is the clearest example: Pluto executes 2.7&#x2022;10 11 more integer instructions than Polygeist. Assuming these to be index/address computations, a mix of add (throughput 1/2 or 1/4) and imul/shl (thoughput 1), we can expect a &#x2248; 59s difference at 3GHz, consistent with experimental observations. Polygeist optimizes away a part of those in its post-optimization phase and emits homogeneous address computation from memref with proper machine size type, enabling more aggressive bound analysis and simplification in the downstream compiler. Conversely, jacobi-2d has poorer performance because Polygeist gives up on simplifying CLooG code, with up to 75 statement copies in 40 branches, for compiler performance reasons, as opposed to Clang that takes up to 5s to process it but results in better vectorization. Further work is necessary to address this issue by emitting vector instructions directly from Polygeist.</p>
<p>&#x6574;&#x4F53;&#x800C;&#x8A00;&#xFF0C;Polygeist &#x76F8;&#x8F83;&#x4E8E; Pluto&#xFF08;2.34&#xD7;&#xFF09;&#x548C; Polly&#xFF08;1.41&#xD7;&#xFF09;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5927;&#x7684;&#x52A0;&#x901F;&#xFF0C;&#x51E0;&#x4F55;&#x5E73;&#x5747;&#x503C;&#x4E3A; 2.53&#xD7;&#xFF0C;&#x5C3D;&#x7BA1;&#x6539;&#x8FDB;&#x5E76;&#x4E0D;&#x662F;&#x7CFB;&#x7EDF;&#x6027;&#x7684;&#x3002;Polygeist &#x548C; Polly &#x4E4B;&#x95F4;&#x7684;&#x4E00;&#x4E9B;&#x5DEE;&#x5F02;&#x662F;&#x7531;&#x4E8E;&#x6240;&#x91C7;&#x7528;&#x7684;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#xFF0C;&#x4F8B;&#x5982;&#x5728; lu &#x548C; mvt &#x4E2D;&#x3002;&#x5F97;&#x76CA;&#x4E8E;&#x8BED;&#x53E5;&#x5206;&#x5272;&#xFF0C;Polygeist &#x5728; 2mm&#x3001;3mm &#x53CA;&#x5176;&#x4ED6;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x901F;&#x5EA6;&#x8D85;&#x8FC7;&#x4E86; Pluto &#x548C; Polly&#xFF0C;&#x8BE6;&#x89C1;&#x7B2C; V-E &#x8282;&#x3002;</p>
<p>&#x5728;&#x7ED9;&#x5B9A;&#x76F8;&#x540C;&#x8BED;&#x53E5;&#x548C;&#x8C03;&#x5EA6;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x5C42;&#x9762;&#x7684;&#x4F18;&#x5316;&#x662F;&#x9020;&#x6210;&#x5176;&#x4ED6;&#x6027;&#x80FD;&#x5DEE;&#x5F02;&#x7684;&#x539F;&#x56E0;&#x3002;seidel-2d &#x662F;&#x6700;&#x660E;&#x663E;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;Pluto &#x6267;&#x884C;&#x7684;&#x6574;&#x6570;&#x6307;&#x4EE4;&#x6BD4; Polygeist &#x591A;&#x51FA; 2.7&#x2022;10^11 &#x6B21;&#x3002;&#x5047;&#x8BBE;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x90FD;&#x662F;&#x7D22;&#x5F15;/&#x5730;&#x5740;&#x8BA1;&#x7B97;&#xFF0C;&#x6DF7;&#x5408;&#x4E86; add&#xFF08;&#x541E;&#x5410;&#x91CF;&#x4E3A; 1/2 &#x6216; 1/4&#xFF09;&#x548C; imul/shl&#xFF08;&#x541E;&#x5410;&#x91CF;&#x4E3A; 1&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9884;&#x8BA1;&#x5728; 3GHz &#x4E0B;&#x4F1A;&#x6709; &#x2248; 59 &#x79D2;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x8FD9;&#x4E0E;&#x5B9E;&#x9A8C;&#x89C2;&#x5BDF;&#x7ED3;&#x679C;&#x4E00;&#x81F4;&#x3002;Polygeist &#x5728;&#x5176;&#x540E;&#x4F18;&#x5316;&#x9636;&#x6BB5;&#x4F18;&#x5316;&#x6389;&#x4E86;&#x4E00;&#x90E8;&#x5206;&#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x4ECE; memref &#x53D1;&#x51FA;&#x9002;&#x5F53;&#x673A;&#x5668;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x5747;&#x5300;&#x5730;&#x5740;&#x8BA1;&#x7B97;&#xFF0C;&#x4F7F;&#x4E0B;&#x6E38;&#x7F16;&#x8BD1;&#x5668;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x66F4;&#x6FC0;&#x8FDB;&#x7684;&#x754C;&#x9650;&#x5206;&#x6790;&#x548C;&#x7B80;&#x5316;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x7531;&#x4E8E; Polygeist &#x4E3A;&#x4E86;&#x7F16;&#x8BD1;&#x5668;&#x6027;&#x80FD;&#x539F;&#x56E0;&#x653E;&#x5F03;&#x4E86;&#x5BF9; CLooG &#x4EE3;&#x7801;&#x7684;&#x7B80;&#x5316;&#xFF0C;jacobi-2d &#x7684;&#x6027;&#x80FD;&#x8F83;&#x5DEE;&#xFF0C;&#x5728; 40 &#x4E2A;&#x5206;&#x652F;&#x4E2D;&#x6709;&#x591A;&#x8FBE; 75 &#x4E2A;&#x8BED;&#x53E5;&#x526F;&#x672C;&#xFF0C;&#x800C; Clang &#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x9700;&#x8017;&#x65F6;&#x591A;&#x8FBE; 5 &#x79D2;&#xFF0C;&#x4F46;&#x5176;&#x7ED3;&#x679C;&#x5374;&#x5B9E;&#x73B0;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x5411;&#x91CF;&#x5316;&#x3002;&#x9700;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x5DE5;&#x4F5C;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x4ECE; Polygeist &#x53D1;&#x51FA;&#x5411;&#x91CF;&#x6307;&#x4EE4;&#x3002;</p>
<h2 id="d-performance-differences-in-parallel-code"># D. Performance Differences In Parallel Code</h2>
<p>Similarly to sequential code, some performance differences are due to different schedulers. For example, in cholesky and lu, both Pluto and Polygeist outperform Polly, and the remaining gap can be attributed to codegen-level differences. Conversely, in gemver and mvt Polly has a benefit over both Fig. 10. Mean and 95% confidence intervals (log scale) of program run time across 5 runs of Polybench in CLANG, CLANGSING and MLIR-CLANG configurations, lower is better. The run times of code produced by Polygeist without optimization is comparable to that of Clang. No significant variation is observed between single and double optimization. Short-running jacobi-1d shows high intra-group variation. Fig. 11. Median speedup over CLANG for sequential configurations (log scale), higher is better. Polygeist outperforms (2.53&#xD7; geomean speedup) both Pluto (2.34&#xD7;) and Polly (1.41&#xD7;) on average. Pluto can&apos;t process adi, which is therefore excluded from summary statistics. Fig. 12. Median speedup over CLANG for parallel configurations (log scale), higher is better. Polygeist outperforms (9.47&#xD7; geomean speedup) both Pluto (7.54&#xD7;) and Polly (3.26&#xD7;) on average. Pluto can&apos;t process adi, which is therefore excluded from summary statistics.
Pluto and Polygeist. On ludcmp and syr(2)k, SSA-level optimizations let Polygeist produce code which is faster than Pluto and at least as fast as Polly. These results demonstrate that Polygeist indeed leverages the benefits of both the affine and SSA-based optimizations.
Polygeist is the only flow that obtains speedup on deriche (6.9&#xD7;) and symm (7.7&#xD7;). Examining the output code, we observe that only Polygeist manages to parallelize these two benchmarks. Considering the input code in Figure 13, one can observe that the i loop reuses the ym1 variable, which is in-terpreted as parallelism-preventing loop-carried dependency by polyhedral schedulers. Polygeist performs its own parallelism analysis after promoting ym1 to an SSA register (carried by the j loop) whose use-def range does not prevent parallelization.
Similarly, the Polygeist parallelizer identifies two benchmarks with parallel reduction loops that are not contained in other parallel loops: gramschmidt and durbin. gramschmidt benefits from a 56&#xD7; speedup with Polygeist, compared to 34&#xD7; with Polly and 54&#xD7; with Pluto. durbin sees a 6&#xD7; slowdown since the new parallel loop has relatively for (i=0; i<_pb_w; i++){="" ym1="SCALAR_VAL(0.0);" ...="" for="" (j="0;" j<_pb_h;="" j++){="" *="" }="" %z="constant" 0.0="" :="" f64="" affine.parallel="" %i="..." {="" affine.for="" %j="..." iter_args(%ym1="%z)-">f64 { %0=affine.load %y1[%i,%j] // ... affine.yield %0 }} Fig. 13. Excerpt from the deriche benchmark. The outer loop reuses ym1 which makes it appear non-parallel to affine schedulers (left). Polygeist detects parallelism thanks to its mem2reg optimization, reduction-like loop-carried %ym1 value detection and late parallelization (right). few iterations and is nested inside a sequential loop, leading to synchronization costs that outweigh the parallelism benefit. Section V-F explores the durbin benchmark in more detail. Polybench is a collection of codes (mostly) known to be parallel and, as such, has little need for reduction parallelization on CPU where one degree of parallelism is sufficient. When targeting inherently target architectures as GPUs, however, exploiting reduction parallelism could be vital for achieving peak performance [31], [24].</_pb_w;></p>
<p>&#x540C;&#x6837;&#xFF0C;&#x5BF9;&#x4E8E;&#x5E76;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x67D0;&#x4E9B;&#x6027;&#x80FD;&#x5DEE;&#x5F02;&#x662F;&#x7531;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x8C03;&#x5EA6;&#x5668;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728; cholesky &#x548C; lu &#x4E2D;&#xFF0C;Pluto &#x548C; Polygeist &#x7684;&#x6027;&#x80FD;&#x90FD;&#x4F18;&#x4E8E; Polly&#xFF0C;&#x5269;&#x4F59;&#x7684;&#x5DEE;&#x8DDD;&#x53EF;&#x4EE5;&#x5F52;&#x56E0;&#x4E8E;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x7EA7;&#x522B;&#x7684;&#x5DEE;&#x5F02;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5728; gemver &#x548C; mvt &#x4E2D;&#xFF0C;Polly &#x76F8;&#x8F83;&#x4E8E;&#x4E24;&#x8005;&#x7686;&#x6709;&#x4F18;&#x52BF;&#x3002;</p>
<p>&#x56FE; 10 &#x663E;&#x793A;&#x4E86;&#x5728; CLANG&#x3001;CLANGSING &#x548C; MLIR-CLANG &#x914D;&#x7F6E;&#x4E0B;&#xFF0C;Polybench &#x7684;&#x4E94;&#x6B21;&#x8FD0;&#x884C;&#x4E2D;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x5747;&#x503C;&#x548C; 95% &#x7F6E;&#x4FE1;&#x533A;&#x95F4;&#xFF08;&#x5BF9;&#x6570;&#x5C3A;&#x5EA6;&#xFF09;&#xFF0C;&#x503C;&#x8D8A;&#x4F4E;&#x8D8A;&#x597D;&#x3002;&#x7531; Polygeist &#x4EA7;&#x751F;&#x7684;&#x672A;&#x4F18;&#x5316;&#x4EE3;&#x7801;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x4E0E; Clang &#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x76F8;&#x5F53;&#x3002;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x5355;&#x91CD;&#x548C;&#x53CC;&#x91CD;&#x4F18;&#x5316;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x89C2;&#x5BDF;&#x5230;&#x663E;&#x8457;&#x5DEE;&#x5F02;&#x3002;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x8F83;&#x77ED;&#x7684; jacobi-1d &#x663E;&#x793A;&#x51FA;&#x9AD8;&#x7684;&#x7EC4;&#x5185;&#x53D8;&#x5F02;&#x6027;&#x3002;</p>
<p>&#x56FE; 11 &#x663E;&#x793A;&#x4E86;&#x5728;&#x987A;&#x5E8F;&#x914D;&#x7F6E;&#x4E0B;&#x76F8;&#x5BF9;&#x4E8E; CLANG &#x7684;&#x4E2D;&#x4F4D;&#x6570;&#x52A0;&#x901F;&#x6BD4;&#xFF08;&#x5BF9;&#x6570;&#x5C3A;&#x5EA6;&#xFF09;&#xFF0C;&#x503C;&#x8D8A;&#x9AD8;&#x8D8A;&#x597D;&#x3002;Polygeist &#x5728;&#x5E73;&#x5747;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x52A0;&#x901F;&#x6BD4;&#xFF08;&#x51E0;&#x4F55;&#x5747;&#x503C;&#x52A0;&#x901F;&#x6BD4;&#x4E3A; 2.53&#xD7;&#xFF09;&#x4F18;&#x4E8E; Pluto&#xFF08;2.34&#xD7;&#xFF09;&#x548C; Polly&#xFF08;1.41&#xD7;&#xFF09;&#x3002;Pluto &#x65E0;&#x6CD5;&#x5904;&#x7406; adi&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x6848;&#x4F8B;&#x88AB;&#x6392;&#x9664;&#x5728;&#x603B;&#x7ED3;&#x7EDF;&#x8BA1;&#x4E4B;&#x5916;&#x3002;</p>
<p>&#x56FE; 12 &#x663E;&#x793A;&#x4E86;&#x5728;&#x5E76;&#x884C;&#x914D;&#x7F6E;&#x4E0B;&#x76F8;&#x5BF9;&#x4E8E; CLANG &#x7684;&#x4E2D;&#x4F4D;&#x6570;&#x52A0;&#x901F;&#x6BD4;&#xFF08;&#x5BF9;&#x6570;&#x5C3A;&#x5EA6;&#xFF09;&#xFF0C;&#x503C;&#x8D8A;&#x9AD8;&#x8D8A;&#x597D;&#x3002;Polygeist &#x5728;&#x5E73;&#x5747;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x52A0;&#x901F;&#x6BD4;&#xFF08;&#x51E0;&#x4F55;&#x5747;&#x503C;&#x52A0;&#x901F;&#x6BD4;&#x4E3A; 9.47&#xD7;&#xFF09;&#x4F18;&#x4E8E; Pluto&#xFF08;7.54&#xD7;&#xFF09;&#x548C; Polly&#xFF08;3.26&#xD7;&#xFF09;&#x3002;Pluto &#x65E0;&#x6CD5;&#x5904;&#x7406; adi&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x6848;&#x4F8B;&#x4E5F;&#x88AB;&#x6392;&#x9664;&#x5728;&#x603B;&#x7ED3;&#x7EDF;&#x8BA1;&#x4E4B;&#x5916;&#x3002;</p>
<p>&#x5728; ludcmp &#x548C; syr(2)k &#x4E2D;&#xFF0C;SSA &#x7EA7;&#x522B;&#x7684;&#x4F18;&#x5316;&#x4F7F;&#x5F97; Polygeist &#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x6BD4; Pluto &#x66F4;&#x5FEB;&#xFF0C;&#x5E76;&#x4E14;&#x81F3;&#x5C11;&#x4E0E; Polly &#x540C;&#x6837;&#x5FEB;&#x3002;&#x8FD9;&#x4E9B;&#x7ED3;&#x679C;&#x8868;&#x660E;&#xFF0C;Polygeist &#x786E;&#x5B9E;&#x5229;&#x7528;&#x4E86;&#x4EFF;&#x5C04;&#x4F18;&#x5316;&#x548C; SSA &#x57FA;&#x7840;&#x4F18;&#x5316;&#x7684;&#x4F18;&#x70B9;&#x3002;</p>
<p>Polygeist &#x662F;&#x552F;&#x4E00;&#x5728; deriche&#xFF08;&#x52A0;&#x901F;&#x6BD4; 6.9&#xD7;&#xFF09;&#x548C; symm&#xFF08;&#x52A0;&#x901F;&#x6BD4; 7.7&#xD7;&#xFF09;&#x4E0A;&#x5B9E;&#x73B0;&#x52A0;&#x901F;&#x7684;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#x3002;&#x901A;&#x8FC7;&#x68C0;&#x67E5;&#x8F93;&#x51FA;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x89C2;&#x5BDF;&#x5230;&#x53EA;&#x6709; Polygeist &#x6210;&#x529F;&#x5730;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x57FA;&#x51C6;&#x8FDB;&#x884C;&#x4E86;&#x5E76;&#x884C;&#x5316;&#x3002;&#x8003;&#x8651;&#x5230;&#x56FE; 13 &#x4E2D;&#x7684;&#x8F93;&#x5165;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230; i &#x5FAA;&#x73AF;&#x91CD;&#x7528;&#x4E86; ym1 &#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x88AB;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x89E3;&#x91CA;&#x4E3A;&#x59A8;&#x788D;&#x5E76;&#x884C;&#x5316;&#x7684;&#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x4F9D;&#x8D56;&#x3002;Polygeist &#x5728;&#x5C06; ym1 &#x63D0;&#x5347;&#x4E3A;&#x4E00;&#x4E2A;&#x7531; j &#x5FAA;&#x73AF;&#x643A;&#x5E26;&#x7684; SSA &#x5BC4;&#x5B58;&#x5668;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x81EA;&#x5DF1;&#x7684;&#x5E76;&#x884C;&#x6027;&#x5206;&#x6790;&#xFF0C;&#x5176;&#x4F7F;&#x7528;&#x5B9A;&#x4E49;&#x8303;&#x56F4;&#x4E0D;&#x59A8;&#x788D;&#x5E76;&#x884C;&#x5316;&#x3002;</p>
<p>&#x7C7B;&#x4F3C;&#x5730;&#xFF0C;Polygeist &#x7684;&#x5E76;&#x884C;&#x5316;&#x5668;&#x8BC6;&#x522B;&#x51FA;&#x4E24;&#x4E2A;&#x5177;&#x6709;&#x5E76;&#x884C;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#x7684;&#x57FA;&#x51C6;&#xFF0C;&#x8FD9;&#x4E9B;&#x5FAA;&#x73AF;&#x4E0D;&#x5305;&#x542B;&#x5728;&#x5176;&#x4ED6;&#x5E76;&#x884C;&#x5FAA;&#x73AF;&#x4E2D;&#xFF1A;gramschmidt &#x548C; durbin&#x3002;&#x76F8;&#x6BD4;&#x4E8E; Polly &#x7684; 34&#xD7; &#x548C; Pluto &#x7684; 54&#xD7;&#xFF0C;gramschmidt &#x5728; Polygeist &#x7684;&#x5E2E;&#x52A9;&#x4E0B;&#x83B7;&#x5F97;&#x4E86; 56&#xD7; &#x7684;&#x52A0;&#x901F;&#x3002;durbin &#x5219;&#x51FA;&#x73B0;&#x4E86; 6&#xD7; &#x7684;&#x51CF;&#x901F;&#xFF0C;&#x56E0;&#x4E3A;&#x65B0;&#x7684;&#x5E76;&#x884C;&#x5FAA;&#x73AF;&#x8FED;&#x4EE3;&#x6B21;&#x6570;&#x76F8;&#x5BF9;&#x8F83;&#x5C11;&#xFF0C;&#x5E76;&#x4E14;&#x5D4C;&#x5957;&#x5728;&#x4E00;&#x4E2A;&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x5185;&#xFF0C;&#x5BFC;&#x81F4;&#x540C;&#x6B65;&#x6210;&#x672C;&#x8D85;&#x8FC7;&#x4E86;&#x5E76;&#x884C;&#x5316;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x3002;&#x7B2C; V-F &#x8282;&#x5C06;&#x66F4;&#x8BE6;&#x7EC6;&#x5730;&#x63A2;&#x8BA8; durbin &#x57FA;&#x51C6;&#x3002;</p>
<p>Polybench &#x662F;&#x4E00;&#x7EC4;&#xFF08;&#x5927;&#x591A;&#x6570;&#x5DF2;&#x77E5;&#xFF09;&#x5177;&#x6709;&#x5E76;&#x884C;&#x7279;&#x6027;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x5728; CPU &#x4E0A;&#x8FDB;&#x884C;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#x7684;&#x9700;&#x6C42;&#x4E0D;&#x5927;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x4E00;&#x5EA6;&#x7684;&#x5E76;&#x884C;&#x6027;&#x5C31;&#x5DF2;&#x8DB3;&#x591F;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x9488;&#x5BF9;&#x56FA;&#x6709;&#x7684;&#x76EE;&#x6807;&#x67B6;&#x6784;&#x5982; GPU &#x65F6;&#xFF0C;&#x5229;&#x7528;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x6027;&#x53EF;&#x80FD;&#x5BF9;&#x4E8E;&#x5B9E;&#x73B0;&#x5CF0;&#x503C;&#x6027;&#x80FD;&#x81F3;&#x5173;&#x91CD;&#x8981; [31], [24]&#x3002;</p>
<h2 id="e-case-study-statement-splitting"># E. Case Study: Statement Splitting</h2>
<p>We identified 5 benchmarks where the statement splitting heuristic applied: 2mm, 3mm, correlation, covariance and trmm. To assess the effect of the transformation, we executed these benchmarks with statement splitting disabled, suffixed with -nosplit in Figure 14. In sequential versions, 2mm is 4.1% slower (3.13s vs 3.26s), but the other benchmarks see speedups of 25%, 50%, 51% and 27%, respectively. For parallel versions, the speedups are of 36%, 20%, 44%, 40% and -9% respectively.
Examination of polyhedral scheduler outputs demonstrates that it indeed produced the desired schedules. For example, in the correlation benchmark which had the statement
A[i][j] += B[k][i] * B[k][j]
Polygeist was able to find the (k, i, j) loop order after splitting. Using hardware performance counters on sequential code we confirm that the overall cache miss ratio has indeed decreased by 75%, 50%, 20%, 27%, and -26%, respectively. However, the memory traffic estimated by the number of bus cycles has increased by 9% for 2mm, and decreased by 18%, 32%, 32%, and 21% for the other benchmarks. This metric strongly correlates with the observed performance difference in the same run (r = 0.99, p = 3 &#x2022; 10 -11 ). This behavior is likely due to the scheduler producing a different fusion structure, e.g., not fusing outermost loops in 2mm, which also affects locality. Similar results can be observed for parallel code. Further research is necessary to exploit the statement splitting opportunities, created by Polygeist, and interplay with fusion.</p>
<p>E. &#x6848;&#x4F8B;&#x7814;&#x7A76;&#xFF1A;&#x8BED;&#x53E5;&#x62C6;&#x5206;</p>
<p>&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x4E86; 5 &#x4E2A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#xFF0C;&#x5176;&#x4E2D;&#x5E94;&#x7528;&#x4E86;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x542F;&#x53D1;&#x5F0F;&#x65B9;&#x6CD5;&#xFF1A;2mm&#x3001;3mm&#x3001;&#x76F8;&#x5173;&#x6027;&#x3001;&#x534F;&#x65B9;&#x5DEE;&#x548C; trmm&#x3002;&#x4E3A;&#x4E86;&#x8BC4;&#x4F30;&#x53D8;&#x6362;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x4E86;&#x8FD9;&#x4E9B;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x7981;&#x7528;&#x4E86;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#xFF0C;&#x7528; -nosplit &#x540E;&#x7F00;&#x6807;&#x8BB0;&#xFF0C;&#x5982;&#x56FE; 14 &#x6240;&#x793A;&#x3002;&#x5728;&#x987A;&#x5E8F;&#x7248;&#x672C;&#x4E2D;&#xFF0C;2mm &#x7684;&#x901F;&#x5EA6;&#x6162;&#x4E86; 4.1%&#xFF08;3.13 &#x79D2;&#x5BF9;&#x6BD4; 3.26 &#x79D2;&#xFF09;&#xFF0C;&#x4F46;&#x5176;&#x4ED6;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x5206;&#x522B;&#x770B;&#x5230;&#x4E86; 25%&#x3001;50%&#x3001;51% &#x548C; 27% &#x7684;&#x52A0;&#x901F;&#x3002;&#x5BF9;&#x4E8E;&#x5E76;&#x884C;&#x7248;&#x672C;&#xFF0C;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#x5206;&#x522B;&#x4E3A; 36%&#x3001;20%&#x3001;44%&#x3001;40% &#x548C; -9%&#x3002;</p>
<p>&#x5BF9;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#x8F93;&#x51FA;&#x7684;&#x68C0;&#x67E5;&#x8868;&#x660E;&#xFF0C;&#x5B83;&#x786E;&#x5B9E;&#x751F;&#x6210;&#x4E86;&#x9884;&#x671F;&#x7684;&#x8C03;&#x5EA6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x76F8;&#x5173;&#x6027;&#x57FA;&#x51C6;&#x4E2D;&#xFF0C;&#x8BED;&#x53E5;
A[i][j] += B[k][i] * B[k][j]
Polygeist &#x80FD;&#x591F;&#x5728;&#x62C6;&#x5206;&#x540E;&#x627E;&#x5230; (k, i, j) &#x7684;&#x5FAA;&#x73AF;&#x987A;&#x5E8F;&#x3002;&#x901A;&#x8FC7;&#x5728;&#x987A;&#x5E8F;&#x4EE3;&#x7801;&#x4E0A;&#x4F7F;&#x7528;&#x786C;&#x4EF6;&#x6027;&#x80FD;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x786E;&#x8BA4;&#x6574;&#x4F53;&#x7F13;&#x5B58;&#x7F3A;&#x5931;&#x7387;&#x786E;&#x5B9E;&#x5206;&#x522B;&#x964D;&#x4F4E;&#x4E86; 75%&#x3001;50%&#x3001;20%&#x3001;27% &#x548C; -26%&#x3002;&#x7136;&#x800C;&#xFF0C;&#x7531;&#x603B;&#x5323;&#x5468;&#x671F;&#x4F30;&#x7B97;&#x7684;&#x5185;&#x5B58;&#x6D41;&#x91CF;&#x5728; 2mm &#x4E2D;&#x589E;&#x52A0;&#x4E86; 9%&#xFF0C;&#x800C;&#x5176;&#x4ED6;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x5219;&#x5206;&#x522B;&#x51CF;&#x5C11;&#x4E86; 18%&#x3001;32%&#x3001;32% &#x548C; 21%&#x3002;&#x8BE5;&#x6307;&#x6807;&#x4E0E;&#x540C;&#x4E00;&#x8FD0;&#x884C;&#x4E2D;&#x89C2;&#x5BDF;&#x5230;&#x7684;&#x6027;&#x80FD;&#x5DEE;&#x5F02;&#x5F3A;&#x76F8;&#x5173;&#xFF08;r = 0.99&#xFF0C;p = 3 &#x2022; 10 -11&#xFF09;&#x3002;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;&#x8C03;&#x5EA6;&#x5668;&#x4EA7;&#x751F;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x878D;&#x5408;&#x7ED3;&#x6784;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5728; 2mm &#x4E2D;&#x6CA1;&#x6709;&#x878D;&#x5408;&#x6700;&#x5916;&#x5C42;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F71;&#x54CD;&#x4E86;&#x5C40;&#x90E8;&#x6027;&#x3002;&#x5E76;&#x884C;&#x4EE3;&#x7801;&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x7814;&#x7A76;&#x6709;&#x5FC5;&#x8981;&#x5229;&#x7528; Polygeist &#x521B;&#x9020;&#x7684;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x673A;&#x4F1A;&#xFF0C;&#x5E76;&#x4E0E;&#x878D;&#x5408;&#x8FDB;&#x884C;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x3002;</p>
<h2 id="f-case-study-reduction-parallelization-in-durbin"># F. Case Study: Reduction Parallelization in durbin</h2>
<p>In this benchmark, Polygeist uses its reduction optimization to create a parallel loop that other tools cannot. For the relatively small input run by default, N = 4000 iterations inside another sequential loop with N iterations, the overall  performance decreases. We hypothesize that the cost of creating parallel threads and synchronizing them outweighs the benefit of the additional parallelism and test our hypothesis by increasing N . Considering the results in Figure 15, one observes that Polygeist starts yielding speedups (&gt; 1) for N &#x2265; 16000 whereas Polly only does so at N &#x2265; 224000, and to a much lesser extent: 6.62&#xD7; vs 1.01&#xD7;. Without reduction parallelization, Polygeist follows the same trajectory as Polly. Pluto fails to parallelize any innermost loop and shows no speedup. This evidences in favor of our hypothesis and highlights the importance of being able to parallelize reductions.</p>
<p>F. &#x6848;&#x4F8B;&#x7814;&#x7A76;&#xFF1A;Durbin&#x4E2D;&#x7684;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x4E2D;&#xFF0C;Polygeist&#x5229;&#x7528;&#x5176;&#x5F52;&#x7EA6;&#x4F18;&#x5316;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x5E76;&#x884C;&#x5FAA;&#x73AF;&#x3002;&#x5BF9;&#x4E8E;&#x9ED8;&#x8BA4;&#x8FD0;&#x884C;&#x7684;&#x76F8;&#x5BF9;&#x8F83;&#x5C0F;&#x7684;&#x8F93;&#x5165;&#xFF0C;N = 4000&#x7684;&#x8FED;&#x4EE3;&#x5D4C;&#x5957;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5177;&#x6709;N&#x6B21;&#x8FED;&#x4EE3;&#x7684;&#x987A;&#x5E8F;&#x5FAA;&#x73AF;&#x4E2D;&#xFF0C;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x51FA;&#x73B0;&#x4E0B;&#x964D;&#x3002;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x521B;&#x5EFA;&#x5E76;&#x884C;&#x7EBF;&#x7A0B;&#x548C;&#x540C;&#x6B65;&#x5B83;&#x4EEC;&#x7684;&#x6210;&#x672C;&#x8D85;&#x8FC7;&#x4E86;&#x989D;&#x5916;&#x5E76;&#x884C;&#x6027;&#x5E26;&#x6765;&#x7684;&#x6536;&#x76CA;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x589E;&#x52A0;N&#x6765;&#x9A8C;&#x8BC1;&#x6211;&#x4EEC;&#x7684;&#x5047;&#x8BBE;&#x3002;&#x6839;&#x636E;&#x56FE;15&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#xFF0C;Polygeist&#x5728;N &#x2265; 16000&#x65F6;&#x5F00;&#x59CB;&#x4EA7;&#x751F;&#x52A0;&#x901F;&#x6548;&#x679C;&#xFF08;&gt; 1&#xFF09;&#xFF0C;&#x800C;Polly&#x4EC5;&#x5728;N &#x2265; 224000&#x65F6;&#x624D;&#x4F1A;&#x5982;&#x6B64;&#xFF0C;&#x5E76;&#x4E14;&#x5E45;&#x5EA6;&#x8981;&#x5C0F;&#x5F97;&#x591A;&#xFF1A;6.62&#xD7;&#x5BF9;&#x6BD4;1.01&#xD7;&#x3002;&#x5728;&#x6CA1;&#x6709;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Polygeist&#x7684;&#x8868;&#x73B0;&#x4E0E;Polly&#x76F8;&#x540C;&#x3002;Pluto&#x672A;&#x80FD;&#x5BF9;&#x4EFB;&#x4F55;&#x6700;&#x5185;&#x5C42;&#x5FAA;&#x73AF;&#x8FDB;&#x884C;&#x5E76;&#x884C;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x663E;&#x793A;&#x6CA1;&#x6709;&#x52A0;&#x901F;&#x3002;&#x8FD9;&#x652F;&#x6301;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x5047;&#x8BBE;&#xFF0C;&#x5E76;&#x5F3A;&#x8C03;&#x4E86;&#x80FD;&#x591F;&#x5E76;&#x884C;&#x5316;&#x5F52;&#x7EA6;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;</p>
<h2 id="vi-related-work"># VI. RELATED WORK</h2>
<p>a) MLIR Frontends: Since the adoption of MLIR under the LLVM umbrella, several frontends have been created for generating MLIR from domain-specific languages. Teckyl [2] connects the productivity-oriented Tensor Comprehensions [1] notation to MLIR&apos;s Linalg dialect. Flang-the LLVM&apos;s Fortran frontend-models Fortran-specific constructs using the FIR dialect [32]. COMET, a domain-specific compiler for chemistry, introduces an MLIR-targeting domain-specific frontend from a tensor-based language [33]. NPComp aims at providing the necessary infrastructure to compile numerical Python and PyTorch programs taking advantage of the MLIR infrastructure [34]. PET-to-MLIR converts a subset of polyhedral C code to MLIR&apos;s Affine dialect by parsing pet&apos;s internal represen-tation. In addition to currently not handling specific constructs (ifs, symbolic bounds, and external function calls), parsing pet&apos;s representation limits the frontend&apos;s usability as it cannot interface with non-polyhedral code such as initialization, verification, or printing routines [35]. In contrast, Polygeist generates MLIR from non-polyhedral code (though not necessarily in the Affine dialect). CIRCT is a new project under the LLVM umbrella that aims to apply MLIR development methodology to the electronic design automation industry [17]. Stripe uses MLIR Affine dialect as a substrate for loop transformations in machine learning models, including tiling and vectorization, and accepts a custom DSL as input [36].</p>
<p>VI. &#x76F8;&#x5173;&#x5DE5;&#x4F5C;</p>
<p>a) MLIR&#x524D;&#x7AEF;&#xFF1A;&#x81EA;&#x4ECE;MLIR&#x88AB;&#x7EB3;&#x5165;LLVM&#x6846;&#x67B6;&#x540E;&#xFF0C;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;&#x591A;&#x4E2A;&#x524D;&#x7AEF;&#x7528;&#x4E8E;&#x4ECE;&#x7279;&#x5B9A;&#x9886;&#x57DF;&#x8BED;&#x8A00;&#x751F;&#x6210;MLIR&#x3002;Teckyl [2] &#x5C06;&#x9762;&#x5411;&#x751F;&#x4EA7;&#x529B;&#x7684;&#x5F20;&#x91CF;&#x7406;&#x89E3; [1] &#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x5230;MLIR&#x7684;Linalg&#x65B9;&#x8A00;&#x3002;Flang&#xFF0C;LLVM&#x7684;Fortran&#x524D;&#x7AEF;&#xFF0C;&#x4F7F;&#x7528;FIR&#x65B9;&#x8A00;&#x5EFA;&#x6A21;Fortran&#x7279;&#x5B9A;&#x7684;&#x6784;&#x9020; [32]&#x3002;COMET&#xFF0C;&#x4E00;&#x4E2A;&#x9488;&#x5BF9;&#x5316;&#x5B66;&#x9886;&#x57DF;&#x7684;&#x7279;&#x5B9A;&#x9886;&#x57DF;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x4ECE;&#x57FA;&#x4E8E;&#x5F20;&#x91CF;&#x7684;&#x8BED;&#x8A00;&#x5230;MLIR&#x7684;&#x7279;&#x5B9A;&#x9886;&#x57DF;&#x524D;&#x7AEF; [33]&#x3002;NPComp&#x65E8;&#x5728;&#x63D0;&#x4F9B;&#x5FC5;&#x8981;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4EE5;&#x4FBF;&#x7F16;&#x8BD1;&#x6570;&#x503C;Python&#x548C;PyTorch&#x7A0B;&#x5E8F;&#xFF0C;&#x4ECE;&#x800C;&#x5229;&#x7528;MLIR&#x57FA;&#x7840;&#x8BBE;&#x65BD; [34]&#x3002;PET-to-MLIR&#x901A;&#x8FC7;&#x89E3;&#x6790;pet&#x7684;&#x5185;&#x90E8;&#x8868;&#x793A;&#xFF0C;&#x5C06;&#x4E00;&#x90E8;&#x5206;&#x591A;&#x9762;&#x4F53;C&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;MLIR&#x7684;Affine&#x65B9;&#x8A00;&#x3002;&#x9664;&#x4E86;&#x5F53;&#x524D;&#x4E0D;&#x5904;&#x7406;&#x7279;&#x5B9A;&#x6784;&#x9020;&#xFF08;&#x5982;if&#x8BED;&#x53E5;&#x3001;&#x7B26;&#x53F7;&#x8FB9;&#x754C;&#x548C;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF09;&#x5916;&#xFF0C;&#x89E3;&#x6790;pet&#x7684;&#x8868;&#x793A;&#x9650;&#x5236;&#x4E86;&#x524D;&#x7AEF;&#x7684;&#x53EF;&#x7528;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x65E0;&#x6CD5;&#x4E0E;&#x975E;&#x591A;&#x9762;&#x4F53;&#x4EE3;&#x7801;&#xFF08;&#x5982;&#x521D;&#x59CB;&#x5316;&#x3001;&#x9A8C;&#x8BC1;&#x6216;&#x6253;&#x5370;&#x4F8B;&#x7A0B;&#xFF09;&#x63A5;&#x53E3; [35]&#x3002;&#x76F8;&#x5BF9;&#x800C;&#x8A00;&#xFF0C;Polygeist&#x80FD;&#x591F;&#x4ECE;&#x975E;&#x591A;&#x9762;&#x4F53;&#x4EE3;&#x7801;&#x751F;&#x6210;MLIR&#xFF08;&#x5C3D;&#x7BA1;&#x4E0D;&#x4E00;&#x5B9A;&#x5728;Affine&#x65B9;&#x8A00;&#x4E2D;&#xFF09;&#x3002;CIRCT&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x65E8;&#x5728;&#x5C06;MLIR&#x5F00;&#x53D1;&#x65B9;&#x6CD5;&#x5E94;&#x7528;&#x4E8E;&#x7535;&#x5B50;&#x8BBE;&#x8BA1;&#x81EA;&#x52A8;&#x5316;&#x884C;&#x4E1A;&#xFF0C;&#x96B6;&#x5C5E;&#x4E8E;LLVM&#x6846;&#x67B6; [17]&#x3002;Stripe&#x4F7F;&#x7528;MLIR&#x7684;Affine&#x65B9;&#x8A00;&#x4F5C;&#x4E3A;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x6A21;&#x578B;&#x4E2D;&#x7684;&#x5FAA;&#x73AF;&#x53D8;&#x6362;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5305;&#x62EC;&#x62C6;&#x5206;&#x548C;&#x5411;&#x91CF;&#x5316;&#xFF0C;&#x5E76;&#x63A5;&#x53D7;&#x81EA;&#x5B9A;&#x4E49;DSL&#x4F5C;&#x4E3A;&#x8F93;&#x5165; [36]&#x3002;</p>
<h2 id="b-compilers-leveraging-multiple-representations"># b) Compilers Leveraging Multiple Representations:</h2>
<p>The SUIF compiler infrastructure pioneered a combined internal representation that supports higher-level transformations, including loop optimization and parallelization [37] and, in particular, reduction parallelization [38]. Polygeist leverages MLIR abstractions unavailable in SUIF: regular and affine for loops, OpenMP reduction constructs, etc. It also benefits from the SSA+regions form, which is only available as external extension in SUIF [39], for IR simplification. PIPS supports loop transformations and inter-procedural optimization when targeting OpenMP [40], [41]. Polygeist differs from both by emitting machine code rather than source code, which allows it to emit parallel runtime and other directives that have no representation in the source language such as C. c) Combining &quot;Classical&quot; and Polyhedral Flows: Few papers have focused on combining &quot;classical&quot;, mostly ASTlevel, and polyhedral transformations. PolyAST pioneered the approach by combining an affine scheduler with ASTlevel heuristics for fusion and tiling [42], although similar results were demonstrated with only polyhedral transformations [43]. An analogous approach was experimented in CUDA-CHiLL [44]. Arguably, many automated polyhedral flows perform loop fusion and/or tiling as a separate step that can be assimilated to classical transformations. Pluto [11] uses several &quot;syntactic&quot; postprocessing passes to exploit spatial locality and parallelism in stencils [45]. Several tools have been proposed to drive polyhedral loop transformations with scripts using classical loop transformations such as fusion and permutation as operations, including URUK [46], CHiLL [47] and Clay [48]. Polygeist differs from all of these because it preserves the results of such transformations in its IR along with polyhedral constructs and enables interaction between different levels of abstraction. d) Additional (Post-)Polyhedral Transformations: Support for handling reduction loops was proposed in Polly [25], but the code generation is not implemented. At the syntactic level, reduction support was added to PET via manual annotation with PENCIL directives [24]. R-Stream reportedly uses a variant of statement splitting to affect scheduler&apos;s behavior and optimize memory consumption [49]. POLYSIMD uses variable renaming around PPCG polyhedral flow to improve vectorization [50]. Polygeist automates these leveraging both SSA and polyhedral information.</p>
<p>b) &#x5229;&#x7528;&#x591A;&#x79CD;&#x8868;&#x793A;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#xFF1A;SUIF&#x7F16;&#x8BD1;&#x5668;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x5F00;&#x521B;&#x4E86;&#x4E00;&#x79CD;&#x7EC4;&#x5408;&#x5185;&#x90E8;&#x8868;&#x793A;&#xFF0C;&#x652F;&#x6301;&#x66F4;&#x9AD8;&#x7EA7;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x5305;&#x62EC;&#x5FAA;&#x73AF;&#x4F18;&#x5316;&#x548C;&#x5E76;&#x884C;&#x5316; [37]&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316; [38]&#x3002;Polygeist&#x5229;&#x7528;SUIF&#x4E2D;&#x4E0D;&#x53EF;&#x7528;&#x7684;MLIR&#x62BD;&#x8C61;&#xFF1A;&#x5E38;&#x89C4;&#x548C;&#x4EFF;&#x5C04;&#x5FAA;&#x73AF;&#xFF0C;OpenMP&#x5F52;&#x7EA6;&#x6784;&#x9020;&#x7B49;&#x3002;&#x5B83;&#x8FD8;&#x53D7;&#x76CA;&#x4E8E;&#x4EC5;&#x4F5C;&#x4E3A;&#x5916;&#x90E8;&#x6269;&#x5C55;&#x5B58;&#x5728;&#x4E8E;SUIF&#x4E2D;&#x7684;SSA+&#x533A;&#x57DF;&#x5F62;&#x5F0F; [39]&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x4E2D;&#x95F4;&#x8868;&#x793A;&#x7684;&#x7B80;&#x5316;&#x3002;PIPS&#x5728;&#x9488;&#x5BF9;OpenMP&#x65F6;&#x652F;&#x6301;&#x5FAA;&#x73AF;&#x8F6C;&#x6362;&#x548C;&#x8FC7;&#x7A0B;&#x95F4;&#x4F18;&#x5316; [40]&#xFF0C;[41]&#x3002;Polygeist&#x4E0E;&#x8FD9;&#x4E24;&#x8005;&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#x5B83;&#x53D1;&#x51FA;&#x673A;&#x5668;&#x4EE3;&#x7801;&#x800C;&#x4E0D;&#x662F;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x4ECE;&#x800C;&#x80FD;&#x591F;&#x53D1;&#x51FA;&#x5E76;&#x884C;&#x8FD0;&#x884C;&#x65F6;&#x548C;&#x5176;&#x4ED6;&#x5728;&#x6E90;&#x8BED;&#x8A00;&#xFF08;&#x5982;C&#xFF09;&#x4E2D;&#x6CA1;&#x6709;&#x8868;&#x793A;&#x7684;&#x6307;&#x4EE4;&#x3002;</p>
<p>c) &#x7ED3;&#x5408;&#x201C;&#x7ECF;&#x5178;&#x201D;&#x548C;&#x591A;&#x9762;&#x4F53;&#x6D41;&#x7A0B;&#xFF1A;&#x5C11;&#x6570;&#x8BBA;&#x6587;&#x5173;&#x6CE8;&#x4E8E;&#x5C06;&#x201C;&#x7ECF;&#x5178;&#x201D;&#x7684;&#x3001;&#x5927;&#x591A;&#x6570;&#x662F;AST&#x7EA7;&#x522B;&#x7684;&#x8F6C;&#x5316;&#x4E0E;&#x591A;&#x9762;&#x4F53;&#x8F6C;&#x5316;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;PolyAST&#x901A;&#x8FC7;&#x7ED3;&#x5408;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5668;&#x4E0E;AST&#x7EA7;&#x522B;&#x7684;&#x542F;&#x53D1;&#x5F0F;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x878D;&#x5408;&#x548C;&#x5207;&#x7247; [42]&#xFF0C;&#x5F00;&#x521B;&#x4E86;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x5C3D;&#x7BA1;&#x4EC5;&#x4F7F;&#x7528;&#x591A;&#x9762;&#x4F53;&#x8F6C;&#x5316;&#x4E5F;&#x5C55;&#x793A;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x7ED3;&#x679C; [43]&#x3002;CUDA-CHiLL [44] &#x4E5F;&#x5B9E;&#x9A8C;&#x4E86;&#x4E00;&#x79CD;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x53EF;&#x4EE5;&#x8BF4;&#xFF0C;&#x8BB8;&#x591A;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x591A;&#x9762;&#x4F53;&#x6D41;&#x7A0B;&#x5C06;&#x5FAA;&#x73AF;&#x878D;&#x5408;&#x548C;/&#x6216;&#x5207;&#x7247;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x6B65;&#x9AA4;&#x6765;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x4E00;&#x79CD;&#x7ECF;&#x5178;&#x8F6C;&#x5316;&#x3002;Pluto [11] &#x4F7F;&#x7528;&#x51E0;&#x4E2A;&#x201C;&#x8BED;&#x6CD5;&#x201D;&#x540E;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x6765;&#x5229;&#x7528;&#x6A21;&#x677F;&#x4E2D;&#x7684;&#x7A7A;&#x95F4;&#x5C40;&#x90E8;&#x6027;&#x548C;&#x5E76;&#x884C;&#x6027; [45]&#x3002;&#x5DF2;&#x63D0;&#x51FA;&#x591A;&#x4E2A;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x7ECF;&#x5178;&#x5FAA;&#x73AF;&#x8F6C;&#x5316;&#x5982;&#x878D;&#x5408;&#x548C;&#x6392;&#x5217;&#x4F5C;&#x4E3A;&#x64CD;&#x4F5C;&#xFF0C;&#x9A71;&#x52A8;&#x591A;&#x9762;&#x4F53;&#x5FAA;&#x73AF;&#x8F6C;&#x5316;&#xFF0C;&#x5305;&#x62EC;URUK [46]&#x3001;CHiLL [47] &#x548C;Clay [48]&#x3002;Polygeist&#x4E0E;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x7684;&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#x5B83;&#x5728;&#x5176;IR&#x4E2D;&#x4FDD;&#x7559;&#x4E86;&#x6B64;&#x7C7B;&#x8F6C;&#x5316;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5E76;&#x4E14;&#x4E0E;&#x591A;&#x9762;&#x4F53;&#x6784;&#x9020;&#x4E00;&#x8D77;&#xFF0C;&#x5141;&#x8BB8;&#x4E0D;&#x540C;&#x62BD;&#x8C61;&#x5C42;&#x6B21;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
<p>d) &#x989D;&#x5916;&#x7684;&#xFF08;&#x540E;&#xFF09;&#x591A;&#x9762;&#x4F53;&#x8F6C;&#x5316;&#xFF1A;Polly [25] &#x63D0;&#x51FA;&#x4E86;&#x5904;&#x7406;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x5E76;&#x672A;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x3002;&#x5728;&#x8BED;&#x6CD5;&#x5C42;&#x9762;&#xFF0C;&#x901A;&#x8FC7;&#x624B;&#x52A8;&#x6CE8;&#x91CA;&#x4F7F;&#x7528;PENCIL&#x6307;&#x4EE4;&#x5411;PET&#x6DFB;&#x52A0;&#x4E86;&#x5F52;&#x7EA6;&#x652F;&#x6301; [24]&#x3002;&#x636E;&#x62A5;&#x9053;&#xFF0C;R-Stream&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x79CD;&#x53D8;&#x4F53;&#x7684;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x4EE5;&#x5F71;&#x54CD;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x5E76;&#x4F18;&#x5316;&#x5185;&#x5B58;&#x6D88;&#x8017; [49]&#x3002;POLYSIMD&#x5728;PPCG&#x591A;&#x9762;&#x4F53;&#x6D41;&#x7A0B;&#x5468;&#x56F4;&#x4F7F;&#x7528;&#x53D8;&#x91CF;&#x91CD;&#x547D;&#x540D;&#x4EE5;&#x6539;&#x5584;&#x5411;&#x91CF;&#x5316; [50]&#x3002;Polygeist&#x5229;&#x7528;SSA&#x548C;&#x591A;&#x9762;&#x4F53;&#x4FE1;&#x606F;&#x81EA;&#x52A8;&#x5316;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;</p>
<h2 id="e-integration-of-polyhedral-optimizers-into-compilers"># e) Integration of Polyhedral Optimizers into Compilers:</h2>
<p>Polyhedral optimization passes are available in production (GCC [8], LLVM [7], IBM XL [51]) and research (R-Stream [49], ROSE [52]) compilers. In most cases, the polyhedral abstraction must be extracted from a lower-level representation before being transformed and lowered in a dedicated code generation step [13], [14]. This extraction process is not guaranteed and may fail to recover high-level information available at the source level [9]. Furthermore, common compiler optimizations such as LICM are known to interfere with it [10]. Polygeist maintains a sufficient amount of high-level information, in particular loop and n-D array structure, to circumvent these problems by design.
Source-to-source polyhedral compilers such as Pluto [11] and PPCG [5] operate on a C or C++ level. They lack interaction with other compiler optimizations and a global vision of the code, which prevents, e.g., constant propagation and inlining that could improve the results of polyhedral optimization. Being positioned between the AST and LLVM IR levels, Polygeist enables the interaction between higherand lower-level abstractions that is otherwise reduced to compiler pragmas, i.e. mere optimization hints. Furthermore, Polygeist can rely on MLIR&apos;s progressive raising [53] to target abstractions higher level than C code with less effort than polyhedral frameworks [54].</p>
<h3 id="e-&#x805A;&#x5408;&#x4F18;&#x5316;&#x5668;&#x4E0E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x96C6;&#x6210;">e) &#x805A;&#x5408;&#x4F18;&#x5316;&#x5668;&#x4E0E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x96C6;&#x6210;:</h3>
<p>&#x805A;&#x5408;&#x4F18;&#x5316;&#x4F20;&#x9012;&#x5728;&#x751F;&#x4EA7;&#xFF08;GCC [8]&#xFF0C;LLVM [7]&#xFF0C;IBM XL [51]&#xFF09;&#x548C;&#x7814;&#x7A76;&#xFF08;R-Stream [49]&#xFF0C;ROSE [52]&#xFF09;&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#x53EF;&#x7528;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5FC5;&#x987B;&#x4ECE;&#x4F4E;&#x7EA7;&#x8868;&#x793A;&#x4E2D;&#x63D0;&#x53D6;&#x805A;&#x5408;&#x62BD;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4E13;&#x95E8;&#x7684;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x6B65;&#x9AA4;&#x4E2D;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x548C;&#x964D;&#x7EA7; [13]&#xFF0C;[14]&#x3002;&#x8FD9;&#x4E2A;&#x63D0;&#x53D6;&#x8FC7;&#x7A0B;&#x5E76;&#x4E0D;&#x662F;&#x4FDD;&#x8BC1;&#x6210;&#x529F;&#x7684;&#xFF0C;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6062;&#x590D;&#x6E90;&#x7EA7;&#x522B;&#x4E0A;&#x53EF;&#x7528;&#x7684;&#x9AD8;&#x7EA7;&#x4FE1;&#x606F; [9]&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#xFF0C;&#x4F8B;&#x5982;LICM&#xFF0C;&#x5DF2;&#x77E5;&#x4F1A;&#x5BF9;&#x6B64;&#x4EA7;&#x751F;&#x5E72;&#x6270; [10]&#x3002;Polygeist &#x901A;&#x8FC7;&#x8BBE;&#x8BA1;&#x7EF4;&#x62A4;&#x8DB3;&#x591F;&#x7684;&#x9AD8;&#x7EA7;&#x4FE1;&#x606F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5FAA;&#x73AF;&#x548C;&#x591A;&#x7EF4;&#x6570;&#x7EC4;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x89C4;&#x907F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x6E90;&#x5230;&#x6E90;&#x7684;&#x805A;&#x5408;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x5982;Pluto [11] &#x548C;PPCG [5]&#xFF0C;&#x5728;C&#x6216;C++&#x7EA7;&#x522B;&#x4E0A;&#x8FD0;&#x884C;&#x3002;&#x5B83;&#x4EEC;&#x7F3A;&#x4E4F;&#x4E0E;&#x5176;&#x4ED6;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x4EE3;&#x7801;&#x7684;&#x5168;&#x5C40;&#x89C6;&#x89D2;&#xFF0C;&#x8FD9;&#x963B;&#x788D;&#x4E86;&#x4F8B;&#x5982;&#x5E38;&#x91CF;&#x4F20;&#x64AD;&#x548C;&#x5185;&#x8054;&#x7B49;&#x53EF;&#x80FD;&#x6539;&#x5584;&#x805A;&#x5408;&#x4F18;&#x5316;&#x7ED3;&#x679C;&#x7684;&#x8FC7;&#x7A0B;&#x3002;Polygeist&#x4F4D;&#x4E8E;AST&#x548C;LLVM IR&#x7EA7;&#x522B;&#x4E4B;&#x95F4;&#xFF0C;&#x4F7F;&#x5F97;&#x66F4;&#x9AD8;&#x7EA7;&#x522B;&#x548C;&#x4F4E;&#x7EA7;&#x522B;&#x62BD;&#x8C61;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#xFF0C;&#x800C;&#x8FD9;&#x79CD;&#x4EA4;&#x4E92;&#x5728;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x4E0B;&#x4EC5;&#x9650;&#x4E8E;&#x7F16;&#x8BD1;&#x5668;&#x6307;&#x793A;&#xFF0C;&#x5373;&#x4EC5;&#x4EC5;&#x662F;&#x4F18;&#x5316;&#x63D0;&#x793A;&#x3002;&#x6B64;&#x5916;&#xFF0C;Polygeist&#x53EF;&#x4EE5;&#x4F9D;&#x9760;MLIR&#x7684;&#x9010;&#x6B65;&#x63D0;&#x5347; [53]&#xFF0C;&#x4EE5;&#x6BD4;&#x805A;&#x5408;&#x6846;&#x67B6; [54] &#x66F4;&#x5C11;&#x7684;&#x52AA;&#x529B;&#xFF0C;&#x9488;&#x5BF9;&#x66F4;&#x9AD8;&#x4E8E;C&#x4EE3;&#x7801;&#x7684;&#x62BD;&#x8C61;&#x3002;</p>
<h2 id="vii-discussion"># VII. DISCUSSION</h2>
<p>A. Limitations a) Frontend: While Polygeist could technically accept any valid C or C++ thanks to building off Clang, it has the following limitations. Only structs with values of the same type or are used within specific functions (such as FILE within fprintf) are supported due to the lack of a struct-type in high-level MLIR dialects. All functions that allocate memory must be compiled with Polygeist and not a C++ compiler to ensure that a memref is emitted rather than a pointer. b) Optimizer: The limitations of the optimizer are inherited from those of the tools involved. In particular, the MLIR affine value categorization results in all-or-nothing modeling, degrading any loop to non-affine if it contains even one nonaffine access or a negative step. Running Polygeist&apos;s backend on code not generated by Polygeist&apos;s frontend, which reverses loops with negative steps, is limited to loops with positive indices. Finally, MLIR does not yet provide extensive support for non-convex sets (typically expressed as unions). Work is ongoing within MLIR to address such issues.
c) Experiments: While our experiments clearly demonstrate the benefits of the techniques implemented in Polygeist-statement splitting and late (reduction) parallelization -non-negligible effects are due to scheduler difference: Pluto in Polygeist and isl in Polly. The version of Polly using Pluto 5 is not compatible with modern LLVM necessary to leverage MLIR. Connecting isl scheduler to Polygeist may have yielded results closer to Polly, but still not comparable more directly because of the interplay between SCoP detection, statement formation and affine scheduling.</p>
<p>VII. &#x8BA8;&#x8BBA;</p>
<p>A. &#x9650;&#x5236;<br>a) &#x524D;&#x7AEF;&#xFF1A;&#x5C3D;&#x7BA1;Polygeist&#x6280;&#x672F;&#x4E0A;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4EFB;&#x4F55;&#x6709;&#x6548;&#x7684;C&#x6216;C++&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x57FA;&#x4E8E;Clang&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x9650;&#x5236;&#x3002;&#x7531;&#x4E8E;&#x9AD8;&#x5C42;&#x6B21;MLIR&#x65B9;&#x8A00;&#x4E2D;&#x7F3A;&#x4E4F;&#x7ED3;&#x6784;&#x7C7B;&#x578B;&#xFF0C;&#x4EC5;&#x652F;&#x6301;&#x503C;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x6216;&#x5728;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x5185;&#xFF08;&#x5982;fprintf&#x4E2D;&#x7684;FILE&#xFF09;&#x4F7F;&#x7528;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x3002;&#x6240;&#x6709;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x4F7F;&#x7528;Polygeist&#x7F16;&#x8BD1;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;C++&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x786E;&#x4FDD;&#x751F;&#x6210;&#x7684;&#x662F;memref&#x800C;&#x975E;&#x6307;&#x9488;&#x3002;<br>b) &#x4F18;&#x5316;&#x5668;&#xFF1A;&#x4F18;&#x5316;&#x5668;&#x7684;&#x9650;&#x5236;&#x6E90;&#x81EA;&#x4E8E;&#x6240;&#x6D89;&#x53CA;&#x5DE5;&#x5177;&#x7684;&#x9650;&#x5236;&#x3002;&#x7279;&#x522B;&#x662F;&#xFF0C;MLIR&#x7684;&#x4EFF;&#x5C04;&#x503C;&#x5206;&#x7C7B;&#x5BFC;&#x81F4;&#x4E86;&#x5168;&#x6709;&#x6216;&#x5168;&#x65E0;&#x7684;&#x5EFA;&#x6A21;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x5FAA;&#x73AF;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x975E;&#x4EFF;&#x5C04;&#x8BBF;&#x95EE;&#x6216;&#x8D1F;&#x6B65;&#x957F;&#xFF0C;&#x5C31;&#x4F1A;&#x5C06;&#x8BE5;&#x5FAA;&#x73AF;&#x964D;&#x7EA7;&#x4E3A;&#x975E;&#x4EFF;&#x5C04;&#x3002;&#x5BF9;&#x4E0D;&#x662F;&#x7531;Polygeist&#x524D;&#x7AEF;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;Polygeist&#x7684;&#x540E;&#x7AEF;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x5C06;&#x9650;&#x5236;&#x5728;&#x5177;&#x6709;&#x6B63;&#x7D22;&#x5F15;&#x7684;&#x5FAA;&#x73AF;&#x4E0A;&#x3002;&#x6700;&#x540E;&#xFF0C;MLIR&#x76EE;&#x524D;&#x5C1A;&#x672A;&#x63D0;&#x4F9B;&#x5BF9;&#x975E;&#x51F8;&#x96C6;&#x5408;&#x7684;&#x5E7F;&#x6CDB;&#x652F;&#x6301;&#xFF08;&#x901A;&#x5E38;&#x4EE5;&#x5E76;&#x96C6;&#x7684;&#x5F62;&#x5F0F;&#x8868;&#x793A;&#xFF09;&#x3002;MLIR&#x5185;&#x90E8;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x5DE5;&#x4F5C;&#x4EE5;&#x89E3;&#x51B3;&#x6B64;&#x7C7B;&#x95EE;&#x9898;&#x3002;<br>c) &#x5B9E;&#x9A8C;&#xFF1A;&#x5C3D;&#x7BA1;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x9A8C;&#x6E05;&#x695A;&#x5730;&#x5C55;&#x793A;&#x4E86;&#x5728;Polygeist&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x6280;&#x672F;&#x7684;&#x597D;&#x5904;&#x2014;&#x2014;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x548C;&#x540E;&#x671F;&#xFF08;&#x5F52;&#x7EA6;&#xFF09;&#x5E76;&#x884C;&#x5316;&#x2014;&#x2014;&#x4F46;&#x4ECD;&#x6709;&#x4E0D;&#x5BB9;&#x5FFD;&#x89C6;&#x7684;&#x6548;&#x679C;&#x662F;&#x7531;&#x4E8E;&#x8C03;&#x5EA6;&#x5668;&#x7684;&#x5DEE;&#x5F02;&#xFF1A;Polygeist&#x4E2D;&#x7684;Pluto&#x548C;Polly&#x4E2D;&#x7684;isl&#x3002;&#x4F7F;&#x7528;Pluto 5&#x7684;Polly&#x7248;&#x672C;&#x4E0E;&#x73B0;&#x4EE3;LLVM&#x4E0D;&#x517C;&#x5BB9;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x53C8;&#x662F;&#x5229;&#x7528;MLIR&#x6240;&#x5FC5;&#x9700;&#x7684;&#x3002;&#x5C06;isl&#x8C03;&#x5EA6;&#x5668;&#x8FDE;&#x63A5;&#x5230;Polygeist&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7ED3;&#x679C;&#x66F4;&#x63A5;&#x8FD1;Polly&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x65E0;&#x6CD5;&#x66F4;&#x76F4;&#x63A5;&#x5730;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x56E0;&#x4E3A;SCoP&#x68C0;&#x6D4B;&#x3001;&#x8BED;&#x53E5;&#x5F62;&#x6210;&#x548C;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x3002;</p>
<h2 id="b-opportunities-and-future-work"># B. Opportunities and Future Work</h2>
<p>Connecting MLIR to existing polyhedral flows opens numerous avenues for compiler optimization research, connecting polyhedral and conventional SSA-based compiler transformations. This gives polyhedral schedulers access to important analyses such as aliasing and useful information such as precise data layout and target machine description. Arguably, this information is already leveraged by Polly, but the representational mismatch between LLVM IR and affine loops makes it difficult to exploit them efficiently. MLIR exposes similar information at a sufficiently high level to make it usable in affine transformations.
By mixing abstractions in a single module, MLIR provides finer-grain control over the entire transformation process. An extension of Polygeist can, e.g., ensure loop vectorization by directly emitting vector instructions instead of relying on pragmas, which are often merely a recommendation for the compiler. The flow can also control lower-level mechanisms like prefetching or emit specialized hardware instructions. Conversely, polyhedral analyses can guarantee downstream passes that, e.g., address computation never produces out-ofbounds accesses and other information.
Future work is necessary on controlling statement granularity made possible by Polygeist. Beyond affecting affine schedules, this technique enables easy rematerialization and local transposition buffers, crucial on GPUs [55], as well as software pipelining; all without having to produce C source which is known to be complex [56]. On the other hand, this may have an effect on the compilation time as the number of statements is an important factor in the complexity bound of the dependence analysis and scheduling algorithms.</p>
<p>&#x5C06;MLIR&#x4E0E;&#x73B0;&#x6709;&#x7684;&#x591A;&#x9762;&#x4F53;&#x6D41;&#x7A0B;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x4E3A;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x7814;&#x7A76;&#x5F00;&#x8F9F;&#x4E86;&#x8BB8;&#x591A;&#x65B0;&#x9014;&#x5F84;&#xFF0C;&#x8FDE;&#x63A5;&#x4E86;&#x591A;&#x9762;&#x4F53;&#x548C;&#x4F20;&#x7EDF;&#x7684;&#x57FA;&#x4E8E;SSA&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x8F6C;&#x6362;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x591A;&#x9762;&#x4F53;&#x8C03;&#x5EA6;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x5206;&#x6790;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x522B;&#x540D;&#x5206;&#x6790;&#x4EE5;&#x53CA;&#x7CBE;&#x786E;&#x7684;&#x6570;&#x636E;&#x5E03;&#x5C40;&#x548C;&#x76EE;&#x6807;&#x673A;&#x5668;&#x63CF;&#x8FF0;&#x7B49;&#x6709;&#x7528;&#x4FE1;&#x606F;&#x3002;&#x53EF;&#x4EE5;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5DF2;&#x7ECF;&#x88AB;Polly&#x5229;&#x7528;&#xFF0C;&#x4F46;LLVM IR&#x548C;&#x4EFF;&#x5C04;&#x5FAA;&#x73AF;&#x4E4B;&#x95F4;&#x7684;&#x8868;&#x793A;&#x4E0D;&#x5339;&#x914D;&#x4F7F;&#x5F97;&#x9AD8;&#x6548;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53D8;&#x5F97;&#x56F0;&#x96BE;&#x3002;MLIR&#x4EE5;&#x8DB3;&#x591F;&#x9AD8;&#x7684;&#x62BD;&#x8C61;&#x5C42;&#x7EA7;&#x66B4;&#x9732;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F7F;&#x5176;&#x53EF;&#x7528;&#x4E8E;&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x5728;&#x5355;&#x4E2A;&#x6A21;&#x5757;&#x4E2D;&#x6DF7;&#x5408;&#x4E0D;&#x540C;&#x7684;&#x62BD;&#x8C61;&#xFF0C;MLIR&#x5BF9;&#x6574;&#x4E2A;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x63A7;&#x5236;&#x3002;Polygeist&#x7684;&#x6269;&#x5C55;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x53D1;&#x51FA;&#x5411;&#x91CF;&#x6307;&#x4EE4;&#x6765;&#x5B9E;&#x73B0;&#x5FAA;&#x73AF;&#x5411;&#x91CF;&#x5316;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x5E38;&#x5E38;&#x53EA;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x5EFA;&#x8BAE;&#x7684;pragma&#x6307;&#x4EE4;&#x3002;&#x8BE5;&#x6D41;&#x7A0B;&#x8FD8;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x66F4;&#x4F4E;&#x5C42;&#x6B21;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5982;&#x9884;&#x53D6;&#x6216;&#x53D1;&#x51FA;&#x4E13;&#x7528;&#x7684;&#x786C;&#x4EF6;&#x6307;&#x4EE4;&#x3002;&#x53CD;&#x4E4B;&#xFF0C;&#x591A;&#x9762;&#x4F53;&#x5206;&#x6790;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x4E0B;&#x6E38;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5730;&#x5740;&#x8BA1;&#x7B97;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x8D8A;&#x754C;&#x8BBF;&#x95EE;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x5728;Polygeist&#x7684;&#x652F;&#x6301;&#x4E0B;&#xFF0C;&#x63A7;&#x5236;&#x8BED;&#x53E5;&#x7C92;&#x5EA6;&#x7684;&#x672A;&#x6765;&#x5DE5;&#x4F5C;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x9664;&#x4E86;&#x5F71;&#x54CD;&#x4EFF;&#x5C04;&#x8C03;&#x5EA6;&#x5916;&#xFF0C;&#x8BE5;&#x6280;&#x672F;&#x8FD8;&#x4F7F;&#x5F97;&#x8F7B;&#x677E;&#x7684;&#x91CD;&#x65B0;&#x7269;&#x5316;&#x548C;&#x5C40;&#x90E8;&#x8F6C;&#x7F6E;&#x7F13;&#x51B2;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#xFF0C;&#x8FD9;&#x5728;GPU&#x4E0A;&#x662F;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;[55]&#xFF0C;&#x4EE5;&#x53CA;&#x8F6F;&#x4EF6;&#x6D41;&#x6C34;&#x7EBF;&#x5316;&#xFF1B;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x751F;&#x6210;&#x5DF2;&#x77E5;&#x590D;&#x6742;&#x7684;C&#x6E90;&#x4EE3;&#x7801;[56]&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x8BED;&#x53E5;&#x6570;&#x91CF;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x7F16;&#x8BD1;&#x65F6;&#x95F4;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x4E3A;&#x8BED;&#x53E5;&#x6570;&#x91CF;&#x662F;&#x4F9D;&#x8D56;&#x5206;&#x6790;&#x548C;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x590D;&#x6742;&#x6027;&#x8FB9;&#x754C;&#x7684;&#x91CD;&#x8981;&#x56E0;&#x7D20;&#x3002;</p>
<h2 id="c-alternatives"># C. Alternatives</h2>
<p>Instead of allowing polyhedral tools to parse and generate MLIR, one could emit C (or C++) code from MLIR 6 and use C-based polyhedral tools on the C source, but this approach decreases the expressiveness of the flow. Some MLIR constructs, such as parallel reduction loops, can be directly expressed in the polyhedral model, whereas they would require a non-trivial and non-guaranteed raising step in C. Some other constructs, such as prevectorized affine memory operations, cannot be expressed in C at all. Polygeist enables transparent handling of such constructs in MLIR-to-MLIR flows, but we leave the details of such handling for future work.
The Polygeist flow can be similarly connected to other polyhedral formats, in particular isl. We choose OpenScop for this work because it is supported by a wider variety of tools. isl uses schedule trees [57] to represent the initial and transformed program schedule. Schedule trees are sufficiently close to the nested-operation IR model making the conversion straightforward: &quot;for&quot; loops correspond to band nodes (one loop per band dimension), &quot;if&quot; conditionals correspond to filter nodes, function-level constants can be included into the context node. The tree structure remains the same as that of MLIR regions. The inverse conversion can be obtained using isl&apos;s AST generation facility [14].</p>
<p>&#x66FF;&#x4EE3;&#x65B9;&#x6848;</p>
<p>&#x4E0E;&#x5176;&#x8BA9;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#x89E3;&#x6790;&#x5E76;&#x751F;&#x6210;MLIR&#xFF0C;&#x4E0D;&#x5982;&#x76F4;&#x63A5;&#x4ECE;MLIR&#x53D1;&#x51FA;C&#xFF08;&#x6216;C++&#xFF09;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x5728;C&#x6E90;&#x4EE3;&#x7801;&#x4E0A;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;C&#x7684;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x964D;&#x4F4E;&#x4E86;&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;&#x7684;&#x8868;&#x8FBE;&#x80FD;&#x529B;&#x3002;&#x4E00;&#x4E9B;MLIR&#x6784;&#x9020;&#xFF0C;&#x4F8B;&#x5982;&#x5E76;&#x884C;&#x5F52;&#x7EA6;&#x5FAA;&#x73AF;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x591A;&#x9762;&#x4F53;&#x6A21;&#x578B;&#x4E2D;&#x8868;&#x8FBE;&#xFF0C;&#x800C;&#x5728;C&#x4E2D;&#x5374;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x4E14;&#x4E0D;&#x4FDD;&#x8BC1;&#x53EF;&#x884C;&#x7684;&#x63D0;&#x5347;&#x6B65;&#x9AA4;&#x3002;&#x53E6;&#x4E00;&#x4E9B;&#x6784;&#x9020;&#xFF0C;&#x4F8B;&#x5982;&#x9884;&#x5411;&#x91CF;&#x5316;&#x7684;&#x4EFF;&#x5C04;&#x5185;&#x5B58;&#x64CD;&#x4F5C;&#xFF0C;&#x5219;&#x6839;&#x672C;&#x65E0;&#x6CD5;&#x5728;C&#x4E2D;&#x8868;&#x8FBE;&#x3002;Polygeist&#x652F;&#x6301;&#x5728;MLIR&#x5230;MLIR&#x7684;&#x6D41;&#x7A0B;&#x4E2D;&#x900F;&#x660E;&#x5730;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6784;&#x9020;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5C06;&#x6B64;&#x7C7B;&#x5904;&#x7406;&#x7684;&#x7EC6;&#x8282;&#x7559;&#x5F85;&#x672A;&#x6765;&#x7814;&#x7A76;&#x3002;</p>
<p>Polygeist&#x6D41;&#x7A0B;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0E;&#x5176;&#x4ED6;&#x591A;&#x9762;&#x4F53;&#x683C;&#x5F0F;&#x76F8;&#x8FDE;&#x63A5;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x4E0E;isl&#x76F8;&#x8FDE;&#x3002;&#x6211;&#x4EEC;&#x9009;&#x62E9;OpenScop&#x4F5C;&#x4E3A;&#x672C;&#x7814;&#x7A76;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5F97;&#x5230;&#x66F4;&#x591A;&#x5DE5;&#x5177;&#x7684;&#x652F;&#x6301;&#x3002;isl&#x4F7F;&#x7528;&#x8C03;&#x5EA6;&#x6811;&#x6765;&#x8868;&#x793A;&#x521D;&#x59CB;&#x548C;&#x8F6C;&#x5316;&#x540E;&#x7684;&#x7A0B;&#x5E8F;&#x8C03;&#x5EA6;&#x3002;&#x8C03;&#x5EA6;&#x6811;&#x4E0E;&#x5D4C;&#x5957;&#x64CD;&#x4F5C;&#x7684;IR&#x6A21;&#x578B;&#x975E;&#x5E38;&#x63A5;&#x8FD1;&#xFF0C;&#x4F7F;&#x5F97;&#x8F6C;&#x6362;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#xFF1A;<code>for</code>&#x5FAA;&#x73AF;&#x5BF9;&#x5E94;&#x4E8E;&#x5E26;&#x8282;&#x70B9;&#xFF08;&#x6BCF;&#x4E2A;&#x5E26;&#x7EF4;&#x5EA6;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF09;&#xFF0C;<code>if</code>&#x6761;&#x4EF6;&#x5BF9;&#x5E94;&#x4E8E;&#x8FC7;&#x6EE4;&#x8282;&#x70B9;&#xFF0C;&#x51FD;&#x6570;&#x7EA7;&#x5E38;&#x91CF;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x8282;&#x70B9;&#x4E2D;&#x3002;&#x6811;&#x7ED3;&#x6784;&#x4E0E;MLIR&#x533A;&#x57DF;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;&#x9006;&#x5411;&#x8F6C;&#x6362;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;isl&#x7684;AST&#x751F;&#x6210;&#x5DE5;&#x5177;&#x83B7;&#x5F97;&#x3002;</p>
<h2 id="viii-conclusion-part-1"># VIII. CONCLUSION Part-1</h2>
<p>We present Polygeist, a compilation workflow for importing existing C or C++ code into MLIR and allows polyhedral tools, such as Pluto, to optimize MLIR programs. This enables MLIR to benefit from decades of research in polyhedral compilation. We demonstrate that the code generated by Polygeist has comparable performance with Clang, enabling unbiased comparisons between transformations built for MLIR and existing polyhedral frameworks. Finally, we demonstrate the optimization opportunities enabled by Polygeist considering two complementary transformations: statement splitting and reduction parallelization. In both cases, Polygeist achieves better performance than state-of-the-art polyhedral compiler and source-to-source optimizer. comments regarding how this may need to be modified to run on a system with hardware or software configuration that is distinct from what we used. As expected, the command description mirrors much of the content of the docker file. While a docker file is certainly more convenient and a good way of getting the compiler set up, similar changes to expectations of how many cores the system has in the evaluation will be required even with Docker.
To compile Polygeist, one must first compile several of its dependencies. We ran our experiments on an AWS c5.metal instance based on Ubuntu 20.04. We&apos;ve tailored our build instructions to such a system. While many of the instructions are general and independent of machine, or OS, some steps may not be (and we describe what locations they may occur below).
$ sudo apt update $ sudo apt install apt-utils $ sudo apt install tzdata build-essential \ libtool autoconf pkg-config flex bison \ libgmp-dev clang-9 libclang-9-dev texinfo \ cmake ninja-build git texlive-full numactl # Change default compilers to make Pluto happy $ sudo update-alternatives --install \ /usr/bin/llvm-config llvm-config \ /usr/bin/llvm-config-9 100 $ sudo update-alternatives --install \ /usr/bin/FileCheck FileCheck-9 \ /usr/bin/FileCheck 100 $ sudo update-alternatives --install \ /usr/bin/clang clang \ /usr/bin/clang-9 100 $ sudo update-alternatives --install \ /usr/bin/clang++ clang++ \ /usr/bin/clang++-9 100
To begin, let us download a utility repository, which will contain several scripts and other files useful for compilation and benchmarking:
$ cd $ git clone \ <a href="https://github.com/wsmoses/Polygeist-Script\" target="_blank">https://github.com/wsmoses/Polygeist-Script\</a> scripts
One can now compile and build Pluto as shown below:</p>
<p>&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x4E86;Polygeist&#xFF0C;&#x4E00;&#x79CD;&#x5C06;&#x73B0;&#x6709;C&#x6216;C++&#x4EE3;&#x7801;&#x5BFC;&#x5165;MLIR&#x7684;&#x7F16;&#x8BD1;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;&#x591A;&#x9762;&#x4F53;&#x5DE5;&#x5177;&#xFF08;&#x5982;Pluto&#xFF09;&#x5BF9;MLIR&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;MLIR&#x80FD;&#x591F;&#x53D7;&#x76CA;&#x4E8E;&#x6570;&#x5341;&#x5E74;&#x6765;&#x5728;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x65B9;&#x9762;&#x7684;&#x7814;&#x7A76;&#x3002;&#x6211;&#x4EEC;&#x8BC1;&#x660E;&#x4E86;Polygeist&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x6027;&#x80FD;&#x4E0A;&#x4E0E;Clang&#x76F8;&#x5F53;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;&#x9488;&#x5BF9;MLIR&#x6784;&#x5EFA;&#x7684;&#x53D8;&#x6362;&#x4E0E;&#x73B0;&#x6709;&#x591A;&#x9762;&#x4F53;&#x6846;&#x67B6;&#x4E4B;&#x95F4;&#x7684;&#x516C;&#x6B63;&#x6BD4;&#x8F83;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C55;&#x793A;&#x4E86;Polygeist&#x6240;&#x5E26;&#x6765;&#x7684;&#x4F18;&#x5316;&#x673A;&#x4F1A;&#xFF0C;&#x8003;&#x8651;&#x4E86;&#x4E24;&#x79CD;&#x4E92;&#x8865;&#x7684;&#x53D8;&#x6362;&#xFF1A;&#x8BED;&#x53E5;&#x62C6;&#x5206;&#x548C;&#x5F52;&#x7EA6;&#x5E76;&#x884C;&#x5316;&#x3002;&#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Polygeist&#x7684;&#x6027;&#x80FD;&#x5747;&#x4F18;&#x4E8E;&#x6700;&#x5148;&#x8FDB;&#x7684;&#x591A;&#x9762;&#x4F53;&#x7F16;&#x8BD1;&#x5668;&#x548C;&#x6E90;&#x5230;&#x6E90;&#x4F18;&#x5316;&#x5668;&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x5982;&#x4F55;&#x5728;&#x786C;&#x4EF6;&#x6216;&#x8F6F;&#x4EF6;&#x914D;&#x7F6E;&#x4E0E;&#x6211;&#x4EEC;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x8BC4;&#x8BBA;&#x3002;&#x5982;&#x9884;&#x671F;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x547D;&#x4EE4;&#x63CF;&#x8FF0;&#x4E0E;docker&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x76F8;&#x4F3C;&#x3002;&#x867D;&#x7136;docker&#x6587;&#x4EF6;&#x65E0;&#x7591;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x662F;&#x8BBE;&#x7F6E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x597D;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x5373;&#x4FBF;&#x4F7F;&#x7528;Docker&#xFF0C;&#x5BF9;&#x4E8E;&#x8BC4;&#x4F30;&#x7CFB;&#x7EDF;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x91CF;&#x7684;&#x671F;&#x671B;&#x4E5F;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x7684;&#x66F4;&#x6539;&#x3002;</p>
<p>&#x8981;&#x7F16;&#x8BD1;Polygeist&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x5176;&#x82E5;&#x5E72;&#x4F9D;&#x8D56;&#x9879;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x57FA;&#x4E8E;Ubuntu 20.04&#x7684;AWS c5.metal&#x5B9E;&#x4F8B;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x5B9E;&#x9A8C;&#x3002;&#x6211;&#x4EEC;&#x6839;&#x636E;&#x8BE5;&#x7CFB;&#x7EDF;&#x8C03;&#x6574;&#x4E86;&#x6784;&#x5EFA;&#x8BF4;&#x660E;&#x3002;&#x867D;&#x7136;&#x8BB8;&#x591A;&#x8BF4;&#x660E;&#x662F;&#x901A;&#x7528;&#x7684;&#xFF0C;&#x4E0E;&#x673A;&#x5668;&#x6216;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x65E0;&#x5173;&#xFF0C;&#x4F46;&#x67D0;&#x4E9B;&#x6B65;&#x9AA4;&#x53EF;&#x80FD;&#x5E76;&#x975E;&#x5982;&#x6B64;&#xFF08;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4E0B;&#x6587;&#x4E2D;&#x63CF;&#x8FF0;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x4F4D;&#x7F6E;&#xFF09;&#x3002;</p>
<pre><code>$ sudo apt update 
$ sudo apt install apt-utils 
$ sudo apt install tzdata build-essential \ 
libtool autoconf pkg-config flex bison \ 
libgmp-dev clang-9 libclang-9-dev texinfo \ 
cmake ninja-build git texlive-full numactl 

# &#x66F4;&#x6539;&#x9ED8;&#x8BA4;&#x7F16;&#x8BD1;&#x5668;&#x4EE5;&#x4F7F;Pluto&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;
$ sudo update-alternatives --install \ 
/usr/bin/llvm-config llvm-config \ 
/usr/bin/llvm-config-9 100 

$ sudo update-alternatives --install \ 
/usr/bin/FileCheck FileCheck-9 \ 
/usr/bin/FileCheck 100 

$ sudo update-alternatives --install \ 
/usr/bin/clang clang \ 
/usr/bin/clang-9 100 

$ sudo update-alternatives --install \ 
/usr/bin/clang++ clang++ \ 
/usr/bin/clang++-9 100
</code></pre><p>&#x9996;&#x5148;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x5B9E;&#x7528;&#x5DE5;&#x5177;&#x5E93;&#xFF0C;&#x5176;&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x7F16;&#x8BD1;&#x548C;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x6240;&#x9700;&#x7684;&#x811A;&#x672C;&#x548C;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre><code>$ cd 
$ git clone \
https://github.com/wsmoses/Polygeist-Script\ scripts
</code></pre><p>&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x7F16;&#x8BD1;&#x548C;&#x6784;&#x5EFA;Pluto&#xFF1A;</p>
<h2 id="viii-conclusion-part-2"># VIII. CONCLUSION Part-2</h2>
<p>$ cd $ git clone \ <a href="https://github.com/bondhugula/pluto" target="_blank">https://github.com/bondhugula/pluto</a> $ cd pluto/ $ git checkout e5a039096547e0a3d34686295c $ git submodule init $ git submodule update $ ./autogen.sh $ ./configure $ make -j<code>nproc&#x1F8; ext one can build LLVM, MLIR, and the frontend by performing the following: From here, we need to modify omp.h by copying the version from the scripts repository and replacing the version we just built. 8$ cd $ export OMP_FILE=</code>find \ $HOME/mlir-clang/build -iname omp.h$ cp $HOME/scripts/omp.h $OMP_FILE
Let us now build the MLIR polyhedral analyses, along with the specific version of LLVM it requires. We shall begin by downloading the requisite code and building its dependencies.
$ cd $ git clone --recursive \ <a href="https://github.com/kumasento/polymer" target="_blank">https://github.com/kumasento/polymer</a> -b pact $ cd polymer/ $ cd llvm/ $ mkdir build $ cd build/ $ cmake ../llvm \ -DLLVM_ENABLE_PROJECTS=&quot;llvm;clang;mlir&quot; \ -DLLVM_TARGETS_TO_BUILD=&quot;host&quot; \ -DLLVM_ENABLE_ASSERTIONS=ON \ -DCMAKE_BUILD_TYPE=Release \ -DLLVM_INSTALL_UTILS=ON \ -G Ninja $ ninja -j<code>nproc$ ninja check-mlir
We can now build the MLIR polyhedral analyses and export the corresponding build artifacts.
$ cd ~/polymer $ mkdir build $ cd build $ export BUILD=$PWD/../llvm/build $ cmake .. \ -DCMAKE_BUILD_TYPE=DEBUG \ -DMLIR_DIR=$BUILD/lib/cmake/mlir \ -DLLVM_DIR=$BUILD/lib/cmake/llvm \ -DLLVM_ENABLE_ASSERTIONS=ON \ -DLLVM_EXTERNAL_LIT=$BUILD/bin/llvm-lit \ -G Ninja $ ninja -j</code>nproc$ export LD_LIBRARY_PATH= \ <code>pwd</code>/pluto/lib:$LD_LIBRARY_PATH $ ninja check-polymer Finally, we are ready to begin benchmarking. We begin by running a script that disables turbo boost &amp; hyperthreading and remaining nonessential services on the machine. The script is specific to both the number of cores on the AWS instance (all cores except the non hyperthreaded cores on the first socket were disabled), as well as the image used (all nonessential services still present on the image were disabled) and thus may require modification if intending to be used on a different machine.
$ cd ~/scripts/ $ sudo bash ./hyper.sh</p>
<p>$ cd $ git clone \ <a href="https://github.com/bondhugula/pluto" target="_blank">https://github.com/bondhugula/pluto</a> $ cd pluto/ $ git checkout e5a039096547e0a3d34686295c $ git submodule init $ git submodule update $ ./autogen.sh $ ./configure $ make -j<code>nproc</code></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#x6765;&#x6784;&#x5EFA;LLVM&#x3001;MLIR&#x548C;&#x524D;&#x7AEF;&#xFF1A;</p>
<p>&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x590D;&#x5236;&#x811A;&#x672C;&#x5E93;&#x4E2D;&#x7684;&#x7248;&#x672C;&#x5E76;&#x66FF;&#x6362;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x6784;&#x5EFA;&#x7684;&#x7248;&#x672C;&#x6765;&#x4FEE;&#x6539;omp.h&#x3002; </p>
<p>$ cd $ export OMP_FILE=<code>find \ $HOME/mlir-clang/build -iname omp.h</code></p>
<p>$ cp $HOME/scripts/omp.h $OMP_FILE</p>
<p>&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x6784;&#x5EFA;MLIR&#x591A;&#x9762;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x6240;&#x9700;&#x7684;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x7684;LLVM&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5F00;&#x59CB;&#x4E0B;&#x8F7D;&#x6240;&#x9700;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x6784;&#x5EFA;&#x5176;&#x4F9D;&#x8D56;&#x9879;&#x3002;</p>
<p>$ cd $ git clone --recursive \ <a href="https://github.com/kumasento/polymer" target="_blank">https://github.com/kumasento/polymer</a> -b pact</p>
<p>$ cd polymer/ $ cd llvm/ $ mkdir build $ cd build/ </p>
<p>$ cmake ../llvm \ -DLLVM_ENABLE_PROJECTS=&quot;llvm;clang;mlir&quot; \ -DLLVM_TARGETS_TO_BUILD=&quot;host&quot; \ -DLLVM_ENABLE_ASSERTIONS=ON \ -DCMAKE_BUILD_TYPE=Release \ -DLLVM_INSTALL_UTILS=ON \ -G Ninja </p>
<p>$ ninja -j<code>nproc</code></p>
<p>$ ninja check-mlir</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;MLIR&#x591A;&#x9762;&#x4F53;&#x5206;&#x6790;&#x5E76;&#x5BFC;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x6784;&#x5EFA;&#x4EA7;&#x7269;&#x3002;</p>
<p>$ cd ~/polymer $ mkdir build $ cd build $ export BUILD=$PWD/../llvm/build </p>
<p>$ cmake .. \ -DCMAKE_BUILD_TYPE=DEBUG \ -DMLIR_DIR=$BUILD/lib/cmake/mlir \ -DLLVM_DIR=$BUILD/lib/cmake/llvm \ -DLLVM_ENABLE_ASSERTIONS=ON \ -DLLVM_EXTERNAL_LIT=$BUILD/bin/llvm-lit \ -G Ninja </p>
<p>$ ninja -j<code>nproc</code> </p>
<p>$ export LD_LIBRARY_PATH= \ <code>pwd</code>/pluto/lib:$LD_LIBRARY_PATH </p>
<p>$ ninja check-polymer </p>
<p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x51C6;&#x5907;&#x5F00;&#x59CB;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x3002;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#xFF0C;&#x7981;&#x7528;&#x6DA1;&#x8F6E;&#x63D0;&#x5347;&#x548C;&#x8D85;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5173;&#x95ED;&#x673A;&#x5668;&#x4E0A;&#x4ECD;&#x7136;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x670D;&#x52A1;&#x3002;&#x8BE5;&#x811A;&#x672C;&#x7279;&#x5B9A;&#x4E8E;AWS&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x91CF;&#xFF08;&#x6240;&#x6709;&#x6838;&#x5FC3;&#x4E2D;&#x9664;&#x7B2C;&#x4E00;&#x4E2A;&#x63D2;&#x69FD;&#x4E0A;&#x7684;&#x975E;&#x8D85;&#x7EBF;&#x7A0B;&#x6838;&#x5FC3;&#x5916;&#x5747;&#x88AB;&#x7981;&#x7528;&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x7684;&#x955C;&#x50CF;&#xFF08;&#x955C;&#x50CF;&#x4E0A;&#x4ECD;&#x5B58;&#x5728;&#x7684;&#x6240;&#x6709;&#x4E0D;&#x5FC5;&#x8981;&#x670D;&#x52A1;&#x88AB;&#x7981;&#x7528;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x6253;&#x7B97;&#x5728;&#x5176;&#x4ED6;&#x673A;&#x5668;&#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;</p>
<p>$ cd ~/scripts/ $ sudo bash ./hyper.sh</p>
<h2 id="viii-conclusion-part-3"># VIII. CONCLUSION Part-3</h2>
<p>We can now run the benchmarking script. The script itself has assumptions about cores and layout (setting taskset -c 1-8 numactl -i all for example). If using a different machine, these settings may need to be tweaked as appropriate.
cd ~/scripts/ $ cd polybench-c-4.2.1-beta/ $ ./run.sh # Output comes through stdout
The output of this script will contain the runtime of each trial, describing what compilation setting was used, as well as which benchmark was run.</p>
<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#x3002;&#x8BE5;&#x811A;&#x672C;&#x672C;&#x8EAB;&#x5BF9;&#x6838;&#x5FC3;&#x548C;&#x5E03;&#x5C40;&#x6709;&#x4E00;&#x4E9B;&#x5047;&#x8BBE;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x8BBE;&#x7F6E; taskset -c 1-8 numactl -i all&#xFF09;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x8C03;&#x6574;&#x8FD9;&#x4E9B;&#x8BBE;&#x7F6E;&#x3002;
cd ~/scripts/
$ cd polybench-c-4.2.1-beta/
$ ./run.sh  # &#x8F93;&#x51FA;&#x901A;&#x8FC7;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x751F;&#x6210;
&#x8BE5;&#x811A;&#x672C;&#x7684;&#x8F93;&#x51FA;&#x5C06;&#x5305;&#x542B;&#x6BCF;&#x6B21;&#x8BD5;&#x9A8C;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x63CF;&#x8FF0;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x7F16;&#x8BD1;&#x8BBE;&#x7F6E;&#x4EE5;&#x53CA;&#x8FD0;&#x884C;&#x4E86;&#x54EA;&#x4E2A;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x3002;</p>
<h2 id="">#</h2>
<p>The views and conclusions contained in this document are those of the authors and should not be interpreted as representing the official policies, either expressed or implied, of the United States Air Force or the U.S. Government. The U.S. Government is authorized to reproduce and distribute reprints for Government purposes notwithstanding any copyright notation herein.</p>
<p>&#x672C;&#x6587;&#x4EF6;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x89C2;&#x70B9;&#x548C;&#x7ED3;&#x8BBA;&#x662F;&#x4F5C;&#x8005;&#x7684;&#x89C2;&#x70B9;&#xFF0C;&#x4E0D;&#x5E94;&#x88AB;&#x89E3;&#x8BFB;&#x4E3A;&#x4EE3;&#x8868;&#x7F8E;&#x56FD;&#x7A7A;&#x519B;&#x6216;&#x7F8E;&#x56FD;&#x653F;&#x5E9C;&#x7684;&#x5B98;&#x65B9;&#x653F;&#x7B56;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x660E;&#x793A;&#x8FD8;&#x662F;&#x6697;&#x793A;&#x3002;&#x7F8E;&#x56FD;&#x653F;&#x5E9C;&#x88AB;&#x6388;&#x6743;&#x4E3A;&#x4E86;&#x653F;&#x5E9C;&#x76EE;&#x7684;&#x590D;&#x5370;&#x548C;&#x5206;&#x53D1;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x5370;&#x5237;&#x672C;&#xFF0C;&#x5C3D;&#x7BA1;&#x8FD9;&#x91CC;&#x6709;&#x4EFB;&#x4F55;&#x7248;&#x6743;&#x8BF4;&#x660E;&#x3002;</p>
<h2 id="appendix"># APPENDIX</h2>
<p>In this artifact appendix, we describe how to build Polygeist and evaluate its performance (as well as baseline compilers) on the Polybench benchmark suite. We provide two mechanisms for artifact evaluation: a Docker container 7 , and a commandby-command description of the installation process, along with</p>
<p>&#x5728;&#x672C;&#x9644;&#x5F55;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x63CF;&#x8FF0;&#x4E86;&#x5982;&#x4F55;&#x6784;&#x5EFA;Polygeist&#x5E76;&#x8BC4;&#x4F30;&#x5176;&#x5728;Polybench&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#x5957;&#x4EF6;&#x4E0A;&#x7684;&#x6027;&#x80FD;&#xFF08;&#x4EE5;&#x53CA;&#x57FA;&#x51C6;&#x7F16;&#x8BD1;&#x5668;&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x827A;&#x672F;&#x54C1;&#x8BC4;&#x4F30;&#x673A;&#x5236;&#xFF1A;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4EE5;&#x53CA;&#x9010;&#x6B65;&#x547D;&#x4EE4;&#x63CF;&#x8FF0;&#x7684;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FDE;&#x540C;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.html" class="navigation navigation-prev " aria-label="Previous page: 2021_Polygeist-Raising C to Polyhedral MLIR-translated_only">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Note.html" class="navigation navigation-next " aria-label="Next page: Note">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original","level":"1.5.17.2","depth":3,"next":{"title":"Note","level":"1.5.17.3","depth":3,"path":"Learn/LearnPolygeist/Note.md","ref":"Learn/LearnPolygeist/Note.md","articles":[]},"previous":{"title":"2021_Polygeist-Raising C to Polyhedral MLIR-translated_only","level":"1.5.17.1","depth":3,"path":"Learn/LearnPolygeist/2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.md","ref":"Learn/LearnPolygeist/2021_Polygeist-Raising C to Polyhedral MLIR-translated_only.md","articles":[]},"dir":"ltr"},"config":{"plugins":["include-codeblock","-lunr","-search","search-pro","expandable-chapters","code","chapter-fold","splitter","github","theme-comscore","katex-pp","edit-link","back-to-top-button","intopic-toc","my-toolbar"],"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"chapter-fold":{},"github":{"url":"https://github.com/houhuawei23/Notes"},"intopic-toc":{"isCollapsed":true,"isScrollspyActive":true,"label":"In this article","maxDepth":6,"mode":"nested","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true},"splitter":{},"search-pro":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"theme-comscore":{},"back-to-top-button":{},"my-toolbar":{},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"katex-pp":{},"edit-link":{"label":"Edit","base":"https://github.com/houhuawei23/Notes/edit/main"},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"houhuawei23","pdf":{"pageNumbers":true,"fontSize":10,"fontFamily":"Times New Roman","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":10,"left":10,"top":10,"bottom":10}},"structure":{"langs":"LANGS.md","readme":"Introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY-GitBook-auto-summary.md"},"variables":{},"title":"Notes of hhw","language":"cn","gitbook":"*","description":"Notes of hhw"},"file":{"path":"Learn/LearnPolygeist/2021_Polygeist-Raising C to Polyhedral MLIRtranslated_and_original.md","mtime":"2025-01-12T03:08:18.389Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-01-12T03:09:05.803Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/gumshoe.polyfills.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-my-toolbar/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

